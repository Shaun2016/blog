<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>使用sklearn实现kmeans的代码</title>
      <link href="/2019/04/01/sklearn-kmeans/"/>
      <url>/2019/04/01/sklearn-kmeans/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote><p>就是代码，也比一点不会强…</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</div><div class="line"><span class="keyword">from</span> sklearn.datasets.samples_generator <span class="keyword">import</span> make_blobs</div><div class="line">X = []<span class="comment"># 二维数组</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'./GraphData/small_sample.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f.readlines():</div><div class="line">        X.append(list([int(i.split(<span class="string">' '</span>)[<span class="number">0</span>]), int(i.split(<span class="string">' '</span>)[<span class="number">1</span>])]))</div><div class="line">X = np.asarray(X)</div><div class="line"><span class="comment"># n_clusters 为聚类个数，y_pred 为聚类结果</span></div><div class="line">y_pred = KMeans(n_clusters=<span class="number">2</span>, random_state=<span class="number">9</span>).fit_predict(X)</div><div class="line">print(y_pred)    <span class="comment">#输出： [1 1 1 1 1 1 1 1 0 0 0 0 0]</span></div><div class="line">plt.scatter(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], c=y_pred)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><a id="more"></a><blockquote><p>txt 里的内容类似如下</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">0 4</div><div class="line">0 6</div><div class="line">1 2</div><div class="line">....</div></pre></td></tr></table></figure><p><img src="/images/sklearn/kmeans.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> machine learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sklearn </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>word2vec的简单理解</title>
      <link href="/2019/03/19/word2vec_CBOW/"/>
      <url>/2019/03/19/word2vec_CBOW/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote><p>word2vec研究如何将词用向量表示，使用的两个重要模型——CBOW模型(Continuous Bag-of-Words Model)和Skip-gram模型(Continuous Skip-gram Model)，CBOW通过上下文预测中间词，Skip-gram对中间词预测它的上下文，本文只对CBOW进行介绍</p></blockquote><h2 id="词的向量表示"><a href="#词的向量表示" class="headerlink" title="词的向量表示"></a>词的向量表示</h2><ul><li>one-hot：语料库的词项个数为m，则one-hot表示的长度为m，只有一个位置是1，其余都是0</li><li>distributed representation：假设每个词项有d个特征，d远小于m，用d维向量表示每个词项</li></ul><h2 id="CBOW"><a href="#CBOW" class="headerlink" title="CBOW"></a>CBOW</h2><blockquote><p>CBOW 是 word2vec 中使用的浅层神经网络模型，语料库中词项和词项的上下文做为样本，Sample(Context(x), x)，对模型的参数进行训练，得到每个词项的向量表示</p></blockquote><a id="more"></a><h3 id="词的上下文-Context-x"><a href="#词的上下文-Context-x" class="headerlink" title="词的上下文 Context(x)"></a>词的上下文 Context(x)</h3><blockquote><p>一个词出现的概率只与它前后固定数目(n)的词相关，n的取值与模型参数有关，可以参考：</p><div class="table-container"><table><thead><tr><th style="text-align:center">n</th><th style="text-align:center">模型参数数量</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center"><script type="math/tex">2*10^5</script></td></tr><tr><td style="text-align:center">2</td><td style="text-align:center"><script type="math/tex">4*10^{10}</script></td></tr><tr><td style="text-align:center">3</td><td style="text-align:center"><script type="math/tex">8*10^{15}</script></td></tr><tr><td style="text-align:center">4</td><td style="text-align:center"><script type="math/tex">16*10^{20}</script></td></tr></tbody></table></div><p>例子：我很爱学信息检索</p><p>如果n=2，则<strong>学</strong>的上下文Context(学)={ 很，爱，信息，检索 } 4 个词组成</p></blockquote><h3 id="模型结构"><a href="#模型结构" class="headerlink" title="模型结构"></a>模型结构</h3><p><img src="/images/word2vec/model.png" alt="模型结构"></p><h4 id="输入层"><a href="#输入层" class="headerlink" title="输入层"></a>输入层</h4><blockquote><p>上下文词项的one-hot</p></blockquote><h4 id="隐藏层"><a href="#隐藏层" class="headerlink" title="隐藏层"></a>隐藏层</h4><blockquote><p>对于一个样本Sample(Context(x), x)，将<script type="math/tex">u_i</script>的one-hot向量与表示矩阵<script type="math/tex">W_{m*d}</script>相乘，得到<script type="math/tex">u_i</script>的当前表示向量<script type="math/tex">\hat{u_i}</script>，<script type="math/tex">u_i\in Context(x)</script>，将<script type="math/tex">\sum_{i=1}^{2n}{\hat{u_i}}/2n</script>做为隐藏层的输出，是一个1*d的向量。</p></blockquote><p><img src="/images/word2vec/one-hot-m-matrix.png" alt="1552997378231"></p><h4 id="输出层"><a href="#输出层" class="headerlink" title="输出层"></a>输出层</h4><blockquote><p>隐藏层得到的1<em>d向量与权重矩阵<script type="math/tex">W'</script>相乘，得到1\</em>m的向量，通过softmax处理后得到一个1*m的向量<script type="math/tex">\hat{y}</script>，为中间词出现的概率，概率最大的index指向的词项即为预测出的中间词，与真实值的one-hot向量 <script type="math/tex">y</script> 做比较，根据误差更新权重矩阵<script type="math/tex">W与W'</script>。</p></blockquote><script type="math/tex; mode=display">softmax(\begin{bmatrix}4.01 & 2.01 & 5& 3.34& 1.2\end{bmatrix})=\begin{bmatrix}0.23&0.03&0.61&0.12&0.01\end{bmatrix}</script><h4 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h4><script type="math/tex; mode=display">L=H(\hat y,y)=-\sum_i^m{\hat y_i log\ y_i}</script><blockquote><p>梯度下降更新W和<script type="math/tex">W'</script>，训练完毕后，W矩阵即为词向量矩阵，用一个词项的one-hot去乘W矩阵即得到这个词项的词向量</p></blockquote><h4 id="结构分析"><a href="#结构分析" class="headerlink" title="结构分析"></a>结构分析</h4><blockquote><p>参数数量：2*d*m个，d为词向量长度，m为词项个数，在语料库中m的值是很大的，对于一个样本(Context(x), x)，只有一个是正确的结果，其余的m-1个全是错误的结果，每次都对大量的错误结果进行权重更新是很耗时的</p></blockquote><h2 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h2><p><em>思路：减少网络的参数个数和每次要更新的参数个数</em></p><h3 id="负采样策略"><a href="#负采样策略" class="headerlink" title="负采样策略"></a>负采样策略</h3><blockquote><p>对于词 w 的上下文<em>Context(w)</em>来预测w，Context(x)与x构成了一个正样本，Context(x)与别的词项就构成负样本，每次训练仅选择一小部分的负样本，对他们连接的权重进行更新，减少了每次训练需要更新的权重数量，应该选择多少，如何进行选择呢？大体思路是让出现频率高的词项更大概率被选做负样本。</p><p>采样率公式：</p><script type="math/tex; mode=display">len(w)=\frac{[counter(w)]^{3/4}}{\sum_{u\in D}[counter(u)]^{3/4}}</script><p>len(w)表示w应该被保留作为负样本的概率，counter(w)代表w在语料库中出现的次数，指数3/4是经验值</p></blockquote><h3 id="Hierarchical-softmax的CBOW"><a href="#Hierarchical-softmax的CBOW" class="headerlink" title="Hierarchical softmax的CBOW"></a>Hierarchical softmax的CBOW</h3><blockquote><p>分层softmax的CBOW将输出层改为树形结构</p></blockquote><p><img src="/images/word2vec/cbow.png" alt="h-softmax-CBOW"></p><blockquote><p>建立哈夫曼树，使高频词项更靠近根节点，规定左孩子为负类，右孩子为正类，经过一个非叶子结点做了一次二分类，设隐藏层的输出为<script type="math/tex">x</script>，经过每个非叶子结点被分到正类的概率为：</p><script type="math/tex; mode=display">\sigma(x^T\theta)=\frac{1}{1+e^{-x^T\theta}}</script><p>分到负类概率为：<script type="math/tex">1-\sigma(x^T\theta)</script>，每个非叶子结点上都有一个待定参数向量：<script type="math/tex">\theta</script>，可以计算出到达值为1的结点x的概率：</p><script type="math/tex; mode=display">第1次：p(0|x,\theta_1)=1-\sigma(x^T\theta_1)\\第2次：p(1|x,\theta_2)=\sigma(x^T\theta_2)\\第3次：p(1|x,\theta_3)=\sigma(x^T\theta_3)\\第4次：p(1|x,\theta_4)=\sigma(x^T\theta_4)\\即：p(x|Context(x))=\prod_{i=1}^4{p(d_i|x,\theta_i)},\ d_i\in\{0,1\}</script><p>目标函数：<script type="math/tex">L=\sum_{x\in C}{log\ p(x|Context(x))}</script> 最大化，通过梯度上升（或者求 <script type="math/tex">1-L</script> 的最小值，用梯度下降）更新 <script type="math/tex">x 和 \theta</script> 的值，表示矩阵是最终得到的词向量矩阵。</p></blockquote><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://export.arxiv.org/pdf/1301.3781" target="_blank" rel="external">Efficient Estimation of Word Representations in Vector Space</a></p><p><a href="http://www.cnblogs.com/peghoty/p/3857839.html" target="_blank" rel="external">word2vec的数学原理</a></p><p><a href="https://www.jianshu.com/p/ed15e2adbfad" target="_blank" rel="external">word2vec的负采样</a></p>]]></content>
      
      <categories>
          
          <category> mechine learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> word2vec </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Redis 主从服务器搭建与哨兵机制</title>
      <link href="/2019/03/12/redis-master-slave-sentinel/"/>
      <url>/2019/03/12/redis-master-slave-sentinel/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote><p>实验内容：用三台服务器运行 redis，设置主从关系进行数据存储，建立哨兵监督主节点，模拟主节点宕机后的哨兵选举新主</p></blockquote><h3 id="Redis-单节点安装"><a href="#Redis-单节点安装" class="headerlink" title="Redis 单节点安装"></a>Redis 单节点安装</h3><blockquote><p>将 Redis 5.0.3压缩包解压，进入解压后的文件夹，可以看到<code>Makefile</code>文件，在这个路径下执行<code>make&amp;&amp;make PREFIX=~/redis install</code>进行编译和安装，在<code>~/redis</code>下可以看到<code>bin</code>文件夹，里面有一些脚本文件：<code>redis-server</code>，<code>redis-cli</code>，<code>redis-sentinel</code>等。配置环境变量使得执行脚本命令更加方便：<code>vi /etc/profile</code>在最后加上如下内容：(<code>shift + g</code>跳到最后一行，<code>shift + $</code>跳到一行的最后)</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export REDIS_HOME=/root/redis</div><div class="line">PATH=$PATH:$REDIS_HOME/bin</div></pre></td></tr></table></figure><a id="more"></a><blockquote><p>在单节点上的某个路径上运行<code>redis-server</code>即可按默认参数（端口6379）启动服务，<code>redis-cli</code>作为客户端访问服务，可以用形如：<code>redis-server --port 6380</code>，<code>redis-cli -h ip -p port</code>的方式指定参数，具体命令访问<a href="https://redis.io/commands" target="_blank" rel="external">redis官网</a></p></blockquote><h3 id="Redis-集群搭建"><a href="#Redis-集群搭建" class="headerlink" title="Redis 集群搭建"></a>Redis 集群搭建</h3><blockquote><p>创建三个服务器：</p><ul><li>192.168.56.100 master</li><li>192.168.56.101 slave1</li><li>192.168.56.102 slave2</li></ul><p><code>vim /etc/hosts</code>设置ip对应的域名减少敲ip的麻烦</p></blockquote><p><em>为了方便，以下都在各个服务器的<code>~/redis/6380</code>文件夹下操作</em></p><h4 id="主结点"><a href="#主结点" class="headerlink" title="主结点"></a>主结点</h4><blockquote><p>master为主节点，服务配置文件<code>vi redis.conf</code>：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">port 6380</div><div class="line">protected-mode no</div></pre></td></tr></table></figure><blockquote><p>哨兵配置文件<code>vi sent.conf</code>：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">port 26379</div><div class="line">sentinel monitor c1 master 6380 2</div></pre></td></tr></table></figure><blockquote><p>启动服务：<code>redis-server redis.conf</code></p><p>启动哨兵：<code>redis-sentinel sent.conf</code></p></blockquote><h4 id="从结点"><a href="#从结点" class="headerlink" title="从结点"></a>从结点</h4><blockquote><p>slave1 和 slave2 作为从节点，在服务配置上加上附属主节点，在哨兵上没有不同</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">port 6380</div><div class="line">protected-mode no</div><div class="line">slaveof master 6380</div></pre></td></tr></table></figure><blockquote><p>写好配置文件后启动服务和哨兵</p></blockquote><h4 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h4><blockquote><p>通过客户端访问不同结点：<code>redis-cli -h master -p 6380</code>可以执行<code>set/get</code>操作，访问slave结点只能执行<code>get</code>操作</p><p>模拟主节点宕机：使用<code>Ctrl C</code>命令关闭主节点redis服务进程，查看slave1和slave2 的状态，可以发现经过大约10s后哨兵重新选举slave1或者slave2作为新的主，同时将master降级为slave，再启动master的redis服务时，它以从节点的身份加入集群。</p></blockquote>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> NoSQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>枫叶城</title>
      <link href="/2019/02/13/fyl/"/>
      <url>/2019/02/13/fyl/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote><p>最近，开始练习杨昊昆的枫叶城，这首用到打板和拍弦的技巧十足需要练习一阵子。深秋的城中，枫叶在枝头，在风中，在地面，映红了这座城，在城楼高处，吉他的旋律，伴着起舞的枫叶，在簌簌的风中回荡，在寂静的空巷中飘扬。这，显然是一个人的城。<br>这首曲子真的好听，弹琴的时候，才是我全身心投入的时候，只想沉浸在音乐中，全部的烦恼也都无暇顾及。做别的事呢，则经常是插着耳机，朋友笑着说，你真的很喜欢音乐啊。是啊，但是，不听歌做什么呢？在校园里用眼睛和腿就可以过马路，食堂吃饭只需要嘴巴，在电脑前工作音乐能让枯燥的时间过的快些。当旋律响起，枫叶出现在空中，走在古城中，青石板铺成的宽阔街道上，两侧空无一人的店铺，静止的门窗，时隐时现的风铃，也不觉得奇怪。朋友冲我笑了笑：来啦，我也向他问好，走到座位上，把耳机从手机上拔下，插在了电脑上。不知从什么时候开始，就喜欢把情绪埋在心底，脸上的表情也越来越少，即使在家里，和一年见几次面的父母，也不想让他们看出自己的喜怒哀乐。…喧嚣和嘈杂中，有能属于自己的安静，是多么珍贵，把寝室的窗户擦亮，静下心观察天空的颜色，远处高山的秋装，为自己能生活在温暖的室内而惬喜。嘴上说着要为自己活，要有独立的人格，可漫漫长夜，谁又能忍受得了呢。</p></blockquote>]]></content>
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>tensorflow method</title>
      <link href="/2019/01/28/tensorflow-method/"/>
      <url>/2019/01/28/tensorflow-method/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h3 id="tf-random-uniform"><a href="#tf-random-uniform" class="headerlink" title="tf.random_uniform"></a>tf.random_uniform</h3><blockquote><p><code>tf.random_uniform(shape, minval, maxval, dtype, seed, name)</code></p><p>产生3行4列的随机数，范围在(-1, 1)，类型是float32，可用于权重参数的初始化</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tf.random_uniform((<span class="number">3</span>, <span class="number">4</span>), <span class="number">-1</span>, <span class="number">1</span>, dtype=tf.float32)</div></pre></td></tr></table></figure><a id="more"></a><h3 id="tf-Variable"><a href="#tf-Variable" class="headerlink" title="tf.Variable"></a>tf.Variable</h3><blockquote><p><code>tf.Variable.init(initial_value, trainable=True, collections=None, validate_shape=True, name=None)</code></p><p>创建图变量，初始值为 initial_value</p></blockquote><h3 id="tf-SparseTensor"><a href="#tf-SparseTensor" class="headerlink" title="tf.SparseTensor"></a>tf.SparseTensor</h3><blockquote><p><code>tf.SparseTensor(indices, values, dense_shape)</code></p><ul><li>indices：2维int64张量，指定稀疏张量中非零值的位置</li><li>values：1维张量，提供indices中每个位置对应的值</li><li>dense_shape：稀疏张量的形状</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SparseTensor(indices=[[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">2</span>]], values=[<span class="number">1</span>, <span class="number">2</span>], dense_shape=[<span class="number">3</span>, <span class="number">4</span>])</div><div class="line">[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</div><div class="line"> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>]</div><div class="line"> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]]</div></pre></td></tr></table></figure><h3 id="tf-argmax"><a href="#tf-argmax" class="headerlink" title="tf.argmax"></a>tf.argmax</h3><blockquote><p><code>tf.arg_max(input, dimension, output_type=tf.int64, name=None)</code></p><p>给出某个tensor对象在某一维上的其数据最大值的索引值</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">arr = np.array([</div><div class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">    [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</div><div class="line">    [<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>],</div><div class="line">    [<span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span>]</div><div class="line">])</div><div class="line">tf.argmax(test, <span class="number">0</span>)<span class="comment"># array([3, 3, 1])</span></div><div class="line">tf.argmax(test, <span class="number">1</span>)<span class="comment"># array([2, 2, 0, 0])</span></div></pre></td></tr></table></figure><h3 id="tf-reduce-mean"><a href="#tf-reduce-mean" class="headerlink" title="tf.reduce_mean"></a>tf.reduce_mean</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x = tf.constant([[<span class="number">1.</span>, <span class="number">1.</span>], [<span class="number">2.</span>, <span class="number">2.</span>]])</div><div class="line">tf.reduce_mean(x)  <span class="comment"># 1.5, axis=None，对所有数字</span></div><div class="line">tf.reduce_mean(x, <span class="number">0</span>)  <span class="comment"># [1.5, 1.5],axis=0</span></div><div class="line">tf.reduce_mean(x, <span class="number">1</span>)  <span class="comment"># [1.,  2.],axis=1</span></div></pre></td></tr></table></figure><h3 id="tf-reduce-sum"><a href="#tf-reduce-sum" class="headerlink" title="tf.reduce_sum"></a>tf.reduce_sum</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x = tf.constant([[<span class="number">1.</span>, <span class="number">1.</span>], [<span class="number">2.</span>, <span class="number">2.</span>]])</div><div class="line">tf.reduce_sum(x)  <span class="comment"># 6.0, axis=None，对所有数字</span></div><div class="line">tf.reduce_sum(x, <span class="number">0</span>)  <span class="comment"># [3., 3.], axis=0</span></div><div class="line">tf.reduce_sum(x, <span class="number">1</span>)  <span class="comment"># [2., 4.], axis=1</span></div></pre></td></tr></table></figure><h3 id="tf-truncated-normal"><a href="#tf-truncated-normal" class="headerlink" title="tf.truncated_normal"></a>tf.truncated_normal</h3><blockquote><p><code>tf.truncated_normal(shape,mean=0.0, stddev=1.0, dtype=tf.float32, seed=None, name=None)</code></p><p>从截断的正态分布中输出形如 shape 的随机值：生成 (μ-2σ，μ+2σ) 之间的随机数</p></blockquote><h3 id="tf-random-normal"><a href="#tf-random-normal" class="headerlink" title="tf.random_normal"></a>tf.random_normal</h3><blockquote><p><code>tf.random_normal(shape, mean=0.0, stddev=1.0, dtype=tf.float32, seed=None, name=None)</code></p><p>按正太分布(μ,σ)生成形如 shape 的随机数</p></blockquote><h3 id="tf-constant"><a href="#tf-constant" class="headerlink" title="tf.constant"></a>tf.constant</h3><blockquote><p><code>tf.constant(value, dtype=None, shape=None, name=&#39;Const&#39;, verify_shape=False)</code></p><p>产生形如 shape 的常量 Tensor，可用于多偏执量初始化</p></blockquote><h3 id="tf-cast"><a href="#tf-cast" class="headerlink" title="tf.cast"></a>tf.cast</h3><blockquote><p><code>tf.cast(x, dtype, name=None)</code> 将 x 的数据类型转成 dtype</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">a = tf.Variable([<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>])</div><div class="line">b = tf.cast(a, dtype=tf.bool)</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">    sess.run(tf.initialize_all_variables())</div><div class="line">    print(sess.run(b))</div><div class="line"><span class="comment"># [True False False True]</span></div></pre></td></tr></table></figure><h3 id="tf-nn-conv2d"><a href="#tf-nn-conv2d" class="headerlink" title="tf.nn.conv2d"></a>tf.nn.conv2d</h3><blockquote><p>卷积函数 <code>tf.nn.conv2d(input, filter, strides, padding, use_cudnn_on_gpu=None, name=None)</code></p><ul><li>input: 要做卷积的输入图像，类型：Tensor [batch, in_height, in_width, in_channels]，含义：[训练一批 batch 个的图片，图片高度，宽度，颜色通道数]；</li><li>filter: 卷积核，类型：Tensor [filter_height, filter_width, in_channels, out_channels]，含义：[卷积核高度，宽度，颜色通道数，卷积核个数]</li><li>strides: 步长，一维Tensor，长度4，二维图片是[1, stride, stride, 1]</li><li>padding: 类型: String，’SAME’ 或 ‘VALID’ 其中之一，’SAME’检测图像边缘，’VALID’不检测图像边缘</li><li>use_cudnn_on_gpu: 类型：bool，是否用 cudnn 加速，默认是 true</li><li>Return: 返回值类型：feature map: Tensor [batch, height, width, channels]</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">i = tf.Variable([[</div><div class="line">    [[<span class="number">1.</span>], [<span class="number">2.</span>], [<span class="number">3.</span>]],</div><div class="line">    [[<span class="number">2.</span>], [<span class="number">1.</span>], [<span class="number">0.</span>]],</div><div class="line">    [[<span class="number">0.</span>], [<span class="number">3.</span>], [<span class="number">0.</span>]]</div><div class="line">]])</div><div class="line">j = tf.Variable([[</div><div class="line">    [[<span class="number">1.</span>]], [[<span class="number">2.</span>]]], </div><div class="line">    [[[<span class="number">3.</span>]], [[<span class="number">2.</span>]]</div><div class="line">]])</div><div class="line">sess = tf.InteractiveSession()</div><div class="line">sess.run(tf.global_variables_initializer())</div><div class="line">op = tf.nn.conv2d(i, j, strides=[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], padding=<span class="string">'VALID'</span>)</div><div class="line">print(sess.run(op))</div><div class="line"><span class="comment"># [[ [[13.] [11.]] </span></div><div class="line"><span class="comment">#    [[10.] [10.]] ]]</span></div></pre></td></tr></table></figure><h3 id="tf-nn-max-pool"><a href="#tf-nn-max-pool" class="headerlink" title="tf.nn.max_pool"></a>tf.nn.max_pool</h3><blockquote><p>最大池化层 <code>tf.nn.max_pool(value, ksize, strides, padding, name=None)</code>，用于对卷积层输出的 featrue map 提取局部最大值</p><ul><li>value: 池化层的输入；类型：feature map: Tensor [batch, height, width, channels]是卷积层的输出</li><li>ksize: 池化窗口的大小，四维向量，一般是 [1, height, width, 1]</li><li>strides: 步长，[1, stride, stride, 1]</li><li>padding: ‘VALID’ or ‘SAME’</li><li>return: Tensor，[batch, height, width, channels]</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">i = tf.Variable([[</div><div class="line">    [[<span class="number">1.</span>], [<span class="number">2.</span>], [<span class="number">3.</span>]],</div><div class="line">    [[<span class="number">2.</span>], [<span class="number">1.</span>], [<span class="number">0.</span>]],</div><div class="line">    [[<span class="number">0.</span>], [<span class="number">3.</span>], [<span class="number">0.</span>]]</div><div class="line">]])</div><div class="line">sess = tf.InteractiveSession()</div><div class="line">sess.run(tf.global_variables_initializer())</div><div class="line">op = tf.nn.max_pool(i, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], padding=<span class="string">'VALID'</span>)</div><div class="line">print(sess.run(op))</div><div class="line"><span class="comment"># [[ [[2.] [3.]]</span></div><div class="line"><span class="comment">#    [[3.] [3.]] ]]</span></div></pre></td></tr></table></figure><blockquote><p>tf.nn.avg_pool 对 feature_map 提取局部均值</p></blockquote><h3 id="tf-nn-softmax"><a href="#tf-nn-softmax" class="headerlink" title="tf.nn.softmax"></a>tf.nn.softmax</h3><blockquote><p><code>tf.nn.softmax(logits, axis=None, name=None)</code> 激活函数，将N*1的向量归一化为 (0, 1) 之间的值，将较大的量特征更加明显</p><ul><li>logits: 非空 Tensor</li><li>axis: 执行 softmax 的维度，默认是 -1，即最后一个维度</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">i = tf.Variable([<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>, <span class="number">4.</span>])</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">    sess.run(tf.global_variables_initializer())</div><div class="line">    op = tf.nn.softmax(i)</div><div class="line">    print(sess.run(op))</div><div class="line"><span class="comment"># [0.0320586  0.08714432 0.23688284 0.6439143 ]</span></div></pre></td></tr></table></figure><h3 id="tf-add-n"><a href="#tf-add-n" class="headerlink" title="tf.add_n"></a>tf.add_n</h3><blockquote><p><code>tf.add_n(inputs,name=None)</code>将列表里的元素相加，用于<code>inputs</code>是由<code>for</code>产生的情况下不方便直接相加</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tf.add_n([tf.nn.l2_loss(w) <span class="keyword">for</span> w <span class="keyword">in</span> X])</div></pre></td></tr></table></figure><h3 id="tf-matmul"><a href="#tf-matmul" class="headerlink" title="tf.matmul"></a>tf.matmul</h3><blockquote><p><code>tf.matmul(a, b, transpose_a=False, transpose_b=False, adjoint_a=False, adjoint_b=False, a_is_sparse=False, b_is_sparse=False, name=None)</code></p><p>矩阵乘法：a, b 必须是矩阵(维度大于2)，都可以通过相应参数进行转置或共轭，可以使用稀疏矩阵乘法提高效率</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">i = tf.Variable([</div><div class="line">    [<span class="number">1</span>, <span class="number">2</span>],</div><div class="line">    [<span class="number">2</span>, <span class="number">3</span>]</div><div class="line">])</div><div class="line">j = tf.Variable([</div><div class="line">    [<span class="number">2</span>, <span class="number">3</span>],</div><div class="line">    [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line">])</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">    sess.run(tf.global_variables_initializer())</div><div class="line">    op = tf.matmul(i, j)</div><div class="line">    print(sess.run(op))</div><div class="line"><span class="comment">#[ [4  7]</span></div><div class="line"><span class="comment">#  [7 12] ]</span></div></pre></td></tr></table></figure><h3 id="tf-multiply"><a href="#tf-multiply" class="headerlink" title="tf.multiply"></a>tf.multiply</h3><blockquote><p><code>tf.math.multiply(x, y, name=None)</code></p><p>x, y 对应位置值相乘</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">i = tf.Variable([<span class="number">1</span>, <span class="number">2</span>])</div><div class="line">j = tf.Variable([</div><div class="line">    [<span class="number">2</span>, <span class="number">1</span>],</div><div class="line">    [<span class="number">1</span>, <span class="number">3</span>]</div><div class="line">])</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">    sess.run(tf.global_variables_initializer())</div><div class="line">    print(sess.run(tf.multiply(i, j)))</div><div class="line"><span class="comment"># [[2 2]</span></div><div class="line"><span class="comment">#  [1 6]]</span></div></pre></td></tr></table></figure><h3 id="tf-reshape"><a href="#tf-reshape" class="headerlink" title="tf.reshape"></a>tf.reshape</h3><blockquote><p><code>tf.reshape(tensor, shape, name=None)</code></p><p>变形，<code>-1</code> 可以用来推测形状：[-1] 可以用来展开，[-1, 3]：分成 x 组，每组 3 个，[2, -1]：分成 2 组，每组 x 个</p></blockquote><h3 id="tf-nn-relu"><a href="#tf-nn-relu" class="headerlink" title="tf.nn.relu"></a>tf.nn.relu</h3><blockquote><p><code>tf.nn.relu(features, name=None)</code>激活函数，即 max(features, 0)，将矩阵中每行的<strong>负数</strong>置 0</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">i = tf.Variable([<span class="number">-1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">-2</span>])</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">    sess.run(tf.global_variables_initializer())</div><div class="line">    print(sess.run(tf.nn.relu(i)))</div><div class="line"><span class="comment"># [0 1 2 0]</span></div></pre></td></tr></table></figure><h3 id="tf-nn-dropout"><a href="#tf-nn-dropout" class="headerlink" title="tf.nn.dropout"></a>tf.nn.dropout</h3><blockquote><p><code>tf.nn.dropout(x, keep_prob, noise_shape=None, seed=None, name=None)</code> 防止过拟合，一般用在全连接层，随机扔掉一部分神经元。让神经元按激活值 <code>keep_prob</code> 活跃还是睡眠。</p><ul><li>x：输入</li><li>keep_prob：神经元被选中的概率，初始化 keep_prob 是一个占位符，keep_prob=tf.placeholder(tf.float32)</li></ul><p>train 的时候使用 dropout</p></blockquote><h3 id="cross-entropy"><a href="#cross-entropy" class="headerlink" title="cross_entropy"></a>cross_entropy</h3><blockquote><p>交叉熵：</p><script type="math/tex; mode=display">H(p,q)=-\sum_xp(x)logq(x)</script><p><code>p(x)</code>是样本的标签，<code>q(x)</code>是模型的预估结果</p><p>由来：交叉熵 - 样本熵(常数) = 相对熵 或 KL散度</p><script type="math/tex; mode=display">H(p,q)-H(p)=-\sum_x p(x)logq(x)+\sum_x p(x)logp(x)=\\-\sum_x p(x)(logq(x)-p(x))=-\sum_x p(x)log \frac{q(x)}{p(x)}</script><p><code>cross_entropy = -tf.reduce_sum(y_ * tf.log(y_conv))</code> 其中，<code>y_</code>是样本 label，<code>y_conv</code> 是模型的输出</p></blockquote><h3 id="feed-dict"><a href="#feed-dict" class="headerlink" title="feed_dict"></a>feed_dict</h3><blockquote><p>替换图中的某个 tensor 的值，可以用来设计图的输入 (替换开始声明的占位符)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">op = tf.multiply(a, <span class="number">3</span>)</div><div class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</div><div class="line">sess.run(op, feed_dict=&#123;a: <span class="number">5</span>&#125;)<span class="comment"># 将 a=5传给操作op</span></div></pre></td></tr></table></figure><h3 id="tf-SparseTensor-1"><a href="#tf-SparseTensor-1" class="headerlink" title="tf.SparseTensor"></a>tf.SparseTensor</h3><blockquote><p>稀疏张量：SparseTensor(indices, values, dense_shape)，即坐标，值，规模</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SparseTensor(indices=[[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">2</span>]], values=[<span class="number">1</span>, <span class="number">2</span>], dense_shape=[<span class="number">3</span>, <span class="number">4</span>])</div><div class="line">[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</div><div class="line"> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>]</div><div class="line"> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]]</div></pre></td></tr></table></figure><h3 id="tf-trace"><a href="#tf-trace" class="headerlink" title="tf.trace"></a>tf.trace</h3><blockquote><p>计算矩阵的迹：主对角线的总和</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x = tf.constant([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]])</div><div class="line">tf.trace(x)<span class="comment"># 15</span></div></pre></td></tr></table></figure><h3 id="tf-nn-l2-loss"><a href="#tf-nn-l2-loss" class="headerlink" title="tf.nn.l2_loss"></a>tf.nn.l2_loss</h3><blockquote><p>L2范数计算张量的误差值，对张量中每个元素平方求和，最后乘1/2</p><p><code>tf.nn.l2_loss([1.0, 2.0, 3.0])=7.0</code></p></blockquote><h3 id="tf-train-Saver"><a href="#tf-train-Saver" class="headerlink" title="tf.train.Saver"></a>tf.train.Saver</h3><blockquote><p><code>saver=tf.train.Saver(max_to_keep=5)</code>，创建Saver对象，用于保存训练好的模型，保存最后<code>max_to_keep</code>次的模型参数，用Saver对象保存模型：<code>saver.save(sess, pathd=&#39;&#39;, global_step=step)</code></p><p>保存的文件有四个：checkpoint，*.data，*.index，*.meta</p><p>权重参数在 .data文件中 </p></blockquote><h3 id="tf-floor"><a href="#tf-floor" class="headerlink" title="tf.floor"></a>tf.floor</h3><blockquote><p><code>tf.floor(x, name=None)</code>向下取整，x为张量</p></blockquote><h3 id="tf-assign-add"><a href="#tf-assign-add" class="headerlink" title="tf.assign_add"></a>tf.assign_add</h3><blockquote><p><code>tf.assign_add(ref, value)</code>，其中<code>ref</code>是可变的张量，</p></blockquote><h3 id="tf-Session-run"><a href="#tf-Session-run" class="headerlink" title="tf.Session.run"></a>tf.Session.run</h3><blockquote><p><code>tf.Session.run(fetches, feed_dict=None, options=None, run_metadata=None)</code> 计算<code>fetches</code>中的所有张量，返回值是张量的个数，其中<code>fetches</code>可以是一个张量，列表，元组</p></blockquote>]]></content>
      
      <categories>
          
          <category> tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tensorflow </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>skip-gram</title>
      <link href="/2018/12/16/skip-gram/"/>
      <url>/2018/12/16/skip-gram/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p>如何将一个词用向量表示呢？本文介绍我对<strong>word2vec</strong>的简单理解</p><h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><h3 id="sigmoid-函数"><a href="#sigmoid-函数" class="headerlink" title="sigmoid 函数"></a>sigmoid 函数</h3><blockquote><p>二分类的激活函数：</p><script type="math/tex; mode=display">\delta(x) = \frac{1}{1+e^{-x}}</script><p><strong>性质：</strong>值域 (0, 1)</p><script type="math/tex; mode=display">\delta'(x) = \delta(x)[1-\delta(x)]\\[log\delta(x)]' = 1-\delta(x)\qquad [log(1-\delta(x))]'=-\delta(x)</script></blockquote><a id="more"></a><h3 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a>逻辑回归</h3><blockquote><p>logistic回归，一种广义线性回归，解决二分类问题：{(x<sub>i</sub>, y<sub>i</sub>)}<sub>i</sub><sup>m</sup> 为二分类问题的样本数据，其中 <strong>x<sub>i</sub></strong>∈R<sup>n</sup>，y<sub>i</sub>∈{0, 1}</p><p>由sigmoid函数，对任意样本 <strong>x</strong>=(<em>x<sub>1</sub></em>, <em>x<sub>2</sub></em>,…, <em>x<sub>n</sub></em>)<sup>T</sup>，可将二分类问题的假设函数(hypothesis)写成</p><script type="math/tex; mode=display">h_\theta(x)=\delta(\theta_0+\theta_1x_1+\theta_2x_2+...+\theta_nx_n)</script><p>其中 <strong>θ</strong>=(θ<sub>0</sub>,θ<sub>1</sub>,…,θ<sub>n</sub>)<sup>T</sup>为待定参数，将<strong>x</strong>扩展为起始位置添加x<sub>0</sub>=1，则</p><script type="math/tex; mode=display">h_\theta(x)=\delta(\theta^Tx)=\frac{1}{1+e^{-\theta^Tx}}</script><p>去阈值<em>T</em>=0.5，则二分类的判别式为</p><script type="math/tex; mode=display">y=\begin{cases}1, & h_\theta(x)\ge0.5 \\0, & h_\theta(x)<0.5\end{cases}</script><p>如何求<strong>θ</strong>呢？一般先确定一个如下形式的损失函数，对其进行优化得到最优的参数<strong>θ<sup>*</sup></strong></p><script type="math/tex; mode=display">J(\theta)=\frac{1}{m}\sum_{i=1}^mcost(X_i,y_i)</script><p><em>cost(x<sub>i</sub>,y<sub>i</sub>)</em>通常取<strong>对数似然函数</strong></p><script type="math/tex; mode=display">cost(X_i,y_i)=\begin{cases}-\log(h_\theta(X_i)), & y_i=1\\-\log(1-h_\theta(X_i)), & y_i=0\end{cases}</script><p>写成整体式为</p><script type="math/tex; mode=display">cost(X_i, y_i)=-y_i\log(h_\theta(X_i))-(1-y_i)\log(1-h_\theta(X_i))</script></blockquote><h2 id="CBOW模型"><a href="#CBOW模型" class="headerlink" title="CBOW模型"></a>CBOW模型</h2><blockquote><p>Continuous Bag-of-Words Model，已知 w<sub>t</sub> 的上下文预测 w<sub>t</sub></p><p>目标函数</p><script type="math/tex; mode=display">L=\sum_{w\in C}\log p(w|Context(w))</script></blockquote><h3 id="网络结构"><a href="#网络结构" class="headerlink" title="网络结构"></a>网络结构</h3><ul><li><p>输入层</p><p>包含Context(w)中2c个词的词向量<strong>v</strong>(Context(w)<sub>1</sub>), <strong>v</strong>(Context(w)<sub>1</sub>),…,<strong>v</strong>(Context(w)<sub>2c</sub>)∈R<sup>m</sup></p></li><li><p>投影层</p><p>将输入层的2c个向量求和，即</p><script type="math/tex; mode=display">X_w=\sum_{i=1}^{2c}v(Context(w)_i)\in{R}^m</script><p><strong>X</strong><sub>w</sub> 即为网络的输入向量</p></li><li><p>输出层</p><p>Huffman树，叶子结点共N个，N为词典D的词数，非叶子结点N-1个，做二分类</p></li></ul><h2 id="Skip-gram-模型"><a href="#Skip-gram-模型" class="headerlink" title="Skip-gram 模型"></a>Skip-gram 模型</h2><blockquote><p>Continuous Skip-gram Model，已知 w<sub>t</sub> 预测 w<sub>t</sub> 的上下文</p></blockquote>]]></content>
      
      <categories>
          
          <category> mechine learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> word2vec </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>简单好用的lambda与Stream</title>
      <link href="/2018/09/18/lambda-introduce/"/>
      <url>/2018/09/18/lambda-introduce/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p><strong>lambda表达式</strong>是java8的新特性，使java在编程中更简单，代码更简洁可读，避免了冗长的内部类、匿名类，下面通过栗子看看lambda有哪些应用吧*^-^*</p><a id="more"></a><h2 id="ForEach-与-lambda"><a href="#ForEach-与-lambda" class="headerlink" title="ForEach 与 lambda"></a>ForEach 与 lambda</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, Integer&gt; items = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">items.put(<span class="string">"A"</span>, <span class="number">10</span>);</div><div class="line">items.put(<span class="string">"B"</span>, <span class="number">20</span>);</div><div class="line">items.put(<span class="string">"C"</span>, <span class="number">30</span>);</div><div class="line">items.put(<span class="string">"D"</span>, <span class="number">40</span>);</div><div class="line"><span class="comment">// 原来的写法</span></div><div class="line"><span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : items.entrySet()) &#123;</div><div class="line">System.out.println(<span class="string">"item : "</span> + entry.getKey() + <span class="string">"count : "</span> + entry.getValue());</div><div class="line">&#125;</div><div class="line"><span class="comment">// lambda</span></div><div class="line">items.forEach((k, v)-&gt;&#123;</div><div class="line">System.out.println(<span class="string">"item : "</span> + k + <span class="string">"count : "</span> + v);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">list.add(<span class="string">"A"</span>);</div><div class="line">list.add(<span class="string">"B"</span>);</div><div class="line">list.add(<span class="string">"C"</span>);</div><div class="line">list.add(<span class="string">"D"</span>);</div><div class="line">list.add(<span class="string">"E"</span>);</div><div class="line"><span class="keyword">for</span>(String item : list)&#123;</div><div class="line">    System.out.println(item);</div><div class="line">&#125;</div><div class="line"><span class="comment">// lambda 参数只有一个可以省略小括号，后面的表达式只有一句可以省略&#123;&#125;,return和分号</span></div><div class="line">list.forEach(x-&gt;System.out.println(x));</div><div class="line"><span class="comment">// 上一句的简写</span></div><div class="line">list.forEach(System.out::println);</div></pre></td></tr></table></figure><h2 id="匿名内部类-与-lambda"><a href="#匿名内部类-与-lambda" class="headerlink" title="匿名内部类 与 lambda"></a>匿名内部类 与 lambda</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"How a u..."</span>);</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">t.start();</div><div class="line"><span class="comment">// lamda</span></div><div class="line">Thread t1 = <span class="keyword">new</span> Thread(()-&gt;System.out.println(<span class="string">"I'm fine...thx"</span>));</div><div class="line">t1.start();</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">String[] arr = &#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;;</div><div class="line">List&lt;String&gt; list = Arrays.asList(arr);</div><div class="line"><span class="comment">// 匿名内部类</span></div><div class="line">Collections.sort(list, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String o1, String o2)</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> o1.compareTo(o2);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;);</div><div class="line"><span class="comment">// lambda</span></div><div class="line">Collections.sort(list, (s1, s2)-&gt;&#123;</div><div class="line"><span class="keyword">return</span> s1.compareTo(s2);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 当表达式只有一句时 return 可以省略</span></div><div class="line">Collections.sort(list, (s1, s2)-&gt;s1.compareTo(s2));</div></pre></td></tr></table></figure><h2 id="lambda语法"><a href="#lambda语法" class="headerlink" title="lambda语法"></a>lambda语法</h2><h3 id="一般语法"><a href="#一般语法" class="headerlink" title="一般语法"></a>一般语法</h3><blockquote><p>( 参数列表 )-&gt;{ 表达式语句 }</p><p><code>(Type parameter, Type parameter,...) -&gt; {statements...}</code></p></blockquote><h3 id="单参数"><a href="#单参数" class="headerlink" title="单参数"></a>单参数</h3><blockquote><p><code>parameter-&gt;{statements}</code></p><p>当 lambda 表达式的参数个数只有一个，可以省略小括号</p></blockquote><h3 id="单语句"><a href="#单语句" class="headerlink" title="单语句"></a>单语句</h3><blockquote><p><code>parameter-&gt;statement</code></p><p>当 lambda 表达式只有一条语句时，可以省略<strong>大括号，return 和结尾的分号</strong></p></blockquote><h3 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h3><blockquote><p><code>objectName::instanceMethod</code> 或<code>ClassName::staticMethod</code></p><p>把 lambda 表达式的参数直接当成 instanceMethod 或 staticMethod 的参数，比如<code>System.out::println</code>等同于<code>x-&gt;System.out.println(x)</code>，<code>Math::max</code>等同于<code>(x,y)-&gt;Math::max(x,y)</code></p><p><code>ClassName::instanceMethod</code>是<code>x-&gt;x.instanceMethod()</code>的简化，<strong>eg:</strong> <code>Student::getName</code>等同于<code>x-&gt;x.getName()</code>，<code>instanceMethod</code>是一个无参的函数</p></blockquote><h3 id="访问外部变量"><a href="#访问外部变量" class="headerlink" title="访问外部变量"></a>访问外部变量</h3><blockquote><p>只能访问外部变量，不能在 lambda 内部修改，编译器将隐式将外部变量当成 <strong>final</strong> 处理，匿名函数和 lambda 函数内对外部变量的访问是一样的，都是只能访问 final 修饰的，没有 final 修饰视为 final 修饰，不可改变值。</p></blockquote><h2 id="Stream-与-lambda"><a href="#Stream-与-lambda" class="headerlink" title="Stream 与 lambda"></a>Stream 与 lambda</h2><blockquote><p>流式处理Stream 是java8的新特性，大大简化了对集合的操作，本节只看<strong>顺序流式处理</strong>，请先看看下面的栗子*^-^*</p></blockquote><p><strong>找出集合中的偶数</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; nums = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</div><div class="line">List&lt;Integer&gt; evens = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"><span class="keyword">for</span> (<span class="keyword">final</span> <span class="keyword">int</span> n : nums) &#123;</div><div class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) &#123;</div><div class="line">evens.add(n);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// stream</span></div><div class="line">evens = nums.stream().filter(num-&gt;num%<span class="number">2</span> == <span class="number">0</span>).collect(Collectors.toList());</div><div class="line">evens.forEach(System.out::println);</div></pre></td></tr></table></figure><blockquote><p>上面的例子中，通过 stream() 将集合转成流，filter() 对流进行过滤，筛选后的结果由收集器 collect() 对结果进行封装处理</p></blockquote><p><img src="\images\java\stream.png" alt="stream"></p><h3 id="中间操作"><a href="#中间操作" class="headerlink" title="中间操作"></a>中间操作</h3><blockquote><p>我们先定义一个学生实体类，用来说明中间操作有什么应用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line"><span class="keyword">private</span> String name;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> score;</div><div class="line">    <span class="keyword">private</span> String school;</div><div class="line"><span class="keyword">private</span> String document;</div><div class="line"><span class="comment">//... Getters,Setters,Constructor等省略</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">List&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;Student&gt;() &#123;</div><div class="line">&#123;</div><div class="line">add(<span class="keyword">new</span> Student(<span class="number">2013201319</span>, <span class="string">"zcl"</span>, <span class="number">18</span>, <span class="number">100</span>, <span class="string">"HEU"</span>, <span class="string">"computer"</span>));</div><div class="line">add(<span class="keyword">new</span> Student(<span class="number">2013201320</span>, <span class="string">"zjm"</span>, <span class="number">20</span>, <span class="number">90</span>, <span class="string">"HEU"</span>, <span class="string">"computer"</span>));</div><div class="line">add(<span class="keyword">new</span> Student(<span class="number">2013201321</span>, <span class="string">"tyf"</span>, <span class="number">19</span>, <span class="number">95</span>, <span class="string">"HEU"</span>, <span class="string">"software"</span>));</div><div class="line">add(<span class="keyword">new</span> Student(<span class="number">2013201322</span>, <span class="string">"zzh"</span>, <span class="number">22</span>, <span class="number">97</span>, <span class="string">"HIT"</span>, <span class="string">"computer"</span>));</div><div class="line">        add(<span class="keyword">new</span> Student(<span class="number">2013201323</span>, <span class="string">"ggy"</span>, <span class="number">21</span>, <span class="number">89</span>, <span class="string">"HIT"</span>, <span class="string">"software"</span>));</div><div class="line">&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><h4 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h4><h5 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h5><blockquote><p>过滤姓名以<strong>‘z’</strong>开头的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Student&gt; z_list = students.stream().filter(stu-&gt;stu.getName()</div><div class="line">.charAt(<span class="number">0</span>) == <span class="string">'z'</span>).collect(Collectors.toList());</div></pre></td></tr></table></figure><h5 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h5><blockquote><p>找出偶数后去掉重复的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; evens = nums.stream().filter(num-&gt;num%<span class="number">2</span>==<span class="number">0</span>)</div><div class="line">.distinct().collect(Collectors.toList());</div></pre></td></tr></table></figure><h5 id="sort-amp-limit"><a href="#sort-amp-limit" class="headerlink" title="sort&amp;limit"></a>sort&amp;limit</h5><blockquote><p>找出成绩排名前三的同学</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Student&gt; scoreList = <span class="keyword">this</span>.students.stream().sorted((s1, s2)-&gt;</div><div class="line">s2.getScore() - s1.getScore()).limit(<span class="number">3</span>).collect(Collectors.toList());</div></pre></td></tr></table></figure><h5 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h5><blockquote><p>找出成绩排名第三名以后的同学</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Student&gt; scoreList = <span class="keyword">this</span>.students.stream().sorted((s1, s2)-&gt;</div><div class="line">s2.getScore() - s1.getScore()).skip(<span class="number">3</span>).collect(Collectors.toList());</div></pre></td></tr></table></figure><h4 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h4><p><strong>当我们只想得到一个类的某一个属性值</strong></p><h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><blockquote><p>想筛选出所有成绩大于80分的同学的名字，总分和平均分 (mapToInt, mapToDouble)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; names = <span class="keyword">this</span>.students.stream().filter(s-&gt;s.getScore()&gt;<span class="number">80</span>)</div><div class="line">.map(Student::getName).collect(Collectors.toList());</div><div class="line"><span class="keyword">int</span> sum = <span class="keyword">this</span>.students.stream().mapToInt(Student::getScore).sum();</div><div class="line">OptionalDouble average_score = <span class="keyword">this</span>.students.stream().mapToDouble(Student::getScore).average();</div></pre></td></tr></table></figure><h5 id="flagMap"><a href="#flagMap" class="headerlink" title="flagMap"></a>flagMap</h5><blockquote><p>现在想求几个字符串中出现的字符，比如<code>String[] strs = {&quot;java&quot;, &quot;is&quot;, &quot;easy&quot;, &quot;to&quot;, &quot;use&quot;};</code>，用方法一，先将集合中的每个字符串分解成字符数组，在 <strong>distinct</strong> 操作是在字符数组之间找的，不是以字符为单位；方法二，<strong>flagMap</strong> 将一个流中每个值都转成一个个流，然后再将这些流扁平化成为一个流，这样可以达到目的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方法一</span></div><div class="line">Arrays.stream(strs).map(s-&gt;s.split(<span class="string">""</span>))</div><div class="line">.distinct().collect(Collectors.toList()).forEach(l-&gt;&#123;</div><div class="line">Arrays.asList(l).forEach(s -&gt; System.out.print(s + <span class="string">" "</span>));</div><div class="line">System.out.println();</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 方法二</span></div><div class="line">Arrays.stream(strs).map(s-&gt;s.split(<span class="string">""</span>))</div><div class="line">.flatMap(Arrays::stream).distinct().sorted().</div><div class="line">    collect(Collectors.toList()).forEach(l-&gt;&#123;</div><div class="line">Arrays.asList(l).forEach(s-&gt; System.out.print(s + <span class="string">" "</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h4 id="终端操作"><a href="#终端操作" class="headerlink" title="终端操作"></a>终端操作</h4><h5 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h5><ul><li>allMatch：检测是否全部满足指定的参数行为，如果全部满则返回 true，否则返回 false</li><li>anyMatch：检测是否存在满足条件</li><li>noneMatch：是否不存在</li><li>findFirst：找第一</li><li>findAny：找任意一个（顺序流式处理中，findFirst 和 findAny 返回的结果是一样的）</li></ul><h5 id="归约"><a href="#归约" class="headerlink" title="归约"></a>归约</h5><p><strong>reduce方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 非reduce写法</span></div><div class="line"><span class="keyword">int</span> totalAge = <span class="keyword">this</span>.students.stream()</div><div class="line">.filter(s-&gt;s.getAge()&gt;<span class="number">18</span>)</div><div class="line">.mapToInt(Student::getAge).sum();</div><div class="line"><span class="comment">// 规约操作</span></div><div class="line"><span class="keyword">int</span> totalAge1 = <span class="keyword">this</span>.students.stream().filter(s-&gt;s.getAge()&gt;<span class="number">18</span>)</div><div class="line">.mapToInt(Student::getAge).reduce(<span class="number">0</span>, (a, b)-&gt;a + b);</div><div class="line"><span class="keyword">int</span> totalAge2 = <span class="keyword">this</span>.students.stream().filter(s-&gt;s.getAge()&gt;<span class="number">18</span>)</div><div class="line">.map(Student::getAge).reduce(<span class="number">0</span>, Integer::sum);</div><div class="line">Optional&lt;Integer&gt; totalAge3 = <span class="keyword">this</span>.students.stream()</div><div class="line">    .filter(s-&gt;s.getAge()&gt;<span class="number">18</span>)</div><div class="line">.map(Student::getAge).reduce(Integer::sum);</div></pre></td></tr></table></figure><h5 id="收集"><a href="#收集" class="headerlink" title="收集"></a>收集</h5><blockquote><p>经过中间操作处理后结果的封装，比如<code>collect(Collectors.toList())</code>，类似的还有 <code>toSet``toMap</code>，这些方法都来自于 <code>java.util.stream.Collectors</code>这个收集器</p><p>下面的栗子是相同功能的不同写法（<strong>“回”</strong>字的不同写法）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 及格学生总数</span></div><div class="line"><span class="keyword">long</span> a = <span class="keyword">this</span>.students.stream().filter(s-&gt;s.getScore()&gt;<span class="number">60</span>).collect(Collectors.counting());</div><div class="line"><span class="keyword">long</span> b = <span class="keyword">this</span>.students.stream().filter(s-&gt;s.getScore()&gt;<span class="number">60</span>).count();</div><div class="line"><span class="comment">// 最高分，最低分</span></div><div class="line">Optional&lt;Student&gt; maxScore = <span class="keyword">this</span>.students.stream()</div><div class="line">.collect(Collectors.maxBy((s1, s2)-&gt;s1.getScore()-s2.getScore()));</div><div class="line">Optional&lt;Student&gt; maxScore = <span class="keyword">this</span>.students.stream()</div><div class="line">.collect(Collectors.maxBy(Comparator.comparing(Student::getScore)));</div><div class="line">Optional&lt;Student&gt; maxScore = <span class="keyword">this</span>.students.stream()</div><div class="line">.collect(Collectors.minBy(Comparator.comparing(Student::getScore)));</div><div class="line"><span class="comment">// 总分和平均分</span></div><div class="line"><span class="keyword">int</span> totalScore = <span class="keyword">this</span>.students.stream().collect(Collectors.summingInt(Student::getScore));</div><div class="line"><span class="keyword">double</span> averageScore = <span class="keyword">this</span>.students.stream()</div><div class="line">.collect(Collectors.averagingInt(Student::getScore));</div><div class="line"><span class="comment">// 一次性统计得到元素个数、总和、均值、最大值、最小值（这封装的也是够了）</span></div><div class="line">IntSummaryStatistics statistics = <span class="keyword">this</span>.students.stream()</div><div class="line">.collect(Collectors.summarizingInt(Student::getScore));</div><div class="line"><span class="comment">// 字符串拼接</span></div><div class="line">String names = <span class="keyword">this</span>.students.stream().map(Student::getName)</div><div class="line">.collect(Collectors.joining());</div><div class="line">String names1 = <span class="keyword">this</span>.students.stream().map(Student::getName)</div><div class="line">.collect(Collectors.joining(<span class="string">", "</span>));<span class="comment">// 用", "分隔名字</span></div></pre></td></tr></table></figure><h6 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 按学校对集合分组</span></div><div class="line">Map&lt;String, List&lt;Student&gt;&gt; groups = <span class="keyword">this</span>.students.stream().collect(Collectors.groupingBy(Student::getSchool));</div><div class="line">groups.forEach((k, v)-&gt;&#123;</div><div class="line">System.out.println(k); </div><div class="line">v.forEach(x-&gt;System.out.print(x.getName() + <span class="string">" "</span>));</div><div class="line">    System.out.println();</div><div class="line">&#125;);</div></pre></td></tr></table></figure><blockquote><p>groupingBy 接收一个分类器<code>Function&lt;? super T, ? extends K&gt; classifier</code>，可以一级或多级分类，如：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, Map&lt;String, List&lt;Student&gt;&gt;&gt; group = <span class="keyword">this</span>.students.stream().collect(</div><div class="line">Collectors.groupingBy(Student::getSchool,</div><div class="line">Collectors.groupingBy(Student::getDocument)));</div></pre></td></tr></table></figure><blockquote><p>groupingBy 的第二个参数可以传递任意 Collector 类型，如 <code>Collectors.groupingBy</code>，<code>Collectors.counting</code>，如果不添加第二个参数，默认是<code>Collectors.toList</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 集合中一个学校的人数，按学校分组后统计组内人数</span></div><div class="line">Map&lt;String, Long&gt; groups = <span class="keyword">this</span>.students.stream().collect(</div><div class="line">Collectors.groupingBy(Student::getSchool, Collectors.counting()));</div></pre></td></tr></table></figure><h6 id="区分"><a href="#区分" class="headerlink" title="区分"></a>区分</h6><blockquote><p>区分是分组的一种特殊情况，将集合内容分为 true, flase 两类，比如求男女人数；下面是区分的两种写法，用 groupingBy 和 partitioningBy 都能实现</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 求集合中学生是HEU 和不是 HEU 的人数（列表）</span></div><div class="line">Map&lt;Boolean, Long&gt; groups = <span class="keyword">this</span>.students.stream().collect(</div><div class="line">    Collectors.groupingBy(x-&gt;x.getSchool().equals(<span class="string">"HEU"</span>), Collectors.counting()));</div><div class="line">Map&lt;Boolean, List&lt;Student&gt;&gt; partition = <span class="keyword">this</span>.students.stream().collect(</div><div class="line">Collectors.partitioningBy(stu-&gt;<span class="string">"HEU"</span>.equals(stu.getSchool())));</div></pre></td></tr></table></figure><h2 id="并行流式数据处理"><a href="#并行流式数据处理" class="headerlink" title="并行流式数据处理"></a>并行流式数据处理</h2><blockquote><p>充分利用计算机的CPU内核数，并发处理的思想。将 stream() 替换成 parallelStream()即可，但会涉及多线程安全问题，当然效率提高的很多。</p></blockquote><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://www.cnblogs.com/aoeiuv/p/5911692.html" target="_blank" rel="external">java8 新特性 lamda和Stream</a></p><p><a href="https://www.cnblogs.com/shenlanzhizun/p/6027042.html" target="_blank" rel="external">Java8 新特性之流式数据处理</a></p>]]></content>
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>jvm gc</title>
      <link href="/2018/08/20/jvm-gc/"/>
      <url>/2018/08/20/jvm-gc/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><blockquote><p>JavaGC (Garbage Collection, 垃圾收集) 机制，下面介绍的是 HotSpot 的 GC 机制。Java GC 机制可以自动的回收内存，保证 JVM 中的内存空间充足，防止内存泄漏溢出。对于一般的程序，Java GC 可以自动的完成绝大多数事情，然而，对于较大型的应用软件，需要对 JVM 进行优化，必须要清楚 Java GC 机制。</p></blockquote><h2 id="java-GC-要干啥"><a href="#java-GC-要干啥" class="headerlink" title="java GC 要干啥"></a>java GC 要干啥</h2><ol><li>确定哪些内存要回收</li><li>何时执行 GC</li><li>怎样执行 GC</li></ol><a id="more"></a><h2 id="JVM-内存区域的划分"><a href="#JVM-内存区域的划分" class="headerlink" title="JVM 内存区域的划分"></a>JVM 内存区域的划分</h2><p><img src="\images\java\jvm.png" alt="jvm"></p><ol><li><p>程序计数器 (Program Counter Register)</p></li><li><p>虚拟机栈 (JVM Stack)</p></li><li><p>本地方法栈 (Native Method Statck)</p></li><li><p>堆区 (Heap)</p></li><li><p>方法区 (Method Area)</p></li><li><p>直接内存 (Direct Memory)</p></li></ol><h2 id="java-对象的内存访问"><a href="#java-对象的内存访问" class="headerlink" title="java 对象的内存访问"></a>java 对象的内存访问</h2><h2 id="哪些内存需要回收"><a href="#哪些内存需要回收" class="headerlink" title="哪些内存需要回收"></a>哪些内存需要回收</h2><h2 id="何时触发-GC-和执行-GC-的方式"><a href="#何时触发-GC-和执行-GC-的方式" class="headerlink" title="何时触发 GC 和执行 GC 的方式"></a>何时触发 GC 和执行 GC 的方式</h2>]]></content>
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>singleton</title>
      <link href="/2018/08/18/singleton/"/>
      <url>/2018/08/18/singleton/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="多线程安全的单例模式"><a href="#多线程安全的单例模式" class="headerlink" title="多线程安全的单例模式"></a>多线程安全的单例模式</h1><p><em>某类只能有一个对象，构造函数为 private，通过静态成员变量和函数获得变量</em></p><h2 id="模式1"><a href="#模式1" class="headerlink" title="模式1"></a>模式1</h2><blockquote><p>类加载的时候直接 new 出静态对象，无法懒加载，降低内存的使用率</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line"><span class="comment">// 直接初始化一个实例对象</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</div><div class="line"><span class="comment">// 私有构造方法保证其他类对象不能直接 new 该对象的实例</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> instance;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><a id="more"></a><h2 id="模式2"><a href="#模式2" class="headerlink" title="模式2"></a>模式2</h2><blockquote><p>多线程创建实例，一个时刻只能有一个线程得到同步锁，但是，每次通过 getInstance 方法得到 singleton 实例都要获得锁，但是只有第一次创建锁才有意义，加锁是很耗时的操作</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">            instance = <span class="keyword">new</span> Singleton();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="模式3"><a href="#模式3" class="headerlink" title="模式3"></a>模式3</h2><blockquote><p>只有当 instance 为 null 时，才需要加锁，也只需创建一次实例，以后则无需加锁</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 先判断实例是否初始化</span></div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</div><div class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">                    instance = <span class="keyword">new</span> Singleton();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="模式4"><a href="#模式4" class="headerlink" title="模式4"></a>模式4</h2><blockquote><p>私有内部类；不用加锁，也能实现懒加载，最好的了吧</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Singleton s = <span class="keyword">new</span> Singleton();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getSingle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Inner.s;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> Concurrent </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>elastic search</title>
      <link href="/2018/08/09/elastic-search/"/>
      <url>/2018/08/09/elastic-search/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="文档搜索"><a href="#文档搜索" class="headerlink" title="文档搜索"></a>文档搜索</h1><h2 id="query-string-search"><a href="#query-string-search" class="headerlink" title="query string search"></a>query string search</h2><blockquote><p><code>GET (index/type)/_search(?parameter_name=parameter_value&amp;...)</code></p><p><code>()</code> 内为可选项，如无条件查询: <code>GET /_search</code></p><p><code>GET /_search?q=name:zjm&amp;sort=no:desc</code></p><p>当搜索条件复杂时构建 query string 很麻烦，生产环境很少使用</p></blockquote><a id="more"></a><h2 id="query-DSL"><a href="#query-DSL" class="headerlink" title="query DSL"></a>query DSL</h2><blockquote><p><strong>DSL</strong>: Domain Specified Language</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查询所有数据</span></div><div class="line">GET /index/<span class="built_in">type</span>/_search </div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span>: &#123;<span class="string">"match_all"</span>:&#123;&#125;&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment"># 条件查询，排序</span></div><div class="line">GET /index1/type1/_search</div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"match"</span>: &#123;</div><div class="line">      <span class="string">"name"</span>: <span class="string">"zjm"</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"sort"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="string">"age"</span>: &#123;</div><div class="line">        <span class="string">"order"</span>: <span class="string">"desc"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div><div class="line"><span class="comment"># 分页</span></div><div class="line">GET /_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span>: &#123;<span class="string">"match_all"</span>: &#123;&#125;&#125;,</div><div class="line">    <span class="string">"from"</span>: 1,<span class="comment"># 从第几条开始</span></div><div class="line">    <span class="string">"size"</span>: 2,<span class="comment"># 查询的数据个数</span></div><div class="line">    <span class="string">"sort"</span>: [</div><div class="line">        &#123;<span class="string">"age"</span>: <span class="string">"desc"</span>&#125;</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line"><span class="comment"># 查询部分字段</span></div><div class="line">GET _search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span>: &#123;<span class="string">"match_all"</span>: &#123;&#125;&#125;,</div><div class="line">    <span class="string">"_source"</span>: [<span class="string">"name"</span>, <span class="string">"age"</span>],</div><div class="line">    <span class="string">"sort"</span>: [</div><div class="line">        &#123;<span class="string">"age"</span>: <span class="string">"asc"</span>&#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="query-filter"><a href="#query-filter" class="headerlink" title="query filter"></a>query filter</h2><blockquote><p>过滤查询，是 query DSL 的补充，不进行匹配相关度计算</p><p>eg: 搜索 position 包含 java 且年龄在 22-24 之间</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">GET /index1/type1/_search</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "bool": &#123;# 多条件搜索</div><div class="line">      "must": [</div><div class="line">        &#123;"match": &#123;</div><div class="line">          "position": "java"</div><div class="line">        &#125;&#125;,</div><div class="line">        &#123;</div><div class="line">          "range": &#123;</div><div class="line">            "age": &#123;</div><div class="line">              "gte": 22,</div><div class="line">              "lte": 24</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">#</span><span class="bash"> 使用 Filter</span></div><div class="line">GET /index1/type1/_search</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "bool": &#123;</div><div class="line">      "must": [</div><div class="line">        &#123;"match": &#123;</div><div class="line">          "position": "java"</div><div class="line">        &#125;&#125;</div><div class="line">      ],</div><div class="line">      "filter": &#123;</div><div class="line">        "range": &#123;</div><div class="line">          "age": &#123;</div><div class="line">            "gte": 22,</div><div class="line">            "lte": 24</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><em>注：filter 在 must 的结果中进行过滤，filter中的字段不进行相关度计算</em></p><h2 id="full-text-search"><a href="#full-text-search" class="headerlink" title="full-text search"></a>full-text search</h2><blockquote><p>全文匹配：position 中含有 java 或 php 或 scale的，词与词之间属于独立的条件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">GET /index1/type1/_search</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "match": &#123;</div><div class="line">      "position": "java php scale"</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="phrase-search"><a href="#phrase-search" class="headerlink" title="phrase search"></a>phrase search</h2><blockquote><p>短语检索：position 含有 java developer 这个短语，只有 java 或者 developer 不行的呦</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">GET /index1/type1/_search</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "match_phrase": &#123;</div><div class="line">      "position": "java developer"</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="highlight-display"><a href="#highlight-display" class="headerlink" title="highlight display"></a>highlight display</h2><blockquote><p>高亮显示</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">GET /index1/type1/_search</div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "match": &#123;</div><div class="line">      "name": "zjm"</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  "highlight": &#123;</div><div class="line">    "fields":[</div><div class="line">      &#123;</div><div class="line">       "name" : &#123;&#125;</div><div class="line">      &#125;</div><div class="line">      ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> elk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticSearch </tag>
            
            <tag> kibana </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>producter&amp;consumer</title>
      <link href="/2018/07/18/producter-consumer/"/>
      <url>/2018/07/18/producter-consumer/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="生产者消费者"><a href="#生产者消费者" class="headerlink" title="生产者消费者"></a>生产者消费者</h1><h2 id="wait-amp-notifyAll"><a href="#wait-amp-notifyAll" class="headerlink" title="wait &amp; notifyAll"></a>wait &amp; notifyAll</h2><blockquote><p>使用 wait, notifyAll 实现生产者消费者问题，注意使用 while 判断容器的容量和 notifyAll 通知所有等待线程，notify只会唤醒一个线程，比如生产者将容器放满，又唤醒了一个生产者，使唤醒的生产者进入死循环，无法唤醒其他线程</p></blockquote><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.LinkedList;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyContainer1</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="keyword">private</span> LinkedList&lt;T&gt; lists = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line"><span class="keyword">final</span> <span class="keyword">private</span> <span class="keyword">int</span> MAX = <span class="number">10</span>;</div><div class="line"><span class="comment">// 生产者放入</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(T t)</span> </span>&#123;</div><div class="line"><span class="keyword">while</span> (lists.size() == MAX) &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="keyword">this</span>.wait();<span class="comment">// wait 一般外面都是 while，如果用if，且生产者唤醒生产者，会继续向下执行向容器中添加，导致超出最大容量</span></div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">lists.add(t);</div><div class="line"><span class="keyword">this</span>.notifyAll();<span class="comment">// 不能用notify!!! 通知所有等待线程，希望唤醒的是消费者</span></div><div class="line">&#125;</div><div class="line"><span class="comment">// 消费者取出</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">T t = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">while</span> (lists.size() == <span class="number">0</span>) &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="keyword">this</span>.wait();</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">t = lists.removeFirst();</div><div class="line"><span class="keyword">this</span>.notifyAll();<span class="comment">// 通知生产者线程进行生产</span></div><div class="line"><span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">MyContainer1&lt;String&gt; c = <span class="keyword">new</span> MyContainer1&lt;&gt;();</div><div class="line"><span class="comment">// 启动消费者线程</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">5</span>; j++) &#123;</div><div class="line">System.out.println(c.get());</div><div class="line">&#125;</div><div class="line">&#125;, <span class="string">"c"</span> + i).start();</div><div class="line">&#125;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">2</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"><span class="comment">// 启动生产者线程</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++) &#123;</div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">25</span>; j++) &#123;</div><div class="line">c.put(Thread.currentThread().getName() + <span class="string">" "</span> + j);</div><div class="line">&#125;</div><div class="line">&#125;, <span class="string">"p"</span> + i).start();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="ReentrantLock-amp-Condition"><a href="#ReentrantLock-amp-Condition" class="headerlink" title="ReentrantLock &amp; Condition"></a>ReentrantLock &amp; Condition</h2><blockquote><p>使用 <em>ReentrantLock</em> 和 <em>Condition</em> 实现P-C问题，能够控制哪些线程等待与唤醒，对于同一个锁，创建多个<em>Condition</em></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.LinkedList;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyContainer2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="keyword">private</span> LinkedList&lt;T&gt; lists = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line"><span class="keyword">final</span> <span class="keyword">private</span> <span class="keyword">int</span> MAX = <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line"><span class="keyword">private</span> Condition producer = lock.newCondition();</div><div class="line"><span class="keyword">private</span> Condition consumer = lock.newCondition();</div><div class="line"></div><div class="line"><span class="comment">// 生产者</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(T t)</span> </span>&#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">lock.lock();</div><div class="line"><span class="keyword">while</span> (lists.size() == MAX) &#123;</div><div class="line">producer.await();<span class="comment">// 满了生产者等待</span></div><div class="line">&#125;</div><div class="line">lists.add(t);</div><div class="line">consumer.signalAll();<span class="comment">// 唤醒消费者来取</span></div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">lock.unlock();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 消费者</span></div><div class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">T t = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">lock.lock();</div><div class="line"><span class="keyword">while</span> (lists.isEmpty()) &#123;</div><div class="line">consumer.await();<span class="comment">// 没有可以取的</span></div><div class="line">&#125;</div><div class="line">t = lists.removeFirst();<span class="comment">// 有则取走</span></div><div class="line">producer.signalAll();<span class="comment">// 通知生产者放</span></div><div class="line">&#125; <span class="keyword">catch</span>(InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">lock.unlock();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">MyContainer2&lt;String&gt; c = <span class="keyword">new</span> MyContainer2&lt;&gt;();</div><div class="line"><span class="comment">// 消费者线程 10*5，要小于生产者放入的个数</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">5</span>; j++) &#123;</div><div class="line">System.out.println(c.get());</div><div class="line">&#125;</div><div class="line">&#125;, <span class="string">"c"</span> + i).start();</div><div class="line">&#125;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">2</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"><span class="comment">// 生产者线程 2*25 要大于消费者取出的个数，如果小于消费者取出的个数，消费者会因取不到而死循环</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">2</span>; i++) &#123;</div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">25</span>; j++) &#123;</div><div class="line">c.put(Thread.currentThread().getName() + <span class="string">" "</span> + j);</div><div class="line">&#125;</div><div class="line">&#125;, <span class="string">"p"</span> + i).start();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> Concurrent </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>concurrent</title>
      <link href="/2018/07/14/concurrent/"/>
      <url>/2018/07/14/concurrent/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="java-并发处理"><a href="#java-并发处理" class="headerlink" title="java 并发处理"></a>java 并发处理</h1><h2 id="为什么要加锁"><a href="#为什么要加锁" class="headerlink" title="为什么要加锁"></a>为什么要加锁</h2><blockquote><p>下面的例子，自增操作不具备原子性，导致多个线程同时对 count 操作时相互影响，比如一次操作一个线程取到的 count 为100，当它完成 ++ 操作把 count 赋值为 101 的时候，可能覆盖掉了这期间别的线程对count 的操作，最后结果远小于100000</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"><span class="comment">// 加上 synchronized 后，线程依次执行run方法，不会相互影响</span></div><div class="line"><span class="keyword">public</span> <span class="comment">/*synchronized*/</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10000</span>;i++) &#123;</div><div class="line">count ++;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">T t = <span class="keyword">new</span> T();</div><div class="line">List&lt;Thread&gt; tl = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</div><div class="line">tl.add(<span class="keyword">new</span> Thread(t, <span class="string">"THREAD"</span> + i));</div><div class="line">&#125;</div><div class="line">tl.forEach((o)-&gt;o.start());</div><div class="line"><span class="comment">// 等待所有线程结束</span></div><div class="line">tl.forEach((o)-&gt;&#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">o.join();</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">System.out.println(t.count);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><a id="more"></a><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><blockquote><p>锁定堆内存中的对象，线程执行过程中一定要取到对象的🔒才能执行，否则等待当前线程释放对象的🔒并获取才能执行，语法：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Concurrent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            <span class="comment">// 要并发处理的代码</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// or 同步方法：函数内的所有代码都加锁</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 一下两种写法都是在静态函数中锁定对象的类</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span>(T.class)</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><em>注：</em></p><blockquote><ol><li><em>synchronized</em> 修饰的代码越少越好，不要包含无需并发处理的代码</li><li>锁定的是堆中的对象，不是栈中的引用，应该避免将锁定对象的引用变成另外的对象</li><li>不要以字符串常量做锁定对象：<code>String a=&quot;hello&quot;; String b=&quot;hello&quot;;</code> a 和 b 指向的同一个对象</li><li>对写方法加锁，读方法不加锁，容易产生脏读 (<em>dirtyRead</em>)（在没写完就读，读到的是过时的值）</li><li><em>synchronized</em> 获得的锁是可重入的：在一个类的同步方法 a() 调用该类（父类）中的另一个同步方法 b()，在这个线程已经拥有了对象的锁时候，再次申请的时候任然会得到该对象的锁。</li><li>线程执行过程中如果发生异常，默认情况锁会被释放</li></ol></blockquote><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><blockquote><p>volatile 关键字使一个变量在多个线程间可见</p><p>原理：A线程用到一个变量时，java 会在线程中保留一份copy，这样如果 B线程修改了该变量，则 A线程未必知道，使用 volatile 关键字可以让所有线程再去内存里读一下更新变量的值。</p><p><code>volatile boolean running = true;</code></p><p>volatile 不能保证多线程同时对一个变量修改带来的不一致问题，不能替代 synchronized，即只能保证可见性，不能保证原子性</p></blockquote><p><em>例如：</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> </span>&#123;</div><div class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> count = <span class="number">0</span>; </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) count++;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">T t = <span class="keyword">new</span> T();</div><div class="line">List&lt;Thread&gt; threads = <span class="keyword">new</span> ArrayList&lt;Thread&gt;();</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</div><div class="line">threads.add(<span class="keyword">new</span> Thread(t::m, <span class="string">"thread-"</span>+i));</div><div class="line">&#125;</div><div class="line">threads.forEach((o)-&gt;o.start());</div><div class="line">threads.forEach((o)-&gt;&#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">o.join();</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">System.out.println(t.count);</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>上面的例子输出的结果小于100000，因为多线程同时修改变量的值，即使随时都去内存里相互更新，但互相影响，解决办法是让 m() 前加上 synchronized 修饰。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*volatile*/</span> <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123; </div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)</div><div class="line">count++;</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>但 synchronized 效率不高，有没有更好的方法呢…</p></blockquote><h2 id="AtomicXXX"><a href="#AtomicXXX" class="headerlink" title="AtomicXXX"></a>AtomicXXX</h2><blockquote><p>AtomicXXX 类的方法都是原子性的，但是多个方法之间是不具备原子性的</p><p>AtomicXXX 效率很高，推荐使用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> </span>&#123;</div><div class="line"><span class="comment">// volatile int count = 0;</span></div><div class="line">AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123; </div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++)</div><div class="line">           <span class="comment">// while (count.get() &lt; 10000) 对于count 的 get 和 incrementAndGet() 之间不具有原子性，导致get的时候小于10000，但因为多线程共同increment可能使得最后结果大于100000</span></div><div class="line">count.incrementAndGet(); </div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">T t = <span class="keyword">new</span> T();</div><div class="line">List&lt;Thread&gt; threads = <span class="keyword">new</span> ArrayList&lt;Thread&gt;();</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">threads.add(<span class="keyword">new</span> Thread(t::m, <span class="string">"thread-"</span> + i));</div><div class="line">&#125;</div><div class="line">threads.forEach((o) -&gt; o.start());</div><div class="line">threads.forEach((o) -&gt; &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">o.join();</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">System.out.println(t.count);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="线程间通信"><a href="#线程间通信" class="headerlink" title="线程间通信"></a>线程间通信</h2><h3 id="Wait-amp-Notify"><a href="#Wait-amp-Notify" class="headerlink" title="Wait &amp; Notify"></a>Wait &amp; Notify</h3><blockquote><p><em>小故事</em>：厕所里只有一个坑，有很多人冲了进来上厕所，只有一个人占有了这个坑并锁上了门，其他人只能等待，处于<strong>就绪</strong>状态。<strong>就绪</strong>状态的线程是处于<strong>可运行线程池</strong>中的，<strong>就绪</strong>状态的线程除CPU之外，其他运行所需资源都已全部获得；那么厕所就是这个<strong>可运行线程池</strong>，等待的人就是就绪线程，一旦门开了，即有一个就绪线程可以运行；这把锁就相当于<em>synchronized</em> 锁住了坑这个对象，<strong>就绪</strong>状态的人持有资源但不能运行，无形中是一种浪费。那么，可不可以让他们先别持有资源了，先离开厕所回到座位去 <em>wait</em>（<strong>阻塞</strong>状态），等里面的人出来了再冲进去争抢呢？<strong>阻塞</strong>状态的线程释放占有的所有资源进入<strong>等待池</strong>中，这个状态是不能自己唤醒的，需要有人通知（<em>notify</em>）才被唤醒，节省了资源。</p><p>wait 会释放锁，线程进入阻塞态，前提是先获得锁，一般与 <em>synchronized</em> 配合使用，外面一般是 while</p><p>notify 不会释放锁，会唤醒 wait 的线程，不会立即释放锁；notify 只会唤醒一个等待（对象的）线程，notifyAll 会唤醒所有等待（对象的）线程，《Effective Java》中说永远使用 notifyAll 不要使用 notify。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">boolean</span> <span class="keyword">volatile</span> session = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">String <span class="keyword">volatile</span> content = <span class="string">""</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"></div><div class="line">T t = <span class="keyword">new</span> T();</div><div class="line"></div><div class="line"><span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</div><div class="line"></div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line">System.out.println(<span class="string">"t1 start"</span>);</div><div class="line"><span class="keyword">synchronized</span>(lock) &#123;</div><div class="line"><span class="keyword">while</span> (!t.session) &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">lock.wait();</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">System.out.println(t.content);</div><div class="line">System.out.println(<span class="string">"t2 end"</span>);</div><div class="line">lock.notifyAll();   <span class="comment">// 唤醒 t2</span></div><div class="line">&#125;</div><div class="line">&#125;, <span class="string">"t1"</span>).start();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">2</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line">System.out.println(<span class="string">"t2 start"</span>);</div><div class="line"><span class="keyword">synchronized</span> (lock) &#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">10</span>; i++) &#123;</div><div class="line">System.out.println(i);</div><div class="line"><span class="keyword">if</span> (i == <span class="number">5</span>) &#123;</div><div class="line">t.session = <span class="keyword">true</span>;</div><div class="line">lock.notifyAll(); <span class="comment">// 唤醒 t1</span></div><div class="line">t.content = <span class="string">"Hello "</span> + i;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">lock.wait();<span class="comment">// 释放锁</span></div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;, <span class="string">"t2"</span>).start();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="Latch"><a href="#Latch" class="headerlink" title="Latch"></a>Latch</h3><blockquote><p>wait 和 notify 通信过程比较繁琐，使用 Latch 代替 wait, notify来进行线程间的通知，好处是使通讯简单，可以指定等待时间</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T3</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">T3 t = <span class="keyword">new</span> T3();</div><div class="line">CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);<span class="comment">// latch的count值为1，下面自减为0可唤醒所有等待线程</span></div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line">System.out.println(<span class="string">"t1 start"</span>);</div><div class="line"><span class="keyword">if</span> (t.num != <span class="number">5</span>) &#123;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">latch.await();<span class="comment">// 等待，放弃锁</span></div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"t1 end"</span>);</div><div class="line">&#125;, <span class="string">"t1"</span>).start();</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line">System.out.println(<span class="string">"t2 start"</span>);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</div><div class="line">System.out.println(<span class="string">"t2:"</span> + i);</div><div class="line"><span class="keyword">if</span> (i == <span class="number">5</span>) &#123;</div><div class="line">latch.countDown();<span class="comment">// latch的count由1变0，唤醒t1</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"t2 end"</span>);</div><div class="line">&#125;, <span class="string">"t2"</span>).start();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><blockquote><p><em>ReentrantLock</em> 可以替代 <em>synchronized</em> 锁定 this 对象，锁定后必须要<strong>手动</strong>释放锁，经常在 finally 中进行锁的释放，synchronized 释放锁后随机选择等待的线程开始执行，<em>ReentrantLock</em> 可以指定为公平锁。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> </span>&#123;</div><div class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span> </span>&#123;</div><div class="line">lock.lock();<span class="comment">// 加锁</span></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</div><div class="line">System.out.println(i);</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">lock.unlock();<span class="comment">// 手动释放锁</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 同 synchronized void m2() &#123;&#125;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span> </span>&#123;</div><div class="line">lock.lock();</div><div class="line">System.out.println(<span class="string">"m2 start..."</span>);</div><div class="line">lock.unlock();</div><div class="line">&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">m3</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> isLocked = <span class="keyword">false</span>;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">isLocked = lock.tryLock(<span class="number">5</span>, TimeUnit.SECONDS);<span class="comment">// 尝试5s获得锁，获得不到返回false，继续向下执行</span></div><div class="line">System.out.println(<span class="string">"m2 start..."</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line"><span class="keyword">if</span> (isLocked)</div><div class="line">lock.unlock();</div><div class="line">&#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">T t = <span class="keyword">new</span> T();</div><div class="line"><span class="keyword">new</span> Thread(t::m1).start();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">e.printStackTrace();</div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> Thread(t::m2).start();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>当线程 t2 等待线程 t1，而线程t1长时间占用 cpu，可以手动让 t2 打断 t1，令 t2 执行。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">Thread t1 = <span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">lock.lock();</div><div class="line">TimeUnit.SECONDS.sleep(Integer.MAX_VALUE);</div><div class="line">&#125; <span class="keyword">catch</span>(InterruptedException e) &#123;</div><div class="line">System.out.println(<span class="string">"interrupted!"</span>);</div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">lock.unlock();</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">t1.start();</div><div class="line"><span class="comment">// 睡2s</span></div><div class="line">Thread t2 = <span class="keyword">new</span> Thread(()-&gt;&#123;</div><div class="line">    <span class="keyword">boolean</span> locked = lock.tryLock();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">lock.lockInterruptibly();</div><div class="line">System.out.println(Thread.currentThread().getName() + <span class="string">" start"</span>);</div><div class="line">TimeUnit.SECONDS.sleep(<span class="number">5</span>);</div><div class="line">&#125; <span class="keyword">catch</span>(InterruptedException e) &#123;</div><div class="line">System.out.println(<span class="string">"t2 interrupted"</span>);</div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line"><span class="keyword">if</span> (locked) lock.unlock();</div><div class="line">&#125;</div><div class="line">System.out.println(Thread.currentThread().getName() + <span class="string">" end"</span>);</div><div class="line">&#125;, <span class="string">"t2"</span>);</div><div class="line">t2.start();</div><div class="line"><span class="comment">// 睡2s</span></div><div class="line">t2.interrupt();</div></pre></td></tr></table></figure><blockquote><p>公平锁：唤醒等待线程按照先来先服务的机制而不是随机，当然公平会带来一定的负担</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T4</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock(<span class="keyword">true</span>); <span class="comment">//参数为true表示为公平锁</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">T4 t = <span class="keyword">new</span> T4();</div><div class="line">Thread t1 = <span class="keyword">new</span> Thread(t);</div><div class="line">Thread t2 = <span class="keyword">new</span> Thread(t);</div><div class="line">t1.start();</div><div class="line">t2.start();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</div><div class="line">lock.lock();</div><div class="line">System.out.println(Thread.currentThread().getName() + <span class="string">"获得锁"</span>);</div><div class="line">lock.unlock();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> Concurrent </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>elasticSearch kibana install in linux</title>
      <link href="/2018/05/06/elasticsearch-kibana-install/"/>
      <url>/2018/05/06/elasticsearch-kibana-install/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="Linux-安装-ES"><a href="#Linux-安装-ES" class="headerlink" title="Linux 安装 ES"></a>Linux 安装 ES</h1><blockquote><p>ES 6.3.x 要求 Linux 内核必须是 3.5+版本以上，不能用 root 用户启动</p><p><code>uname -a</code> 查看 linux 内核版本，低于3.5要升级内核，或者使用Centos7</p></blockquote><h2 id="升级内核"><a href="#升级内核" class="headerlink" title="升级内核"></a>升级内核</h2><ol><li><p>注册内核：</p><p><code>rpm –import http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7</code></p></li><li><p>下载内核安装包</p><p><code>rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm</code></p></li><li><p>安装内核新版本</p><p><code>yum --enablerepo=elrepo-kernel install kernel-lt -y</code></p></li><li><p>设置启动内核版本</p><p><code>vim /etc/grub.conf</code></p><p>修改为：default=0</p></li><li><p>重启系统让内核生效：<code>reboot</code>（还是直接用 Centos7 吧乖乖）</p></li></ol><a id="more"></a><blockquote><p>注意：</p><ol><li>高版本的内核对线程的内存资源需要更高的要求，要给虚拟机分配 1.5G 以上的内存</li><li>配置虚拟机网关，DNS，保证能连接外网</li></ol></blockquote><h2 id="为ES提供系统配置"><a href="#为ES提供系统配置" class="headerlink" title="为ES提供系统配置"></a>为ES提供系统配置</h2><blockquote><p>ES 在 Linux 安装部署需要系统为其提供若干系统配置，如：应用可启动的线程数，可以划分到的内存，最多可以创建的文件…</p></blockquote><ol><li><p>修改限制信息</p><blockquote><p>修改系统中允许应用创建最多文件个数的限制权限。Linux 默认限制应用最多创建 65535 个文件，但是 ES 至少需要65536 个文件的创建权限。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vi /etc/security/limits.conf</div><div class="line"><span class="meta">#</span><span class="bash"> 增加</span></div><div class="line">* soft nofile 65536</div><div class="line">* hard nofile 65536</div></pre></td></tr></table></figure></li><li><p>修改线程开启限制</p><blockquote><p>修改允许用户启动的进程开启多少线程，Linux 限制 root 用户开启的进程可以启动任意数量的线程，其他用户开启的进程可以开启 1024 个线程。修改限制数为 4096+。ES 至少需要4096的线程池预备</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vi /etc/security/limits.d/90-nproc.conf</div><div class="line"><span class="meta">#</span><span class="bash"> 修改下述内容</span></div><div class="line">*          soft    nproc     4096</div><div class="line">root       soft    nproc     unlimited</div><div class="line"><span class="meta">#</span><span class="bash"> 检查可开启的最大线程</span></div><div class="line">ulimit -u</div></pre></td></tr></table></figure><p><em>注：虚拟机内存是 1 G，最多能开启3000+个线程，不能满足ES的要求，所以要给虚拟机分配1.5G以上的内存</em></p></li><li><p>修改系统控制权限</p><blockquote><p>系统控制文件是管理系统中资源控制的配置文件，ES需要开辟一个65536字节以上空间的虚拟内存。Linux默认不允许任何用户和应用直接开辟虚拟内存</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysctl.conf</div><div class="line"><span class="meta">#</span><span class="bash"> 添加</span></div><div class="line">vm.max_map_count=655360</div><div class="line"><span class="meta">#</span><span class="bash"> 让 sysctl 配置生效</span></div><div class="line">sysctl -p</div></pre></td></tr></table></figure></li><li><p>安装JDK至少1.8.0_131+</p></li><li><p>解压ES：<code>tar -zxf elasticsearch-6.3.1.tar.gz</code></p><p><em>注：ES 不允许 root 用户启动，如果 ES 是通过 root 用户解压的，则所有者是 root 用户，需要将ES 应用所有者改为其他用户</em></p></li><li><p>修改所有者</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 先移动到普通用户路径下： </span></div><div class="line">mv <span class="comment">#path1 path2</span></div><div class="line">chown -R group.user elasticsearch... <span class="comment"># 无组用户的组名和用户名一致</span></div></pre></td></tr></table></figure></li><li><p>修改elasticsearch配置文件</p><p>设置可访问的客户端。0.0.0.0代表任意客户端访问。</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi config/elasticsearch.yml</div><div class="line"><span class="meta">#</span><span class="bash"> 修改下述内容</span></div><div class="line">network.host: 0.0.0.0</div></pre></td></tr></table></figure><ol><li>切换用户启动：<code>su zjm</code>，<code>cd elasticsearch/bin</code>，<code>./elasticsearch</code> 启动服务</li><li>测试连接：<code>curl http://ip:9200</code></li></ol><h1 id="Linux安装Kibana"><a href="#Linux安装Kibana" class="headerlink" title="Linux安装Kibana"></a>Linux安装Kibana</h1><p><em>是ES提供的一个Web的管理控制台，解压，启动即可，Kibana要求的环境配置是小于ES的</em></p><ol><li>tar -zxf kibana.tar.gz</li><li>修改 config/kibana.yml，增加：server.host: “0.0.0.0”</li><li>运行：<code>kibana_home/bin/kabana</code>‘</li><li>访问：<code>http://ip:5601</code></li></ol>]]></content>
      
      <categories>
          
          <category> elk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticSearch </tag>
            
            <tag> kibana </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>kibana command</title>
      <link href="/2018/04/08/kibana-command/"/>
      <url>/2018/04/08/kibana-command/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="Kibana-命令"><a href="#Kibana-命令" class="headerlink" title="Kibana 命令"></a>Kibana 命令</h1><h2 id="查看Kibana启动结果"><a href="#查看Kibana启动结果" class="headerlink" title="查看Kibana启动结果"></a>查看Kibana启动结果</h2><blockquote><p>浏览器访问：<code>http://ip:5601</code></p><p>进入 dev tools 模块，执行<code>GET _cluster/health</code></p><p>返回值中 status: </p><ol><li>green：每个索引的 primary shard 和 replica shard 都是 active 的</li><li>yellow：每个索引的 primary shard 都是 active 的，但部分的 replica shard 不是 active 的</li><li>red：不是所有的索引都是 primary shard 都是 active 状态的</li></ol></blockquote><a id="more"></a><h2 id="查看健康状态"><a href="#查看健康状态" class="headerlink" title="查看健康状态"></a>查看健康状态</h2><blockquote><p><code>GET _cat/health?v</code></p></blockquote><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">put /test_index</div><div class="line">&#123;</div><div class="line">  "settings":&#123;</div><div class="line">    "number_of_shards" : 2,</div><div class="line">    "number_of_replicas" : 1</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>ES 默认创建索引会分配 5 个 primary shard，并为每个 primary shard 分配一个 replica shard。<strong>限制：</strong>如果磁盘空间不足 15% 时不分配 replica shard，不足 5% 时不分配 primary shard</p><p>可以设置 primary shard 的个数和每个 primary shard 的 replica shard 的个数</p></blockquote><h3 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h3><blockquote><p>索引一旦创建，primary shard 数量不可变化，可以改变replica shard 的数量：</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PUT /test_index/_settings</div><div class="line">&#123;</div><div class="line">    <span class="string">"number_of_replicas"</span>: 2</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>一个主分片和他的备份分片不会在一个节点上，对于一个主分片的多个备份分片也不会在一个节点上（很好理解——<em>防止同时消失</em>）</p></blockquote><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><blockquote><p><code>DELETE /test_index,...</code>，逗号分隔索引</p></blockquote><h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><blockquote><p><code>GET _cat/indices?v</code></p></blockquote><h3 id="查看分片"><a href="#查看分片" class="headerlink" title="查看分片"></a>查看分片</h3><blockquote><p><code>GET _cat/shards?v</code></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 索引名  # 编号 # 主从                               # 所在节点</span></div><div class="line">index      shard prirep state   docs store ip        node</div><div class="line">test_index 3     r      STARTED    0  261b 127.0.0.1 uwrhdxH</div><div class="line">test_index 3     p      STARTED    0  261b 127.0.0.1 9kTJ5Qe</div><div class="line">test_index 1     r      STARTED    0  261b 127.0.0.1 uwrhdxH</div><div class="line">test_index 1     p      STARTED    0  261b 127.0.0.1 9kTJ5Qe</div><div class="line">test_index 2     p      STARTED    0  261b 127.0.0.1 uwrhdxH</div><div class="line">test_index 2     r      STARTED    0  261b 127.0.0.1 9kTJ5Qe</div><div class="line">test_index 4     p      STARTED    0  261b 127.0.0.1 uwrhdxH</div><div class="line">test_index 4     r      STARTED    0  261b 127.0.0.1 9kTJ5Qe</div><div class="line">test_index 0     p      STARTED    0  261b 127.0.0.1 uwrhdxH</div><div class="line">test_index 0     r      STARTED    0  261b 127.0.0.1 9kTJ5Qe</div></pre></td></tr></table></figure><blockquote><p>可以发现 test_index 索引有 5 个主分片，每个主分片都有一个备份分片，并且主从分片<strong>不在</strong>一个节点上，5 个 primary shard 必须<strong>全部</strong>活动才能正常使用，否则集群 state = <strong>red</strong></p></blockquote><p><em>注：ES 索引一旦建立，不可改变，即 primary shard 不变</em></p><h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><h3 id="新增-Document"><a href="#新增-Document" class="headerlink" title="新增 Document"></a>新增 Document</h3><blockquote><p>在索引中增加文档，如果增加的 document 对应的 index 不存在，自动创建，如果 index 存在， type 不存在也自动创建。</p></blockquote><ol><li><p>手动指定 id 的 Document</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> Put /index/<span class="built_in">type</span>/id &#123;field: value&#125;</span></div><div class="line">PUT /test_index/type1/1</div><div class="line">&#123;</div><div class="line">    "name": "zjm",</div><div class="line">    "remark": "IT boy",</div><div class="line">    "no": 1</div><div class="line">&#125;</div><div class="line"><span class="meta">#</span><span class="bash"> result:</span></div><div class="line">&#123;</div><div class="line">  "_index": "test_index", # document 的索引</div><div class="line">  "_type": "type1",</div><div class="line">  "_id": "1",</div><div class="line">  "_version": 1,</div><div class="line">  "result": "created",</div><div class="line">  "_shards": &#123;</div><div class="line">    "total": 2,# primary shard number</div><div class="line">    "successful": 2, </div><div class="line">    "failed": 0</div><div class="line">  &#125;,</div><div class="line">  "_seq_no": 1,</div><div class="line">  "_primary_term": 1</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p>自动生成 id</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># POST /index/type&#123;field: value&#125;</span></div><div class="line">POST /test_index/my_type</div><div class="line">&#123;</div><div class="line">    <span class="string">"name"</span>: <span class="string">"shaunjm"</span>,</div><div class="line">    <span class="string">"remark"</span>: <span class="string">"my blog"</span>,</div><div class="line">    <span class="string">"no"</span>: 2</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p><em>注：每个 index 里的 document 结构差异不要太大！</em></p><h3 id="查询-Document"><a href="#查询-Document" class="headerlink" title="查询 Document"></a>查询 Document</h3><ol><li><p>GET 查询（单数据）：<code>GET /index/type/id</code></p></li><li><p>GET /_mget 批量查询（效率高，比单数据查询，推荐）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">GET /_mget</div><div class="line">&#123;</div><div class="line">    <span class="string">"docs"</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="string">"_index"</span>: <span class="string">"..."</span>,</div><div class="line">            <span class="string">"_type"</span>: <span class="string">"..."</span>,</div><div class="line">            <span class="string">"_id"</span>: <span class="string">"..."</span></div><div class="line">        &#125;, &#123;&#125;, &#123;&#125;</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line"><span class="comment"># or</span></div><div class="line">GET /index/<span class="built_in">type</span>/_mget</div><div class="line">&#123;</div><div class="line">    <span class="string">"docs"</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="string">"_id"</span>: <span class="string">"..."</span></div><div class="line">        &#125;, &#123;&#125;, &#123;&#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><h3 id="替换-Document"><a href="#替换-Document" class="headerlink" title="替换 Document"></a>替换 Document</h3><blockquote><ol><li><p>替换 Document (全量替换)</p><p>语法同新增完全一样：<code>PUT /index/type/id {field:value}</code>，ES会先把原来 id 的文档标记为deleted，再新建，如果不存在 id 的数据则新增</p></li><li><p>PUT 的强制新增<code>PUT /index/type/id/_create {}</code> 或 <code>PUT /index/type/id?op_type=create {}</code>如果 id 已经存在则报错</p></li></ol></blockquote><h3 id="更新-Document"><a href="#更新-Document" class="headerlink" title="更新 Document"></a>更新 Document</h3><blockquote><p><code>POST /index/type/id {&quot;doc&quot;:{field: value}}</code></p><blockquote><blockquote><p>只更新 id 文档的部分字段，先将原文档标记为 deleted，再将新字段和未更新的字段合并组成新的文档并创建。</p></blockquote></blockquote></blockquote><h3 id="删除-Document"><a href="#删除-Document" class="headerlink" title="删除 Document"></a>删除 Document</h3><blockquote><p><code>DELETE /index/type/id</code>，标记文档为 deleted，不会直接物理删除，当 ES 存储空间不足时才会进行物理删除，状态标记为 deleted 的文档不会被查询搜索到</p></blockquote><h3 id="bulk-批处理增删改-Document"><a href="#bulk-批处理增删改-Document" class="headerlink" title="bulk 批处理增删改 Document"></a>bulk 批处理增删改 Document</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">POST /_bulk</div><div class="line">&#123;<span class="string">"create"</span>: &#123;<span class="string">"_index"</span>: <span class="string">"index1"</span>, <span class="string">"_type"</span>: <span class="string">"type1"</span>, <span class="string">"_id"</span>: <span class="string">"1"</span>&#125;&#125;</div><div class="line">&#123;<span class="string">"name"</span>: <span class="string">"zjm"</span>, <span class="string">"age"</span>: 10&#125;</div><div class="line">&#123;<span class="string">"index"</span>: &#123;<span class="string">"_index"</span>: <span class="string">"index1"</span>, <span class="string">"_type"</span>: <span class="string">"type1"</span>, <span class="string">"_id"</span>: <span class="string">"1"</span>&#125;&#125;</div><div class="line">&#123;<span class="string">"name"</span>: <span class="string">"zjm22333"</span>, <span class="string">"age"</span>: 15&#125;</div><div class="line">&#123;<span class="string">"update"</span>: &#123;<span class="string">"_index"</span>: <span class="string">"index1"</span>, <span class="string">"_type"</span>: <span class="string">"type1"</span>, <span class="string">"_id"</span>: <span class="string">"1"</span>, <span class="string">"_retry_on_conflict"</span>: 3&#125;&#125;</div><div class="line">&#123;<span class="string">"doc"</span>: &#123;<span class="string">"age"</span>: 18&#125;&#125;</div><div class="line">&#123;<span class="string">"delete"</span>: &#123;<span class="string">"_index"</span>: <span class="string">"index1"</span>, <span class="string">"_type"</span>: <span class="string">"type1"</span>, <span class="string">"_id"</span>: <span class="string">"1"</span>&#125;&#125;</div></pre></td></tr></table></figure><blockquote><p>2-3 行为强制新增，4-5 行为新增或全部替换，6-7 行为部分更新，8行为删除，一个文档的 json 中不能含有换行，不同的 json 串必须换行，这是为了字符串直接使用换行进行分隔，每一行为一个 json 对象，否则以 <code>{</code> 和 <code>}</code> 做分隔需要创建字符串数组，影响效率</p></blockquote><h3 id="Document-Routing"><a href="#Document-Routing" class="headerlink" title="Document Routing"></a>Document Routing</h3><blockquote><p>ES 将文档存放在 index 的哪个 primary shard 的路由机制：</p><p><code>primary shard = hash(routing)%numbe_of_primary_shards</code></p><p>其中，routing 默认为 Document 的 id，也可以手动指定：</p><p><code>PUT /index/type/id?routing=...</code></p><p>这样查询的时候也要带着 routing 值才能查询到，否则会按默认的 routing 值，即 id 进行计算</p><p>写操作：计算 routing 后决定写到哪个 primary shard 上， Primary shard 会自动同步对应的 replica shard；读操作：计算 routing 后决定读哪个 primary shard 或者对应的 replica shard，一个 primary shard 对应的 replica shard 越多，可选择的节点越多，并发性就越好</p></blockquote><h3 id="Document-读写流程"><a href="#Document-读写流程" class="headerlink" title="Document 读写流程"></a>Document 读写流程</h3><blockquote><ol><li><strong>读：</strong>客户端发送的请求会<strong>随机</strong>的发送到一个节点上，称为<strong>协调节点（coordinate node）</strong>，协调节点通过路由算法找到本次操作的 Document 所在的 shard，将请求转发 primary shard 或者对应的 replica shard（轮回策略或负载均衡），primary 或 replica shard 返回协调节点，协调节点再将相应返回给客户端</li><li><strong>写：</strong>同样是随机发送请求到协调节点，协调节点计算出 Document 所在的 shard 后，转发到 shard 所在节点，primary shard 处理完请求后会同步对应的 replica shard，同步数据完成，返回结果到协调节点再到客户端</li></ol></blockquote>]]></content>
      
      <categories>
          
          <category> elk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kibana </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>python-data-process</title>
      <link href="/2018/02/26/python-data-process/"/>
      <url>/2018/02/26/python-data-process/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>Python 科学计算中用到的数据处理，图像绘制的方法记录。好多不知道啥意思，先背住吧，用到的时候再找…Python 做科学计算东西挺多的，现在还不能自己掌握，得不断积累</p></blockquote><a id="more"></a><h1 id="随机生成正态分布的数据"><a href="#随机生成正态分布的数据" class="headerlink" title="随机生成正态分布的数据"></a>随机生成正态分布的数据</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">__author__ = <span class="string">'ZJM'</span></div><div class="line">__time__ = <span class="string">'2018/2/26 15:22'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> cholesky</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> matplotlib.mlab <span class="keyword">as</span> mlab</div><div class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> multivariate_normal</div><div class="line"><span class="keyword">from</span> sklearn.mixture <span class="keyword">import</span> GaussianMixture</div><div class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</div><div class="line"></div><div class="line">sampleNo = <span class="number">1000</span></div><div class="line"><span class="comment"># 一维正太分布</span></div><div class="line">mu = <span class="number">3</span></div><div class="line">sigma = <span class="number">15</span></div><div class="line">np.random.seed(<span class="number">0</span>)</div><div class="line">s = np.random.normal(mu, sigma, sampleNo)</div><div class="line">plt.subplot(<span class="number">221</span>)</div><div class="line">n, bins, patches = plt.hist(s, <span class="number">50</span>, normed=<span class="number">1</span>)</div><div class="line"><span class="comment"># add a best fit line</span></div><div class="line">line = mlab.normpdf(bins, mu, sigma)</div><div class="line">plt.plot(bins, line, <span class="string">'r--'</span>)</div><div class="line">plt.xlabel(<span class="string">'x'</span>)</div><div class="line">plt.ylabel(<span class="string">'y'</span>)</div><div class="line">plt.title(<span class="string">r'$\mu='</span> + str(mu) + <span class="string">'$, $\sigma='</span> + str(sigma) + <span class="string">'$'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 二维正态分布</span></div><div class="line">mu = np.array([<span class="number">1</span>, <span class="number">5</span>])</div><div class="line">sigma = np.array([[<span class="number">1</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1.5</span>]])</div><div class="line">R = cholesky(sigma)</div><div class="line">s = np.dot(np.random.randn(sampleNo, <span class="number">2</span>), R) + mu</div><div class="line">plt.subplot(<span class="number">222</span>)</div><div class="line">plt.plot(s[:, <span class="number">0</span>], s[:, <span class="number">1</span>], <span class="string">'+'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 三维正太分布</span></div><div class="line">mu = np.array([<span class="number">0</span>] * <span class="number">3</span>)</div><div class="line"><span class="comment"># sigma = np.array([[1, 1, 3], [1, 2, 1], [0, 0, 1]])</span></div><div class="line">sigma = np.diag((<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>))</div><div class="line">data = np.random.multivariate_normal(mu, sigma, <span class="number">500</span>)</div><div class="line">norm = multivariate_normal(mu, sigma)</div><div class="line">tau = norm.pdf(data)</div><div class="line">fig = plt.figure(figsize=(<span class="number">13</span>, <span class="number">7</span>), facecolor=<span class="string">'w'</span>)</div><div class="line">ax = fig.add_subplot(<span class="number">223</span>, projection=<span class="string">'3d'</span>)</div><div class="line">ax.scatter(data[:, <span class="number">0</span>], data[:, <span class="number">1</span>], data[:, <span class="number">2</span>], c=<span class="string">'b'</span>, s=<span class="number">30</span>, marker=<span class="string">'o'</span>, depthshade=<span class="keyword">True</span>)</div><div class="line">ax.set_xlabel(<span class="string">'X'</span>)</div><div class="line">ax.set_ylabel(<span class="string">'Y'</span>)</div><div class="line">plt.tight_layout()</div><div class="line">plt.show()</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scientific Computation </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>math basic</title>
      <link href="/2018/02/24/math-basic/"/>
      <url>/2018/02/24/math-basic/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>数学功底太差，概率论与数理统计、线性代数，大量概念理解不够，之前的强化记忆都为了应付考试，记题型、背步骤，现在用到数据处理和公式推导时发现都不会了。下面把一些用到的概念记录下，主要是看到的通俗的解释，直观形象的描述。尽量使概念活起来。<em>^ - ^</em></p></blockquote><a id="more"></a><h1 id="线代"><a href="#线代" class="headerlink" title="线代"></a>线代</h1><h2 id="最小二乘法"><a href="#最小二乘法" class="headerlink" title="最小二乘法"></a>最小二乘法</h2><h2 id="正交阵"><a href="#正交阵" class="headerlink" title="正交阵"></a>正交阵</h2><blockquote><p>n阶矩阵A，满足A<sup>T</sup>A=E，则A为正交阵</p><p>A=(a1,a2,…,an), A为正交阵，有：</p><p>ai<sup>T</sup>ai=1, ai<sup>T</sup>aj=0(i≠j)</p><p>即A的行(列)向量都是单位向量，且两两正交</p><p>单位向量保证A<sup>T</sup>A 对角线都是1，正交使得其他元素都是0</p><p>A, B 都是n阶正交阵，则A×B是正交阵</p></blockquote><h2 id="对称阵"><a href="#对称阵" class="headerlink" title="对称阵"></a>对称阵</h2><blockquote><p>协方差矩阵，二次型矩阵，无向图邻接矩阵都是对称阵</p><p>实对称阵不同特征值的特征向量正交</p><p>设A为n阶对称阵，则必有正交阵P，使得P<sup>-1</sup>AP = P<sup>T</sup>AP = Λ</p><p>其中P为A的特征向量组成的矩阵，Λ对角线上是A的特征值，即A为对称阵，做合同变换，特征值不变，A与Λ互为合同矩阵</p></blockquote><h2 id="正定阵"><a href="#正定阵" class="headerlink" title="正定阵"></a>正定阵</h2><blockquote><p>直观上：正定阵是一种实对称阵</p><p>对于n阶方阵A，若任意n阶非零向量x，都有x<sup>T</sup>Ax&gt;0，则称A是正定阵。</p><p>给定任意m×n的矩阵A，A<sup>T</sup>A一定是半正定对称方阵</p><p>对称阵A是正定阵，A特征值都为正，A的顺序主子式都为正</p></blockquote><h2 id="向量的导数"><a href="#向量的导数" class="headerlink" title="向量的导数"></a>向量的导数</h2><blockquote><p>问题：A为m×n的矩阵，<strong>x</strong>为n×1的列向量，则A<strong>x</strong>为m×1的列向量，记<strong>y</strong>=A<strong>x</strong>，<strong>y</strong>对<strong>x</strong>的偏导为A<sup>T</sup></p><p><img src="/images/math/v1.PNG" alt="向量偏导"></p><p><img src="/images/math/v2.PNG" alt="v2"></p></blockquote><h1 id="概率"><a href="#概率" class="headerlink" title="概率"></a>概率</h1><h2 id="期望"><a href="#期望" class="headerlink" title="期望"></a>期望</h2><blockquote><p>平均数的扩展</p><p>小学的时候，考语数外，三科一样重要，期末成绩三科求和除以3即可得到平均分。大学了，每科都有学分，学分大的更重要，在所有科目中占的比重就大。求平均分时就要带着权重啦。x<sub>k</sub> 的概率p<sub>k</sub> 就相当于它的权重。期望反应数据的平均水平。</p><p>离散型：</p><p><img src="https://gss3.bdstatic.com/-Po3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D111/sign=cdc6e7624ded2e73f8e9822db603a16d/08f790529822720ef74fea1c7ccb0a46f31fab57.jpg" alt="期望"></p><p>连续型：</p><p><img src="https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D149/sign=14ad9bc8afd3fd1f3209a63e094f25ce/dcc451da81cb39db20db6fb0d7160924ab183038.jpg" alt="期望"></p></blockquote><h2 id="方差"><a href="#方差" class="headerlink" title="方差"></a>方差</h2><blockquote><p>衡量随机变量或一组数据时离散程度</p><p>在统计描述中：</p><p><img src="https://gss2.bdstatic.com/9fo3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D113/sign=c388d5738013632711edc632a28ea056/023b5bb5c9ea15cee484a9a6bc003af33a87b233.jpg" alt="方差"></p><p>在概率分布中：</p><p>离散型：</p><p><img src="https://gss1.bdstatic.com/9vo3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D162/sign=c013f07cb51bb0518b24b72e047bda77/54fbb2fb43166d22262ee9ca402309f79052d217.jpg" alt=""></p><p>​    展开后：</p><p><img src="https://gss1.bdstatic.com/9vo3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D164/sign=025082edd758ccbf1fbcb13c2dd9bcd4/7c1ed21b0ef41bd51ce0c3ab57da81cb39db3d39.jpg" alt=""></p><p>连续型：</p><p><img src="https://gss1.bdstatic.com/9vo3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D308/sign=3501fe127ccb0a4681228d395361f63e/b17eca8065380cd7a8d1be05a644ad345882810e.jpg" alt=""></p></blockquote><h2 id="协方差Cov"><a href="#协方差Cov" class="headerlink" title="协方差Cov"></a>协方差Cov</h2><blockquote><p>描述两个变量在变化过程中同向还是反向，及其程度。</p><p>你大我也大，同向，协方差为正</p><p>你大我小，反向，协方差为负</p><p>协方差数值绝对值越大则程度越强</p><p><img src="https://www.zhihu.com/equation?tex=Cov%28X%2CY%29%3DE%5B%28X-%5Cmu+_%7Bx%7D%29%28Y-%5Cmu+_%7By%7D%29%5D" alt="协方差公式"></p></blockquote><h2 id="相关系数ρ"><a href="#相关系数ρ" class="headerlink" title="相关系数ρ"></a>相关系数ρ</h2><blockquote><p><img src="https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=4253573177,2792087979&amp;fm=58" alt="img"></p><p>也可以反映两个变量变化时是同向还是反向，如果同向变化就为正，反向变化就为负。</p><p>由于除以了两个变量的标准差，消除了变化幅度的影响，只考虑变化率的相似程度</p></blockquote><h2 id="似然函数-Likehood-function"><a href="#似然函数-Likehood-function" class="headerlink" title="似然函数 Likehood function"></a>似然函数 Likehood function</h2><blockquote><p><strong>似然函数 </strong>是关于统计模型中的<strong>参数</strong>的函数</p><p>给定输出 <strong>x</strong> 时，关于参数θ的似然函数L(θ|x)=P(X=x|θ)</p><p>概率描述了已知参数时的随机变量的输出结果；似然描述已知随机变量输出结果时，未知参数的可能取值</p></blockquote><ul><li><p>离散型</p><p>L(θ|x) = P(X=x|θ) 或 P(X=x;θ)</p></li><li><p>连续型</p><p>L(θ|x) = f(x|θ)</p></li></ul><h2 id="求极大似然函数"><a href="#求极大似然函数" class="headerlink" title="求极大似然函数"></a>求极大似然函数</h2><blockquote><ol><li>写出似然函数</li><li>对似然函数取对数</li><li>求导数</li><li>解似然方程</li></ol></blockquote>]]></content>
      
      <categories>
          
          <category> mechine learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> statistic </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>backtracking questions</title>
      <link href="/2018/02/23/backtracking-questions/"/>
      <url>/2018/02/23/backtracking-questions/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="回溯法求幂集、排列组合、回文区分"><a href="#回溯法求幂集、排列组合、回文区分" class="headerlink" title="回溯法求幂集、排列组合、回文区分"></a>回溯法求幂集、排列组合、回文区分</h1><h2 id="幂集"><a href="#幂集" class="headerlink" title="幂集"></a>幂集</h2><h3 id="无重复元素发幂集"><a href="#无重复元素发幂集" class="headerlink" title="无重复元素发幂集"></a>无重复元素发幂集</h3><blockquote><p>Given a set of <strong>distinct</strong> integers, <em>nums</em>, return all possible subsets (the power set).</p><p><strong>Note:</strong> The solution set must not contain duplicate subsets.</p><p>For example,<br>If <strong>nums</strong> = <code>[1,2,3]</code>, a solution is:<code>[[3], [1], [2], [1,2,3], [1,3], [2,3], [1,2], []]</code></p></blockquote><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">subsets</span><span class="params">(self, nums)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :type nums: List[int]</span></div><div class="line"><span class="string">    :rtype: List[List[int]]</span></div><div class="line"><span class="string">    """</span></div><div class="line">    ans = []</div><div class="line">    l = len(nums)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">(tempList, start)</span>:</span></div><div class="line">        ans.append(tempList)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(start, l):</div><div class="line">            tempList.append(nums[i])</div><div class="line">            backtrack(tempList[:], i+<span class="number">1</span>)</div><div class="line">            tempList.pop()</div><div class="line"></div><div class="line">    backtrack([], <span class="number">0</span>)</div><div class="line">    <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><h3 id="存在重复元素的幂集"><a href="#存在重复元素的幂集" class="headerlink" title="存在重复元素的幂集"></a>存在重复元素的幂集</h3><blockquote><p>Given a collection of integers that might contain duplicates, <strong>nums</strong>, return all possible subsets (the power set).</p><p><strong>Note:</strong> The solution set must not contain duplicate subsets.</p><p>or example,<br>If <strong>nums</strong> = <code>[1,2,2]</code>, a solution is: <code>[[2], [1], [1,2,2], [2,2], [1,2], []]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">subsetWithDup</span><span class="params">(self, nums)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :type nums: List[int]</span></div><div class="line"><span class="string">    :rtype: List[List[int]]</span></div><div class="line"><span class="string">    """</span></div><div class="line">    l = len(nums)</div><div class="line">    ans = []</div><div class="line">    nums = sorted(nums)</div><div class="line">    tempList = []</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">(start)</span>:</span></div><div class="line">        ans.append(tempList[:])</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(start, l):</div><div class="line">            <span class="keyword">if</span> i &gt; start <span class="keyword">and</span> nums[i] == nums[i<span class="number">-1</span>]: <span class="comment"># skip duplicates</span></div><div class="line">                <span class="keyword">continue</span></div><div class="line">            tempList.append(nums[i])</div><div class="line">            backtrack(i+<span class="number">1</span>)</div><div class="line">            tempList.pop()</div><div class="line"></div><div class="line">    backtrack(<span class="number">0</span>)</div><div class="line">    <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><h2 id="全排列问题"><a href="#全排列问题" class="headerlink" title="全排列问题"></a>全排列问题</h2><h3 id="无重复元素的全排列"><a href="#无重复元素的全排列" class="headerlink" title="无重复元素的全排列"></a>无重复元素的全排列</h3><blockquote><p>Given a collection of <strong>distinct</strong> numbers, return all possible permutations.</p><p>For example,<br><code>[1,2,3]</code> have the following permutations:</p><p><code>[[1,2,3], [1,3,2], [2,1,3], [2,3,1], [3,1,2], [3,2,1]]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">permute</span><span class="params">(self, nums)</span>:</span></div><div class="line"><span class="string">"""</span></div><div class="line"><span class="string">    :type nums: List[int]</span></div><div class="line"><span class="string">    :rtype: List[List[int]]</span></div><div class="line"><span class="string">    """</span></div><div class="line">    l = len(nums)</div><div class="line">    ans = []</div><div class="line">    tempList = []</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">()</span>:</span></div><div class="line">        <span class="keyword">if</span> len(tempList) == l:</div><div class="line">            ans.append(tempList[:])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(l):</div><div class="line">                <span class="keyword">if</span> nums[i] <span class="keyword">in</span> tempList:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">                tempList.append(nums[i])</div><div class="line">                backtrack()</div><div class="line">                tempList.pop()</div><div class="line"></div><div class="line">    backtrack()</div><div class="line">    <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><h3 id="存在重复元素的全排列"><a href="#存在重复元素的全排列" class="headerlink" title="存在重复元素的全排列"></a>存在重复元素的全排列</h3><blockquote><p>Given a collection of numbers that might contain duplicates, return all possible unique permutations.</p><p>For example,<br><code>[1,1,2]</code> have the following unique permutations: <code>[[1,1,2], [1,2,1], [2,1,1]]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">permuteWithUnique</span><span class="params">(self, nums)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :type nums: List[int]</span></div><div class="line"><span class="string">    :rtype: List[List[int]]</span></div><div class="line"><span class="string">    """</span></div><div class="line">    nums = sorted(nums)</div><div class="line">    l = len(nums)</div><div class="line">    ans = []</div><div class="line">    tempList = []</div><div class="line">    used = [<span class="keyword">False</span>] * l</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">()</span>:</span></div><div class="line">        <span class="keyword">if</span> len(tempList) == l:</div><div class="line">            ans.append(tempList[:])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(l):</div><div class="line">                <span class="keyword">if</span> used[i] <span class="keyword">or</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> nums[i] == nums[i<span class="number">-1</span>] <span class="keyword">and</span> <span class="keyword">not</span> used[i<span class="number">-1</span>]:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">                used[i] = <span class="keyword">True</span></div><div class="line">                tempList.append(nums[i])</div><div class="line">                backtrack()</div><div class="line">                used[i] = <span class="keyword">False</span></div><div class="line">                tempList.pop()</div><div class="line"></div><div class="line">    backtrack()</div><div class="line">    <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><blockquote><p>Input:  <code>[3, 3, 0, 3]</code></p><p>Output: <code>[[0, 3, 3, 3], [3, 0, 3, 3], [3, 3, 0, 3], [3, 3, 3, 0]]</code></p></blockquote><h2 id="组合问题"><a href="#组合问题" class="headerlink" title="组合问题"></a>组合问题</h2><h3 id="元素可以用多次"><a href="#元素可以用多次" class="headerlink" title="元素可以用多次"></a>元素可以用多次</h3><blockquote><p>Given a <strong>set</strong> of candidate numbers (<strong>C</strong>) <strong>(without duplicates)</strong> and a target number (<strong>T</strong>), find all unique combinations in <strong>C</strong> where the candidate numbers sums to <strong>T</strong>.</p><p>For example, given candidate set <code>[2, 3, 6, 7]</code> and target <code>7</code>,<br>A solution set is:  <code>[ [7], [2, 2, 3] ]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">combinationSum</span><span class="params">(self, candidates, target)</span>:</span></div><div class="line">       <span class="string">"""</span></div><div class="line"><span class="string">       :type candidates: List[int]</span></div><div class="line"><span class="string">       :type target: int</span></div><div class="line"><span class="string">       :rtype: List[List[int]]</span></div><div class="line"><span class="string">       """</span></div><div class="line">       ans = []</div><div class="line">       l = len(candidates)</div><div class="line">       tempList = []</div><div class="line">       candidates = sorted(candidates)</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">(remain, start)</span>:</span></div><div class="line">           <span class="keyword">if</span> remain &lt; <span class="number">0</span>:</div><div class="line">               <span class="keyword">return</span></div><div class="line">           <span class="keyword">if</span> remain == <span class="number">0</span>:</div><div class="line">               ans.append(tempList[:])</div><div class="line">           <span class="keyword">else</span>:</div><div class="line">               <span class="keyword">for</span> i <span class="keyword">in</span> range(start, l):</div><div class="line">                   tempList.append(candidates[i])</div><div class="line">                   backtrack(remain-candidates[i], i)</div><div class="line">                   tempList.pop()</div><div class="line"></div><div class="line">       backtrack(target, <span class="number">0</span>)</div><div class="line">       <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><h3 id="元素只能用一次"><a href="#元素只能用一次" class="headerlink" title="元素只能用一次"></a>元素只能用一次</h3><blockquote><p>Given a collection of candidate numbers (<strong>C</strong>) and a target number (<strong>T</strong>), find all unique combinations in <strong>C</strong> where the candidate numbers sums to <strong>T</strong>.</p><p>Each number in <strong>C</strong> may only be used <strong>once</strong> in the combination.</p><p>For example, given candidate set <code>[10, 1, 2, 7, 6, 1, 5]</code> and target <code>8</code>,<br>A solution set is: </p><p><code>[[1, 7], [1, 2, 5], [2, 6], [1, 1, 6]]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">combinationSum2</span><span class="params">(self, candidates, target)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :type candidates: List[int]</span></div><div class="line"><span class="string">    :type target: int</span></div><div class="line"><span class="string">    :rtype: List[List[int]]</span></div><div class="line"><span class="string">    """</span></div><div class="line">    l = len(candidates)</div><div class="line">    ans = []</div><div class="line">    templist = []</div><div class="line">    candidates = sorted(candidates)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">(remain, start)</span>:</span></div><div class="line">        <span class="keyword">if</span> remain &lt; <span class="number">0</span>:</div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="keyword">if</span> remain == <span class="number">0</span>:</div><div class="line">            ans.append(templist[:])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(start, l):</div><div class="line">                <span class="keyword">if</span> i &gt; start <span class="keyword">and</span> candidates[i] == candidates[i<span class="number">-1</span>]:</div><div class="line">                    <span class="keyword">continue</span></div><div class="line">                templist.append(candidates[i])</div><div class="line">                backtrack(remain - candidates[i], i+<span class="number">1</span>)</div><div class="line">                templist.pop()</div><div class="line"></div><div class="line">    backtrack(target, <span class="number">0</span>)</div><div class="line">    <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><h2 id="找回文子集"><a href="#找回文子集" class="headerlink" title="找回文子集"></a>找回文子集</h2><blockquote><p>Given a string <em>s</em>, partition <em>s</em> such that every substring of the partition is a palindrome.</p><p>Return all possible palindrome partitioning of <em>s</em>.</p><p>For example, given <em>s</em> = <code>&quot;aab&quot;</code>,<br>Return <code>[[&quot;aa&quot;,&quot;b&quot;], [&quot;a&quot;,&quot;a&quot;,&quot;b&quot;]]</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">partition</span><span class="params">(self, s)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :type s: str</span></div><div class="line"><span class="string">    :rtype: List[List[str]]</span></div><div class="line"><span class="string">    """</span></div><div class="line">    l = len(s)</div><div class="line">    ans = []</div><div class="line">    tempList = []</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isPalindrome</span><span class="params">(low, high)</span>:</span></div><div class="line">        <span class="keyword">while</span> low &lt; high:</div><div class="line">            <span class="keyword">if</span> s[low] != s[high]:</div><div class="line">                <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">            low += <span class="number">1</span></div><div class="line">            high -= <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backtrack</span><span class="params">(start)</span>:</span></div><div class="line">        <span class="keyword">if</span> start == l:</div><div class="line">            ans.append(tempList[:])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(start, l):</div><div class="line">                <span class="keyword">if</span> isPalindrome(start, i):</div><div class="line">                    tempList.append(s[start: i+<span class="number">1</span>])</div><div class="line">                    backtrack(i+<span class="number">1</span>)</div><div class="line">                    tempList.pop()</div><div class="line"></div><div class="line">    backtrack(<span class="number">0</span>)</div><div class="line">    <span class="keyword">return</span> ans</div></pre></td></tr></table></figure><p><em>summary:</em></p><blockquote><p>我还没看懂… 以后再更新 -_-|||</p></blockquote><p><em>Copy from</em>：<a href="https://leetcode.com/problems/subsets/discuss/27281/A-general-approach-to-backtracking-questions-in-Java-(Subsets-Permutations-Combination-Sum-Palindrome-Partitioning" target="_blank" rel="external">https://leetcode.com/problems/subsets/discuss/27281/A-general-approach-to-backtracking-questions-in-Java-(Subsets-Permutations-Combination-Sum-Palindrome-Partitioning</a>)</p>]]></content>
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>java map-reduce</title>
      <link href="/2018/02/11/java-map-reduce/"/>
      <url>/2018/02/11/java-map-reduce/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="Java开发Map-Reduce程序"><a href="#Java开发Map-Reduce程序" class="headerlink" title="Java开发Map/Reduce程序"></a>Java开发Map/Reduce程序</h1><h2 id="MR程序执行方式："><a href="#MR程序执行方式：" class="headerlink" title="MR程序执行方式："></a>MR程序执行方式：</h2><ul><li>在本地运行，输入输出都在本地，用于调试程序</li><li>把远程数据拉到本地运行，输出传回远程，只适合数据量小</li><li>在远程运行，输入输出都在远程</li></ul><a id="more"></a><h2 id="Java程序在服务器上运行"><a href="#Java程序在服务器上运行" class="headerlink" title="Java程序在服务器上运行"></a>Java程序在服务器上运行</h2><ul><li><p>配置系统环境变量HADOOP_HOME，指向hadoop安装目录（如果你不想招惹不必要的麻烦，不要在目录中包含空格或者中文字符）</p><p>把HADOOP_HOME/bin加到PATH环境变量（非必要，只是为了方便）</p></li><li><p>如果是在windows下开发，需要添加windows的库文件</p><ul><li>把盘中共享的bin目录覆盖HADOOP_HOME/bin</li><li>如果还是不行，把其中的hadoop.dll复制到c:\windows\system32目录下，可能需要重启机器</li></ul></li></ul><h3 id="maven引入依赖"><a href="#maven引入依赖" class="headerlink" title="maven引入依赖"></a>maven引入依赖</h3><blockquote><p>新建项目，引入hadoop 所需要的jar文件</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">project.build.sourceencoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceencoding</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">hadoop.version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">hadoop.version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span></span></div><div class="line">    &lt;/dependency&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-hdfs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div></pre></td></tr></table></figure><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h4 id="WordMapper-java"><a href="#WordMapper-java" class="headerlink" title="WordMapper.java"></a>WordMapper.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt;</span>&#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, IntWritable&gt;.Context context)</span></span></div><div class="line"><span class="function"><span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line"><span class="keyword">final</span> IntWritable ONE = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</div><div class="line">String s = value.toString();</div><div class="line">String[] words = s.split(<span class="string">" "</span>);</div><div class="line"><span class="keyword">for</span>(String word: words) &#123;</div><div class="line">context.write(<span class="keyword">new</span> Text(word), ONE);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="WordReduce-java"><a href="#WordReduce-java" class="headerlink" title="WordReduce.java"></a>WordReduce.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">LongWritable</span>&gt;</span>&#123;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values,</span></span></div><div class="line"><span class="function"><span class="params">Reducer&lt;Text, IntWritable, Text, LongWritable&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</div><div class="line"><span class="keyword">long</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span>(IntWritable v: values) &#123;</div><div class="line">count += v.get();</div><div class="line">&#125;</div><div class="line">context.write(key, <span class="keyword">new</span> LongWritable(count));</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="main函数"><a href="#main函数" class="headerlink" title="main函数"></a>main函数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</div><div class="line">Configuration conf = <span class="keyword">new</span> Configuration();</div><div class="line">        conf.set(<span class="string">"fs.defaultFS"</span>, <span class="string">"hdfs://master:9000/"</span>);</div><div class="line">        <span class="comment">// 将项目打包到项目跟目录下</span></div><div class="line">        conf.set(<span class="string">"mapreduce.job.jar"</span>, <span class="string">"wc.jar"</span>);</div><div class="line">conf.set(<span class="string">"mapreduce.framework.name"</span>, <span class="string">"yarn"</span>);</div><div class="line">conf.set(<span class="string">"yarn.resourcemanager.hostname"</span>, <span class="string">"master"</span>);</div><div class="line">conf.set(<span class="string">"mapreduce.app-submission.cross-platform"</span>,<span class="string">"true"</span>);</div><div class="line">        Job job = Job.getInstance(conf);</div><div class="line">         </div><div class="line">        job.setMapperClass(WordMapper.class);</div><div class="line">        job.setReducerClass(WordReducer.class);</div><div class="line">        job.setMapOutputKeyClass(Text.class);</div><div class="line">        job.setMapOutputValueClass(IntWritable.class);</div><div class="line">        <span class="comment">// Reduce 的输出类型</span></div><div class="line">        job.setOutputKeyClass(Text.class);</div><div class="line">        job.setOutputValueClass(LongWritable.class);</div><div class="line">         </div><div class="line">        FileInputFormat.setInputPaths(job, <span class="string">"/input/"</span>);</div><div class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">"/output"</span>));</div><div class="line">         </div><div class="line">        job.waitForCompletion(<span class="keyword">true</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>注：</strong></p><blockquote><p>win系统的hosts文件添加虚拟机的IP和主机名</p><p>配置hadoop在win系统的环境变量</p><p>Run as —— Run Configurations —— Arguments —— VM arguments: <code>-DHADOOP_USER_NAME=root</code></p></blockquote>]]></content>
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Yarn&amp;Map/Reduce</title>
      <link href="/2018/02/09/Yarn-Map-Reduce/"/>
      <url>/2018/02/09/Yarn-Map-Reduce/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="分布式计算"><a href="#分布式计算" class="headerlink" title="分布式计算"></a>分布式计算</h1><blockquote><p>设计原则：移动计算，不移动数据</p></blockquote><h2 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h2><blockquote><p>Yarn: 资源调度</p><p>主从结构：ResourceManager 和 NodeManager</p><p>ResourceManager 将任务分配给空闲的机器(slave)工作，NodeManager在slave中做具体的资源利用，RM管理NM</p></blockquote><a id="more"></a><h3 id="yarn-site-xml的配置"><a href="#yarn-site-xml的配置" class="headerlink" title="yarn-site.xml的配置"></a>yarn-site.xml的配置</h3><blockquote><p>修改ResourceManager和NodeManager的<code>vim hadoop/etc/hadoop/yarn-site.xml</code></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </div><div class="line"> </div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.auxservices.mapreduce.shuffle.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure><h3 id="启动yarn集群"><a href="#启动yarn集群" class="headerlink" title="启动yarn集群"></a>启动yarn集群</h3><p><code>start-yarn.sh</code></p><blockquote><p>访问8088端口</p></blockquote><h2 id="Map-Reduce"><a href="#Map-Reduce" class="headerlink" title="Map/Reduce"></a>Map/Reduce</h2><blockquote><p>在 ResourceManager上配置mapred-site.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure><blockquote><p>执行示例程序</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hadoop jar /usr/local/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.3.jar wordcount /input/input.txt /output</div></pre></td></tr></table></figure><blockquote><p>查看运行结果</p><p><code>hadoop fs -text /output/part-r-00000</code></p></blockquote><h3 id="Map-Reduce-流程"><a href="#Map-Reduce-流程" class="headerlink" title="Map/Reduce 流程"></a>Map/Reduce 流程</h3><ul><li>input</li><li>split 拆分（一行一行）</li><li>map 映射（键值对）</li><li>shuffle 派发（键值对派发到一个nodeManager）</li><li>reduce 缩减（按键统计值的和）</li><li>output</li></ul>]]></content>
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>java hdfs</title>
      <link href="/2018/02/08/java-hdfs/"/>
      <url>/2018/02/08/java-hdfs/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="Java程序访问HDFS"><a href="#Java程序访问HDFS" class="headerlink" title="Java程序访问HDFS"></a>Java程序访问HDFS</h1><p>导入所需的jar文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-common --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.hadoop/hadoop-hdfs --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-hdfs<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> dbfs;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;</div><div class="line"><span class="keyword">import</span> java.math.BigDecimal;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FSDataOutputStream;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileStatus;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</div><div class="line"><span class="keyword">import</span> org.apache.hadoop.io.IOUtils;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloHDFS</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"><span class="comment">//URL.setURLStreamHandlerFactory(new FsUrlStreamHandlerFactory());</span></div><div class="line"><span class="comment">//URL url = new URL("hdfs://192.168.137.100:9000/hello.txt");</span></div><div class="line"><span class="comment">//InputStream in = url.openStream();</span></div><div class="line"><span class="comment">//IOUtils.copyBytes(in, System.out, 4096, true);</span></div><div class="line"></div><div class="line">Configuration conf = <span class="keyword">new</span> Configuration();</div><div class="line">conf.set(<span class="string">"fs.defaultFS"</span>, <span class="string">"hdfs://192.168.137.100:9000"</span>);</div><div class="line">      <span class="comment">// 修改hdfs配置参数值</span></div><div class="line">conf.set(<span class="string">"dfs.replication"</span>, <span class="string">"5"</span>);</div><div class="line">FileSystem fileSystem = FileSystem.get(conf);</div><div class="line"><span class="comment">// 判断路径是否存在</span></div><div class="line"><span class="keyword">boolean</span> success = fileSystem.exists(<span class="keyword">new</span> Path(<span class="string">"/zjm"</span>));</div><div class="line">System.out.println(success);</div><div class="line"><span class="comment">// 新建路径，注意如果已经存在同名目录会覆盖原目录x_x</span></div><div class="line">success = fileSystem.mkdirs(<span class="keyword">new</span> Path(<span class="string">"/zjm"</span>));</div><div class="line">System.out.println(success);</div><div class="line"><span class="comment">// 删除</span></div><div class="line">success = fileSystem.delete(<span class="keyword">new</span> Path(<span class="string">"/zjm"</span>), <span class="keyword">true</span>);</div><div class="line">System.out.println(success);</div><div class="line"><span class="comment">// 上传文件</span></div><div class="line">FSDataOutputStream out = fileSystem.create(<span class="keyword">new</span> Path(<span class="string">"/test.data"</span>));</div><div class="line">FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"F:learn/mashibing/hadoop/马士兵hadoop2.7入门_03.mp4"</span>);</div><div class="line">IOUtils.copyBytes(fis, out, <span class="number">4096</span>, <span class="keyword">true</span>);</div><div class="line">fileSystem.delete(<span class="keyword">new</span> Path(<span class="string">"/video"</span>), <span class="keyword">true</span>);</div><div class="line">      <span class="comment">// 上传文件：IO流可计算上传进度</span></div><div class="line">FSDataOutputStream out = fileSystem.create(<span class="keyword">new</span> Path(<span class="string">"/video"</span>));</div><div class="line">FileInputStream in = <span class="keyword">new</span> FileInputStream(<span class="string">"F:learn/mashibing/hadoop/马士兵hadoop2.7入门_03.mp4"</span>);</div><div class="line"><span class="keyword">int</span> total = in.available();</div><div class="line"><span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4096</span>];</div><div class="line"><span class="keyword">int</span> len = in.read(buf);</div><div class="line"><span class="keyword">int</span> now = len;</div><div class="line"><span class="keyword">while</span>(len != -<span class="number">1</span>) &#123;</div><div class="line"><span class="comment">// 上传百分比，保留小数点后两位</span></div><div class="line">System.out.println(<span class="keyword">new</span> BigDecimal((<span class="keyword">float</span>)now/total*<span class="number">100</span>).setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).doubleValue());</div><div class="line">out.write(buf, <span class="number">0</span>, len);</div><div class="line">len = in.read(buf);</div><div class="line">now += len;</div><div class="line">&#125;</div><div class="line">in.close();</div><div class="line">out.close();</div><div class="line"><span class="comment">// 查看文件结构</span></div><div class="line">FileStatus[] statuses = fileSystem.listStatus(<span class="keyword">new</span> Path(<span class="string">"/"</span>));</div><div class="line"><span class="keyword">for</span>(FileStatus status: statuses) &#123;</div><div class="line">System.out.println(status.getPath());</div><div class="line">System.out.println(status.getPermission());</div><div class="line">System.out.println(status.getReplication());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>注：</strong>需要关闭权限检查，向<code>hdfs-site.xml</code>中添加并重启hdfs</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure><p><em>description:</em></p><blockquote><p>If “true”, enable permission checking in HDFS. If “false”, permission checking is turned off, but all other behavior is unchanged. Switching from one parameter value to the other does not change the mode, owner or group of files or directories.</p></blockquote>]]></content>
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>hadoop hdfs</title>
      <link href="/2018/02/06/hadoop-hdfs/"/>
      <url>/2018/02/06/hadoop-hdfs/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="在多台服务器上配置Hadoop"><a href="#在多台服务器上配置Hadoop" class="headerlink" title="在多台服务器上配置Hadoop"></a>在多台服务器上配置Hadoop</h1><ul><li>启动namenode和datanode</li></ul><blockquote><p><code>hadoop-daemon.sh start namenode(datanode)</code></p></blockquote><ul><li>在master上检测datanode</li></ul><blockquote><p><code>hdfs dfsadmin -report | more</code></p></blockquote><ul><li>在web页面观察hadoop集群情况</li></ul><blockquote><p><code>192.168.137.100:50070</code></p></blockquote><a id="more"></a><h1 id="集中管理Slaves"><a href="#集中管理Slaves" class="headerlink" title="集中管理Slaves"></a>集中管理Slaves</h1><blockquote><p>在<code>/usr/local/hadoop/etc/hadoop</code>下的slaves文件中添加slaves的主机名，在master中就可以管理其中的所有slaves，如：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">slave1</div><div class="line">slave2</div><div class="line">slave3</div></pre></td></tr></table></figure><blockquote><p>执行：<code>start-dfs.sh</code>，输入master, slave, secondaryNameNode的密码</p><p>为了避免输入多次的密码，在 <code>/.ssh</code> 下执行 <code>ssh-keygen -t rsa</code></p><p>回车三次，发现.ssh下生成两个文件：<code>id_ras</code> （私钥）和 <code>id_ras.pub</code>（公钥）</p><p>从master发送公钥到master, slave1, slave2, slave3：<code>ssh-copy-id master</code>, <code>ssh-copy-id slave1</code>, <code>ssh-copy-id slave2</code>, <code>ssh-copy-id slave3</code> 以后<code>ssh IP</code> 就不用再输入密码了，再执行<code>start-dfs.sh</code>时就不用再次输入密码了</p></blockquote><h1 id="hdfs文件系统"><a href="#hdfs文件系统" class="headerlink" title="hdfs文件系统"></a>hdfs文件系统</h1><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><blockquote><p><code>hadoop fs -ls</code>或<code>hdfs dfs -ls</code></p><p>放置一个文件到hdfs中：<code>hadoop fs -put file /</code></p><p>通过网页观察现象：<code>http://192.168.137.100:50070/explorer.html#/</code></p><p>指令：</p><p><code>hadoop fs -mkdir /dirname</code></p><p><code>hadoop fs -text /filename</code> 查看文本文件内容</p><p><code>hadoop fs -rm /filename</code></p></blockquote><h2 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h2><blockquote><p>编写/hadoop/etc/hadoop/hdfs-site.xml</p><p><em>eg:</em> 修改复制的个数为2份（默认为3份）：</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>hadoop配置环境及启动</title>
      <link href="/2018/02/05/hadoop-day1/"/>
      <url>/2018/02/05/hadoop-day1/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><ul><li>VirtualBox启动虚拟机</li><li>host-only方式连接虚拟机</li><li>安装Hadoop</li></ul><h1 id="连接虚拟机"><a href="#连接虚拟机" class="headerlink" title="连接虚拟机"></a>连接虚拟机</h1><ul><li>查看虚拟网卡的IP地址(assume:192.168.137.1)，VM设置网卡类型为host-only</li></ul><ul><li><p>设置ipv4地址：<code>vim /etc/sysconfig/network-scripts/ifcfg-enp03</code></p><blockquote><p><code>IPADDR=192.168.137.100</code></p><p><code>NETMASK=255.255.255.0</code></p></blockquote></li><li><p>设置网关地址及域名解析：<code>vim /etc/sysconfig/network</code></p><blockquote><p><code>NETWORKING=yes</code></p><p><code>GATEWAY=192.168.137.1</code></p><p><code>DNS1=8.8.8.8</code></p></blockquote><p>设置计算机上能上网的网卡共享网络给虚拟网卡</p><a id="more"></a></li><li><p>修改主机名</p><blockquote><p><code>hostnamectl set-hostname master</code></p></blockquote></li><li><p>重启network服务</p><blockquote><p><code>service network restart</code></p></blockquote></li><li><p>互相ping</p><blockquote><p>虚拟机：<code>ping 192.168.137.1</code></p><p>电脑：<code>ping 192.168.137.100</code></p></blockquote></li></ul><h1 id="安装Hadoop"><a href="#安装Hadoop" class="headerlink" title="安装Hadoop"></a>安装Hadoop</h1><blockquote><p>打开Xftp上传jdk，hadoop安装文件至<code>/usr/local</code>目录下</p></blockquote><h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><blockquote><p><code>rpm -ivh jdk-8u91-linux-x64.rpm</code></p></blockquote><h2 id="解压hadoop"><a href="#解压hadoop" class="headerlink" title="解压hadoop"></a>解压hadoop</h2><blockquote><p><code>cd local</code></p><p><code>tar -xvf hadoop-2.7.3.tar.gz</code></p><p>发现local目录下多了hadoop-2.7.3的目录(改名为了方便：mv hadoop-2.7.3 haddop)</p></blockquote><h2 id="配置Hadoop-JDK路径"><a href="#配置Hadoop-JDK路径" class="headerlink" title="配置Hadoop JDK路径"></a>配置Hadoop JDK路径</h2><blockquote><p><code>cd hadoop/etc/hadoop</code></p><p><code>vim hadoop-env.sh</code></p><p><code>export JAVA_HOME=/usr/java/default</code></p></blockquote><h2 id="将hadoop执行命令添加到path环境变量里"><a href="#将hadoop执行命令添加到path环境变量里" class="headerlink" title="将hadoop执行命令添加到path环境变量里"></a>将hadoop执行命令添加到path环境变量里</h2><blockquote><p><code>vim /etc/profile</code></p><p>添加：<code>export PATH=$PATH:/usr/local/hadoop/bin:/usr/local/hadoop/sbin</code></p><p>执行： <code>source /etc/profile</code></p></blockquote><p><strong>以这台虚拟机做master，复制出三台虚拟机做slaver，配置IP和网关，改主机名分别为slave1, slave2, slave3</strong></p><h1 id="启动Hadoop"><a href="#启动Hadoop" class="headerlink" title="启动Hadoop"></a>启动Hadoop</h1><h2 id="配置所有虚拟机"><a href="#配置所有虚拟机" class="headerlink" title="配置所有虚拟机"></a>配置所有虚拟机</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/hadoop/etc/hadoop</div><div class="line">vim core-site.xml # master管理结点，slave知道master</div><div class="line"><span class="comment">&lt;!-- 在&lt;configuration&gt;内添加：--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure><blockquote><p>修改所有虚拟机的host文件</p><p><code>vim /etc/hosts</code></p></blockquote><p><em>eg</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">192.168.137.100 master</div><div class="line">192.168.137.101 slave1</div><div class="line">192.168.137.102 slave2</div><div class="line">192.168.137.103 slave3</div></pre></td></tr></table></figure><blockquote><p>格式化namenode(仅master)</p><p><code>hdfs namenode -format</code></p><p>启动namenode(仅master)</p><p><code>hadoop-daeman.sh start namenode</code></p><p>输入jps，出现NameNode则namenode启动</p><p>启动datanode(slaver)</p><p><code>hadoop-daemon.sh start datanode</code></p></blockquote>]]></content>
      
      <categories>
          
          <category> Big Data </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>laravel基础</title>
      <link href="/2017/09/13/laravel%E5%9F%BA%E7%A1%80/"/>
      <url>/2017/09/13/laravel%E5%9F%BA%E7%A1%80/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="安装错误"><a href="#安装错误" class="headerlink" title="安装错误"></a>安装错误</h2><p><img src="http://img.mukewang.com/59545e4a0001c20e05000115.jpg" alt="http://img.mukewang.com/59545e4a0001c20e05000115.jpg"></p><blockquote><p>solution:</p><p>打开运行环境中的php.ini，用快速查找找到 extension=php_openssl.dll 此项，然后把该代码前面的分号去掉，最后重启运行环境，刷新页面</p></blockquote><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><blockquote><p><strong>作用: 将请求映射到程序（处理函数）</strong></p><p><em>laravel/app/Http/routes.php:</em></p></blockquote><a id="more"></a><ol><li>基础路由</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'basic1'</span>,<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'Hello World'</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><ol><li>多请求路由</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::match([<span class="string">'get'</span>,<span class="string">'post'</span>], <span class="string">'multy'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'multy'</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><ol><li>所有请求种类路由</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::any(<span class="string">'allRequest'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'all request'</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><ol><li>路由参数</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/&#123;id&#125;/&#123;name?&#125;'</span>,<span class="function"><span class="keyword">function</span> <span class="params">($id,$name=null)</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'User-id'</span>.$id.<span class="string">'User-name:'</span>.$name;</div><div class="line">&#125;)-&gt;where([<span class="string">'id'</span>=&gt;<span class="string">'[0-9]+'</span>,<span class="string">'name'</span>=&gt;<span class="string">'[A-Za-z]+'</span>]);</div></pre></td></tr></table></figure><ol><li>路由别名</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/center'</span>,[<span class="string">'as'</span>=&gt;<span class="string">'center'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> route(<span class="string">'center'</span>);</div><div class="line">&#125;]);</div></pre></td></tr></table></figure><ol><li>路由群组</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'prefix'</span>=&gt;<span class="string">'member'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>&#123;</div><div class="line">Route::get(<span class="string">'basic2'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'Basic2'</span>;</div><div class="line">&#125;);</div><div class="line">Route::get(<span class="string">'user/center'</span>,[<span class="string">'as'</span>=&gt;<span class="string">'center'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> route(<span class="string">'center'</span>);</div><div class="line">&#125;]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><ol><li>路由输出视图</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'view'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>&#123;</div><div class="line"><span class="keyword">return</span> view(<span class="string">'welcome'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h1 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h1><blockquote><p><em>laravel/app/Http/Controllers:</em></p><p>路由将请求发送给控制器，控制器处理请求并返回相应</p><p>路由和控制器中的方法关联：</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'member/info'</span>,<span class="string">'MemberController@info'</span>);</div><div class="line"></div><div class="line">Route::get(<span class="string">'member/info'</span>,[<span class="string">'uses'</span>=&gt;<span class="string">'MemberController@info'</span>]);</div><div class="line"></div><div class="line">Route::get(<span class="string">'member/info'</span>,[</div><div class="line"><span class="string">'uses'</span> =&gt; <span class="string">'MemberController@info'</span>,</div><div class="line"><span class="string">'as'</span> =&gt; <span class="string">'member_info'</span></div><div class="line">]);</div><div class="line"></div><div class="line">Route::get(<span class="string">'member/find/&#123;id&#125;'</span>,<span class="string">'MemberController@find'</span>)</div><div class="line">-&gt;where(<span class="string">'id'</span>,<span class="string">'[0-9]+'</span>);</div></pre></td></tr></table></figure><blockquote><p>控制器中有对应路由请求的函数：</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MemberController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">info</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//return 'member-info';</span></div><div class="line"><span class="keyword">return</span> route(<span class="string">'member_info'</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 接收请求参数</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span><span class="params">($id)</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'member'</span>.$id;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 返回一个视图，向视图中传递数据</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toInfo</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> view(<span class="string">'member/info'</span>,[</div><div class="line"><span class="string">'name'</span> =&gt; <span class="string">'shaun'</span>,</div><div class="line"><span class="string">'age'</span> =&gt; <span class="number">18</span></div><div class="line">]);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><blockquote><p><em>laravel/resources/views:</em></p><p>控制器的方法返回一个视图，并传递参数给视图，视图使用<strong>模板</strong>解析展示数据</p><p>laravel 默认模板文件名为：xxx.blade.php</p><p>用  的形式获取变量值</p></blockquote><h1 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h1><blockquote><p><em>laravel/app:</em></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Member</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getMember</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> <span class="string">'member name is shaun'</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h1><h2 id="DB-facade"><a href="#DB-facade" class="headerlink" title="DB facade"></a>DB facade</h2><blockquote><p>配置：laravel/config/database.php</p><p>laravel/.env</p><p>使用 DB facade 实现 CURD</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">DB</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curd</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// 返回是否插入成功</span></div><div class="line">$bool = DB::insert(<span class="string">'insert into user(name,sex,phone,email) VALUES(?,?,?,?) '</span>,</div><div class="line">[<span class="string">'zcl'</span>,<span class="string">'1'</span>,<span class="string">'1365656556'</span>,<span class="string">'zcl@163.com'</span>]);</div><div class="line">var_dump($bool);</div><div class="line"><span class="comment">// 返回查询结果的数组</span></div><div class="line">$users = DB::select(<span class="string">'select* from user'</span>);</div><div class="line">dd($users); <span class="comment">// json格式</span></div><div class="line"><span class="comment">// 返回变动的数量</span></div><div class="line">$num = DB::update(<span class="string">'update user set age=? where name = ?'</span>,</div><div class="line">[<span class="number">18</span>,<span class="string">'zjm'</span>]);</div><div class="line">var_dump($num);</div><div class="line">      <span class="comment">// 返回删除的条数</span></div><div class="line">$num = DB::delete(<span class="string">'delete from user where id=?'</span>,</div><div class="line">[<span class="number">3</span>]);</div><div class="line">var_dump($num);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="查询构造器"><a href="#查询构造器" class="headerlink" title="查询构造器"></a>查询构造器</h2><blockquote><p>Laravel 查询构造器 (query builder) 提供接口，用来建立及执行数据库查找语法</p><p>使用 PDO 参数绑定，以保护应用程序免于 SQL 注入，传入的参数不需要额外转义特殊字符</p><p>基本可以满足所有的数据库操作</p></blockquote><ul><li>使用查询构造器新增数据</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 返回bool插入是否成功</span></div><div class="line">DB::table(<span class="string">'user'</span>)-&gt;insert([</div><div class="line"><span class="string">'name'</span> =&gt; <span class="string">'ms'</span>,</div><div class="line"><span class="string">'sex'</span> =&gt; <span class="string">'0'</span>,</div><div class="line"><span class="string">'age'</span> =&gt; <span class="string">'18'</span>,</div><div class="line"><span class="string">'phone'</span> =&gt; <span class="string">'13666666666'</span>,</div><div class="line"><span class="string">'email'</span> =&gt; <span class="string">'maoshuo@gmail.com'</span></div><div class="line">]);</div><div class="line"><span class="comment">// 返回插入的 id</span></div><div class="line">$id = DB::table(<span class="string">'user'</span>)-&gt;insertGetId([</div><div class="line"><span class="string">'name'</span> =&gt; <span class="string">'shaun'</span>,</div><div class="line"><span class="string">'age'</span> =&gt; <span class="number">19</span></div><div class="line">]);</div><div class="line"><span class="comment">// 插入多条记录，二维数组存放信息，返回bool</span></div><div class="line">DB::table(<span class="string">'user'</span>)-&gt;insert([</div><div class="line">[<span class="string">'name'</span> =&gt; <span class="string">'张三'</span>, <span class="string">'age'</span> =&gt; <span class="number">21</span>],</div><div class="line">    [<span class="string">'name'</span> =&gt; <span class="string">'李四'</span>, <span class="string">'age'</span> =&gt; <span class="number">22</span>],</div><div class="line">]);</div></pre></td></tr></table></figure><h2 id="使用查询构造器更新数据"><a href="#使用查询构造器更新数据" class="headerlink" title="使用查询构造器更新数据"></a>使用查询构造器更新数据</h2><ul><li>更新数据</li><li>自增自减</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 返回受影响的行数</span></div><div class="line">$num = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;where(<span class="string">'id'</span>,<span class="number">7</span>)</div><div class="line">-&gt;update([</div><div class="line"><span class="string">'name'</span> =&gt; <span class="string">'zjm'</span></div><div class="line">]);</div><div class="line">var_dump($num);</div><div class="line"><span class="comment">// 自减同时更新子段值</span></div><div class="line">$num = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;where([<span class="string">'id'</span>=&gt;<span class="number">7</span>]) <span class="comment">// -&gt;where('id',7)</span></div><div class="line">    -&gt;decrement(<span class="string">'age'</span>,<span class="number">3</span>, [<span class="string">'name'</span> =&gt; <span class="string">'zjmhaha'</span>]);<span class="comment">//increment 自增 decrement 自减</span></div><div class="line">var_dump($num);</div></pre></td></tr></table></figure><h2 id="使用查询构造器删除数据"><a href="#使用查询构造器删除数据" class="headerlink" title="使用查询构造器删除数据"></a>使用查询构造器删除数据</h2><ul><li>delete</li><li>trancate——清空表…</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$num = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;where(<span class="string">'id'</span>,<span class="number">7</span>)</div><div class="line">-&gt;delete();</div><div class="line">var_dump($num);</div><div class="line">$num = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;where(<span class="string">'id'</span>, <span class="string">'&gt;='</span>, <span class="number">13</span>)</div><div class="line">-&gt;delete();</div><div class="line">var_dump($num);</div></pre></td></tr></table></figure><h2 id="使用查询构造器查询数据"><a href="#使用查询构造器查询数据" class="headerlink" title="使用查询构造器查询数据"></a>使用查询构造器查询数据</h2><ul><li>get()——获取结果集所有数据</li><li>first()——获取结果集中第一条</li><li>where()——查询条件，whereRaw()——多条件查询</li><li>pluck()——返回结果集中指定的字段</li><li>lists()——类似pluck</li><li>select()——查询指定的字段</li><li>chunk() ——分页返回所有结果集</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// get() 获取表中所有数据</span></div><div class="line">$users = DB::table(<span class="string">'user'</span>)-&gt;get();</div><div class="line"><span class="comment">// first 获取结果集第一条</span></div><div class="line">$users = DB::table(<span class="string">'user'</span>)</div><div class="line">           -&gt;orderBy(<span class="string">'id'</span>,<span class="string">'desc'</span>)   <span class="comment">// 倒序</span></div><div class="line">           -&gt;first();</div><div class="line">$users = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;where(<span class="string">'age'</span>,<span class="string">'&gt;='</span>,<span class="number">20</span>)</div><div class="line">-&gt;get();</div><div class="line"><span class="comment">// 多条件查询</span></div><div class="line">$users = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;whereRaw(<span class="string">'id &gt;= ? and age &gt; ?'</span>, [<span class="number">2</span>, <span class="number">20</span>])</div><div class="line">-&gt;get();</div><div class="line"><span class="comment">// pluck 返回结果集中指定的字段</span></div><div class="line">$name = DB::table(<span class="string">'user'</span>)-&gt;pluck(<span class="string">'name'</span>);</div><div class="line"><span class="comment">//$name = DB::table('user')-&gt;lists('name', 'id');</span></div><div class="line"><span class="comment">//dd($name);</span></div><div class="line"><span class="comment">//select 查询指定的字段</span></div><div class="line">$users = DB::table(<span class="string">'user'</span>)</div><div class="line">-&gt;select(<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>)</div><div class="line">-&gt;get();</div><div class="line"><span class="comment">// chunk</span></div><div class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</div><div class="line">$num = DB::table(<span class="string">'user'</span>)-&gt;chunk(<span class="number">2</span>, <span class="function"><span class="keyword">function</span><span class="params">($users)</span> </span>&#123;</div><div class="line">var_dump($users);</div><div class="line">&#125;);</div><div class="line">var_dump($num);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="查询构造器中的聚合函数"><a href="#查询构造器中的聚合函数" class="headerlink" title="查询构造器中的聚合函数"></a>查询构造器中的聚合函数</h2><ul><li>count()</li><li>max()</li><li>min()</li><li>avg()</li><li>sum()</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 聚合函数</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aggregate</span><span class="params">()</span> </span>&#123;</div><div class="line">$num = DB::table(<span class="string">'user'</span>)-&gt;count();</div><div class="line">$num = DB::table(<span class="string">'user'</span>)-&gt;max(<span class="string">'age'</span>);</div><div class="line">$num = DB::table(<span class="string">'user'</span>)-&gt;min(<span class="string">'age'</span>);</div><div class="line">$num = DB::table(<span class="string">'user'</span>)-&gt;avg(<span class="string">'age'</span>);</div><div class="line">$num = DB::table(<span class="string">'user'</span>)-&gt;sum(<span class="string">'age'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="数据库操作-Eloquent-ORM"><a href="#数据库操作-Eloquent-ORM" class="headerlink" title="数据库操作-Eloquent ORM"></a>数据库操作-Eloquent ORM</h1><blockquote><p>数据表和一个相对应的模型 (Model) 用于和数据表交互</p><p>查询构造器在ORM中依旧有应用</p></blockquote><h2 id="模型建立"><a href="#模型建立" class="headerlink" title="模型建立"></a>模型建立</h2><blockquote><p><em>laravel/app:</em></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</div><div class="line"><span class="comment">// 指定表名，默认为 students</span></div><div class="line"><span class="keyword">protected</span> $table = <span class="string">'student'</span>;</div><div class="line"><span class="comment">// 指定id,默认为id</span></div><div class="line"><span class="keyword">protected</span> $id = <span class="string">'id'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="ORM-查询"><a href="#ORM-查询" class="headerlink" title="ORM 查询"></a>ORM 查询</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">orm</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// 查询所有</span></div><div class="line">$students = Student::all();</div><div class="line"><span class="comment">// 按主键查询</span></div><div class="line">$student = Student::find(<span class="number">1</span>);</div><div class="line"><span class="comment">// 找不到id报错</span></div><div class="line">$student = Student::findOrFail(<span class="number">2</span>);</div><div class="line">  <span class="comment">// 查询构造器在ORM中使用</span></div><div class="line">$students = Student::get();</div><div class="line">$student = Student::where(<span class="string">'age'</span>,<span class="string">'&gt;'</span>,<span class="number">18</span>)</div><div class="line">-&gt;orderBy(<span class="string">'age'</span>,<span class="string">'desc'</span>)</div><div class="line">-&gt;first();</div><div class="line">dd($student);</div><div class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</div><div class="line">Student::chunk(<span class="number">2</span>, <span class="function"><span class="keyword">function</span> <span class="params">($students)</span> </span>&#123;</div><div class="line">var_dump($students);</div><div class="line">&#125;);</div><div class="line">$num = Student::count();</div><div class="line">$max = Student::where(<span class="string">'age'</span>,<span class="string">'&gt;'</span>,<span class="number">18</span>)-&gt;max(<span class="string">'age'</span>);</div><div class="line">var_dump($max);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="ORM中新增，自定义时间戳及批量赋值"><a href="#ORM中新增，自定义时间戳及批量赋值" class="headerlink" title="ORM中新增，自定义时间戳及批量赋值"></a>ORM中新增，自定义时间戳及批量赋值</h2><ul><li>通过模型新增数据（自定义时间戳）</li><li>使用模型的Create方法新增数据（批量赋值）</li></ul><h3 id="模型属性的定义，方法重写"><a href="#模型属性的定义，方法重写" class="headerlink" title="模型属性的定义，方法重写"></a>模型属性的定义，方法重写</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;</div><div class="line"><span class="comment">// 指定表名，默认为 students</span></div><div class="line"><span class="keyword">protected</span> $table = <span class="string">'student'</span>;</div><div class="line"><span class="comment">// 指定id,默认为id</span></div><div class="line"><span class="keyword">protected</span> $id = <span class="string">'id'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 指定允许批量赋值的字段</span></div><div class="line"><span class="keyword">protected</span> $fillable = [<span class="string">'name'</span>, <span class="string">'age'</span>];</div><div class="line"><span class="comment">//  指定不允许批量赋值的字段</span></div><div class="line"><span class="comment">//protected $guarded = [];</span></div><div class="line"><span class="comment">// 关闭created_at 和 updated_at</span></div><div class="line"><span class="keyword">public</span> $timestamps = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="comment">// 自意义返回时间戳</span></div><div class="line"><span class="comment">/*protected function getDateFormat() &#123;</span></div><div class="line"><span class="comment">return time();</span></div><div class="line"><span class="comment">&#125;*/</span></div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">/*protected function asDateTime( $value ) &#123;</span></div><div class="line"><span class="comment">return $value;</span></div><div class="line"><span class="comment">&#125;*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p><em>注：</em>由于laravel自定义添加的created_at时间不是北京时间，可以将数据库 created_at字段类型改为 int，重写模型的 getDateFormat()方法，如果希望返回时间戳(数字形式)，再重写asDateTime()函数</p></blockquote><h3 id="四种常用的ORM新增"><a href="#四种常用的ORM新增" class="headerlink" title="四种常用的ORM新增"></a>四种常用的ORM新增</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">orm2</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">// 使用模型新增数据</span></div><div class="line"><span class="comment">/*$student = new Student();</span></div><div class="line"><span class="comment">$student-&gt;name = 'ms';</span></div><div class="line"><span class="comment">$student-&gt;age = 18;</span></div><div class="line"><span class="comment">$bool = $student-&gt;save();</span></div><div class="line"><span class="comment">dd($bool);*/</span></div><div class="line"><span class="comment">/*$Student = Student::find(3);</span></div><div class="line"><span class="comment">echo $Student-&gt;created_at.'&lt;br&gt;';</span></div><div class="line"><span class="comment">echo date('Y-m-d H:i:s', 1464509164);// 只对于数字时间戳*/</span></div><div class="line"></div><div class="line"><span class="comment">// 使用模型的Create方法新增数据，这里的属性必须为模型中指定允许批量赋值的字段</span></div><div class="line"><span class="comment">/*$student = Student::create([</span></div><div class="line"><span class="comment">'name' =&gt; 'zjm',</span></div><div class="line"><span class="comment">'age' =&gt; 18</span></div><div class="line"><span class="comment">]);</span></div><div class="line"><span class="comment">dd($student);*/</span></div><div class="line"><span class="comment">//firstOrCreate() 按属性查找，没有找到则新加</span></div><div class="line"><span class="comment">/*$student = Student::firstOrCreate([</span></div><div class="line"><span class="comment">'name' =&gt; 'zjm22333'</span></div><div class="line"><span class="comment">]);</span></div><div class="line"><span class="comment">dd($student);*/</span></div><div class="line"><span class="comment">//firstOrNew() 按属性查找，没有则建立新的实例，自己调用save()保存</span></div><div class="line">$student = Student::firstOrNew([</div><div class="line"><span class="string">'name'</span> =&gt; <span class="string">'zjm123123'</span></div><div class="line">]);</div><div class="line">$student-&gt;save();</div><div class="line">dd($student);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><em>注：</em> 使用模型的Create方法新增数据，这里的属性必须为模型中指定允许批量赋值的</p><h2 id="使用Eloquent-ORM修改数据"><a href="#使用Eloquent-ORM修改数据" class="headerlink" title="使用Eloquent ORM修改数据"></a>使用Eloquent ORM修改数据</h2><ul><li>通过模型更新</li><li>结合查询语句 批量更新</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$student = Student::find(<span class="number">8</span>);</div><div class="line">$student-&gt;name = <span class="string">'shaun'</span>;</div><div class="line">$bool = $student-&gt;save();</div><div class="line">var_dump($bool);</div><div class="line">Student::where(<span class="string">'id'</span>,<span class="string">'&gt;'</span>,<span class="number">7</span>)-&gt;update([</div><div class="line"><span class="string">'age'</span> =&gt; <span class="number">23</span></div><div class="line">]);</div></pre></td></tr></table></figure><blockquote><p><em>注：</em> 使用ORM的save()方法更新子段必须使模型的主键和数据库表主键相同，<strong>包括大小写</strong></p><p>模型中默认主键名：<strong>id</strong></p><p>重写模型中主键名：<code>protected $primaryKey = &#39;Id&#39;;</code></p></blockquote><h2 id="使用Eloquent-ORM删除数据"><a href="#使用Eloquent-ORM删除数据" class="headerlink" title="使用Eloquent ORM删除数据"></a>使用Eloquent ORM删除数据</h2><ul><li>通过模型删除</li><li>通过主键值删除</li><li>根据指定条件删除</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 通过模型删除（没有会报错）</span></div><div class="line">$student = Student::find(<span class="number">9</span>);</div><div class="line">$bool = $student-&gt;delete();</div><div class="line"><span class="comment">// 通过主键删除,返回删除个数</span></div><div class="line">$num = Student::destroy(<span class="number">7</span>);</div><div class="line">$num = Student::destroy(<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>);</div><div class="line">$num = Student::destroy([<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]);</div><div class="line"><span class="comment">// 条件删除</span></div><div class="line">$num = Student::where(<span class="string">'id'</span>, <span class="string">'&gt;'</span>, <span class="number">6</span>)-&gt;delete();</div></pre></td></tr></table></figure><h1 id="Blade模板引擎"><a href="#Blade模板引擎" class="headerlink" title="Blade模板引擎"></a>Blade模板引擎</h1><h2 id="Blade模板引擎简介及模板继承的使用"><a href="#Blade模板引擎简介及模板继承的使用" class="headerlink" title="Blade模板引擎简介及模板继承的使用"></a>Blade模板引擎简介及模板继承的使用</h2><blockquote><p>页面公共的部分提取出来形成一个父类，方便开发和维护</p><ul><li>@section…@show</li><li>@yield</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@extends(&apos;layouts&apos;)&lt;!-- 继承 views下的基类视图 --&gt;</div><div class="line">@section(&apos;header&apos;)</div><div class="line">@parent &lt;!-- 父模板内容 --&gt;</div><div class="line">self_content</div><div class="line">@stop</div></pre></td></tr></table></figure><h2 id="基础语法及include的使用"><a href="#基础语法及include的使用" class="headerlink" title="基础语法及include的使用"></a>基础语法及include的使用</h2><blockquote><p>在控制器中返回视图并传入参数</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> view(<span class="string">'student.section1'</span>, [</div><div class="line"><span class="string">'name'</span> =&gt; $name</div><div class="line">]);</div></pre></td></tr></table></figure><blockquote><p>在模板中输出参数值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; &#123;&#123; $name &#125;&#125;</div><div class="line">&gt; &lt;!-- 调用php函数，执行php代码 --&gt;</div><div class="line">&gt; &#123;&#123; time() &#125;&#125;</div><div class="line">&gt; &#123;&#123; date(&apos;Y-m-d H:i:s&apos;, time()) &#125;&#125;</div><div class="line">&gt; &#123;&#123; in_array($name, $arr) ? &apos;true&apos; : &apos;false&apos;&#125;&#125;</div><div class="line">&gt; &#123;&#123; var_dump($arr) &#125;&#125;</div><div class="line">&gt; &lt;!-- 存在输出，不存在输出默认 --&gt;</div><div class="line">&gt; &#123;&#123; isset($name) ? $name:&apos;default&apos; &#125;&#125;</div><div class="line">&gt; &lt;!-- 可简化为： --&gt;</div><div class="line">&gt; &#123;&#123; $name or &apos;default&apos; &#125;&#125;</div><div class="line">&gt; &lt;!-- 原样输出 --&gt;</div><div class="line">&gt; @&#123;&#123; $name &#125;&#125;</div><div class="line">&gt; &lt;!-- 模板中的注释：不在页面源码中显示 --&gt;</div><div class="line">&gt; &#123;&#123; -- 你的注释 -- &#125;&#125;</div><div class="line">&gt; &lt;!-- 引入子视图 --&gt;</div><div class="line">&gt; @include(&apos;student.common1&apos;)</div><div class="line">&gt;</div></pre></td></tr></table></figure></blockquote><h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">@if ($name == &apos;zzz&apos;)</div><div class="line"> I&apos;m zzz</div><div class="line">@elseif($name == &apos;aaa&apos;)</div><div class="line">I&apos;m aaa</div><div class="line">@else</div><div class="line">...</div><div class="line">@endif</div><div class="line"></div><div class="line">@if(in_array($name, $arr))</div><div class="line">true</div><div class="line">@else</div><div class="line">false</div><div class="line">@endif</div><div class="line">@unless($name == &apos;zjm&apos;)&lt;!--if的取反--&gt;</div><div class="line">I&apos;m zjm</div><div class="line">@endunless</div><div class="line"></div><div class="line">@for($i=0; $i &lt; 10; $i++)</div><div class="line">&#123;&#123; $i &#125;&#125;</div><div class="line">@endfor</div><div class="line">                   </div><div class="line">@foreach($students as $student)</div><div class="line">   &lt;p&gt;&#123;&#123; $student-&gt;name &#125;&#125;&lt;/p&gt;        </div><div class="line">@endforeach</div><div class="line"></div><div class="line">@forelse($students as $student)</div><div class="line">&lt;p&gt;&#123;&#123; $student-&gt;name &#125;&#125;&lt;/p&gt;     </div><div class="line">@empty</div><div class="line">&lt;p&gt;无数据&lt;/p&gt;     </div><div class="line">@endforelse</div></pre></td></tr></table></figure><h2 id="模板中的URL"><a href="#模板中的URL" class="headerlink" title="模板中的URL"></a>模板中的URL</h2><ul><li>url()——通过路由名字</li><li>action()——通过制定控制器的方法名</li><li>route()——通过路由别名</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url('url) &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; action('StudentController.urlTest') &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; route('url') &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure><p>`</p>]]></content>
      
      <categories>
          
          <category> web服务 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php框架 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>求所有LCS的简单算法及矩阵搜索算法</title>
      <link href="/2017/08/21/LCS/"/>
      <url>/2017/08/21/LCS/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="动态规划——最长公共子序列（LCS）"><a href="#动态规划——最长公共子序列（LCS）" class="headerlink" title="动态规划——最长公共子序列（LCS）"></a>动态规划——最长公共子序列（LCS）</h1><h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><ul><li><strong>子序列：</strong> 原序列 <strong>X</strong>，将 <strong>X</strong> 中的元素组成新序列 <strong>Z</strong>，这些元素的先后位置与原序列相对一致，<strong>Z</strong> 是 <strong>X</strong> 的一个子序列</li></ul><ul><li><strong>最长公共子序列：</strong> 若 <strong>Z</strong> 是 <strong>X</strong> 的子序列 , <strong>Z</strong> 也是 <strong>Y</strong> 的子序列，且不存在比 <strong>Z</strong> 更长的 <strong>X</strong> 和 <strong>Y</strong> 的公共子序列，则称 <strong>Z</strong> 是 <strong>X</strong> 和 <strong>Y</strong> 的最长公共子序列 ，记为 <strong>Z ∈LCS( X , Y) </strong>。最长公共子序列往往不止一个</li></ul><blockquote><p>eg:  <strong>X</strong> = { A，B，C，B，D，A，B }，<strong>Y</strong> = { B，D，C，A，B，A }，则 { B，C，B，A } 是 <strong>X</strong> 和 <strong>Y</strong> 的一条公共子序列，由于没有更长的公共子序列，故也是一条最长公共子序列</p></blockquote><h2 id="最长公共子序列的结构"><a href="#最长公共子序列的结构" class="headerlink" title="最长公共子序列的结构"></a>最长公共子序列的结构</h2><blockquote><p>在穷举法中，将 <strong>X</strong> 中所有子序列，检查它是否也是 <strong>Y</strong>  的子序列，确定是公共子序列后记录最长的公共子序列。设 <strong>X</strong> 有 m 个元素，则它的子序列有 2<sup>m</sup>个，穷举法需要指数时间</p></blockquote><h3 id="最长公共子序列具有最优子结构"><a href="#最长公共子序列具有最优子结构" class="headerlink" title="最长公共子序列具有最优子结构"></a>最长公共子序列具有最优子结构</h3><blockquote><p>设序列 <strong>X</strong> = { x<sub>1</sub>，x<sub>2</sub>，<strong>···</strong>，x<sub>m</sub> } 和 <strong>Y</strong> = { y<sub>1</sub>，y<sub>2</sub>，<strong>···</strong>，y<sub>n</sub> } 的最长公共子序列为 <strong>Z</strong> = { z<sub>1</sub>，z<sub>2</sub>，<strong>···</strong>，z<sub>k</sub> }，则</p><ol><li>若 x<sub>m</sub> = y<sub>n</sub>，则 z<sub>k</sub> =  x<sub>m</sub> = y<sub>n</sub>，且<strong>Z</strong><sub>k-1</sub> 是 <strong>X</strong><sub>m-1</sub> 和 <strong>Y</strong><sub>n-1</sub> 的最长公共子序列</li><li>若 x<sub>m</sub> ≠ y<sub>n</sub>，且 z<sub>k</sub> ≠  x<sub>m</sub>，则 <strong>Z</strong> 是 <strong>X</strong><sub>m-1</sub> 和 <strong>Y</strong> 的最长公共子序列</li><li>若 x<sub>m</sub> ≠ y<sub>n</sub>，且 z<sub>k</sub> ≠  y<sub>n</sub>，则 <strong>Z</strong> 是 <strong>X</strong> 和 <strong>Y</strong><sub>n-1</sub> 的最长公共子序列</li></ol></blockquote><a id="more"></a><h3 id="子问题的递归结构"><a href="#子问题的递归结构" class="headerlink" title="子问题的递归结构"></a>子问题的递归结构</h3><blockquote><p>如果从顶向下计算，将出现大量的子问题重叠…动态规划的基本思想是从低向上计算不同子问题，通过底部子问题的解，得出顶部问题的解。最终目的是得到最顶上问题的解。</p><p>建立两个矩阵 c 和 b，矩阵 c 用来存放 i, j 位置的最长公共子序列长度(简记为LCS长度)，矩阵 b 存放i, j 位置是由哪个方向来的，方便回溯 </p><p>建立递归关系如下：</p></blockquote><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mo>=</mo><mn>0</mn><mtext> </mtext><mi>o</mi><mi>r</mi><mtext> </mtext><mi>j</mi><mo>=</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mi>c</mi><mo>[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo>]</mo><mo>+</mo><mn>1</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mi>c</mi><mo>[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo separator="true">,</mo><mi>c</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo>]</mo><mo>)</mo><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><msub><mi>x</mi><mi>i</mi></msub><mo>≠</mo><msub><mi>y</mi><mi>j</mi></msub></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">c[i,j]=\begin{cases}0, &amp; i=0\ or\ j=0\\c[i-1,j-1]+1,&amp;i,j&gt;0\ and\ x_i=y_j\\max(c[i-1,j],c[i,j-1]), &amp;i,j&gt;0\ and\  x_i\ne y_j\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.41em;"></span><span class="strut bottom" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.000010000000000287557em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-1.1500100000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.4500200000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span><span class="mpunct">,</span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mpunct">,</span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mclose">)</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mspace"> </span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≠</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><msub><mi>y</mi><mi>j</mi></msub></mrow></mtd></mtr><mtr><mtd><mrow><mn>2</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><msub><mi>x</mi><mi>i</mi></msub><mo>≠</mo><msub><mi>y</mi><mi>j</mi></msub><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>c</mi><mo>[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo>&gt;</mo><mi>c</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow></mtd></mtr><mtr><mtd><mrow><mn>3</mn><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><msub><mi>x</mi><mi>i</mi></msub><mo>≠</mo><msub><mi>y</mi><mi>j</mi></msub><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>c</mi><mo>[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo>≤</mo><mi>c</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">b[i,j]=\begin{cases}1,&amp;i,j&gt;0\ and\ x_i=y_j\\2, &amp;i,j&gt;0\ and\  x_i\ne y_j\ and\ c[i-1,j]&gt;c[i,j-1]\\3, &amp;i,j&gt;0\ and\  x_i\ne y_j\ and\ c[i-1,j]\leq c[i,j-1]\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.41em;"></span><span class="strut bottom" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">b</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:0.9500099999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.000010000000000287557em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-1.1500100000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.4500200000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span><span class="mpunct">,</span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">2</span><span class="mpunct">,</span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">3</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist"><span style="top:-1.4020000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:0.0379999999999997em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≠</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mrel">&gt;</span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span><span style="top:1.4779999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≠</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mrel">≤</span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span><p><img src="/images/lcs/lcs1.jpg" alt="lcs1.jpg"></p><blockquote><p>图中右下角 5(2) 表示 (8, 8) 位置的LCS长度为5，由上面的位置 (7, 8) 得到</p><p>右下角的值就是LCS长度，从该点通过矩阵 b 回溯，遇到 2 向上走，遇到 3 向左走，遇到 1 斜上走，当遇到边缘时(i=0 或 j=0)停止，既可以得到一条最长公共子序列</p><p>这样做只能得到两串的一条最长公共子序列，因为当 c[i−1,j]=c[i,j−1] 时可以向上也可以向左，但是我们指定它向左了，这样就不会出现不同的情况。于是，可以添加一种 b 的值：</p></blockquote><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo>=</mo><mn>4</mn><mo separator="true">,</mo><mtext> </mtext><mtext> </mtext><mtext> </mtext><mtext> </mtext><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>&gt;</mo><mn>0</mn><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><msub><mi>x</mi><mi>i</mi></msub><mo>≠</mo><msub><mi>y</mi><mi>j</mi></msub><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>c</mi><mo>[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi><mo>]</mo><mo>=</mo><mi>c</mi><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">b[i,j]=4,\ \ \ \ i,j&gt;0\ and\  x_i\ne y_j\ and\ c[i-1,j]=c[i,j-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit">b</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mrel">=</span><span class="mord mathrm">4</span><span class="mpunct">,</span><span class="mord mspace"> </span><span class="mord mspace"> </span><span class="mord mspace"> </span><span class="mord mspace"> </span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mrel">&gt;</span><span class="mord mathrm">0</span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≠</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mspace"> </span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mord mspace"> </span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mrel">=</span><span class="mord mathit">c</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05724em;">j</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span></span><blockquote><p>当 b[i][j] = 4 时(下文称为<strong>分叉点</strong>)，向上走也向左走，这样可以遍历到所有的路径</p><p><img src="/images/lcs/lcs2.jpg" alt="lcs2.jpg"></p><p>如图，当遇到分叉点的时候将分出两个路径，将所有分叉点作为非叶子结点组成一棵二叉树：</p><p><img src="/images/lcs/tree.jpg" alt="tree"></p><p>最下面的叶子结点个数就是所有路径个数</p></blockquote><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> num = <span class="number">0</span>;<span class="comment">// 记录遍历路径数</span></div><div class="line"><span class="function"><span class="keyword">int</span>** <span class="title">getArr</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;<span class="comment">// 动态创建二维数组</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS</span><span class="params">(<span class="keyword">int</span>**,<span class="keyword">int</span>**,<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;<span class="comment">// 给 c,b 数组赋值</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TraceBack</span><span class="params">(<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="keyword">int</span>**,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;    <span class="comment">// 回溯路径</span></div><div class="line"><span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt; setOfLCS;    <span class="comment">// set保存所有的LCS，set集合中元素不重复</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">string</span> s1,s2;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;s1&gt;&gt;s2;</div><div class="line">    <span class="keyword">int</span> len1 = s1.size() + <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> len2 = s2.size() + <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span>** c = getArr(len1,len2);</div><div class="line">    <span class="keyword">int</span>** b = getArr(len1,len2);</div><div class="line">  <span class="comment">// 使 s1,s2 与 c,b 坐标一致</span></div><div class="line">    s1 = <span class="string">" "</span> + s1;</div><div class="line">    s2 = <span class="string">" "</span> + s2;</div><div class="line">  <span class="comment">// 自底向上给 c,b 数组赋值</span></div><div class="line">    LCS(c,b,s1,s2,len1,len2);</div><div class="line">  <span class="comment">// 显示 c,b 数组</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len1;i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len2;j++) &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;c[i][j]&lt;&lt;<span class="string">" "</span>;</div><div class="line">            <span class="keyword">if</span>(j == len2<span class="number">-1</span>)</div><div class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"===============================\n"</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len1;i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len2;j++) &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;b[i][j]&lt;&lt;<span class="string">" "</span>;</div><div class="line">            <span class="keyword">if</span>(j == len2<span class="number">-1</span>)</div><div class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">  <span class="comment">// 从右下角根据 b 数组指向回溯到边界 </span></div><div class="line">    TraceBack(s1,<span class="string">""</span>,b,len1<span class="number">-1</span>,len2<span class="number">-1</span>);</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"All route number: "</span>&lt;&lt;num&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Remove duplicate elements: "</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">  <span class="comment">// 遍历set，输出所有LCS</span></div><div class="line">    <span class="built_in">set</span>&lt;<span class="built_in">string</span>&gt;::iterator iter=setOfLCS.begin();</div><div class="line">    <span class="keyword">while</span>(iter != setOfLCS.end()) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;*iter&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        iter++;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"LCS length: "</span>&lt;&lt;c[len1<span class="number">-1</span>][len2<span class="number">-1</span>]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"LCS number: "</span>&lt;&lt;setOfLCS.size()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS</span><span class="params">(<span class="keyword">int</span>** c,<span class="keyword">int</span>** b,<span class="built_in">string</span> s1,<span class="built_in">string</span> s2,<span class="keyword">int</span> m,<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;m;i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;n;j++) &#123;</div><div class="line">            <span class="keyword">if</span>(s1[i] == s2[j]) &#123;</div><div class="line">                c[i][j] = c[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</div><div class="line">                b[i][j] = <span class="number">1</span>;<span class="comment">// 斜上</span></div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j] &gt; c[i][j<span class="number">-1</span>]) &#123;</div><div class="line">                c[i][j] = c[i<span class="number">-1</span>][j];</div><div class="line">                b[i][j] = <span class="number">2</span>;<span class="comment">// 上</span></div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j] &lt; c[i][j<span class="number">-1</span>]) &#123;</div><div class="line">                c[i][j] = c[i][j<span class="number">-1</span>];</div><div class="line">                b[i][j] = <span class="number">3</span>;<span class="comment">// 左</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                c[i][j] = c[i<span class="number">-1</span>][j];</div><div class="line">                b[i][j] = <span class="number">4</span>;<span class="comment">// 上 或 左</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 返回动态创建的二维数组的指针</span></div><div class="line"><span class="function"><span class="keyword">int</span>** <span class="title">getArr</span><span class="params">(<span class="keyword">int</span> M,<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>** arr = <span class="keyword">new</span> <span class="keyword">int</span>*[M];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;M;i++) &#123;</div><div class="line">        arr[i] = <span class="keyword">new</span> <span class="keyword">int</span>[N];</div><div class="line">        <span class="built_in">memset</span>(arr[i],<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*N);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> arr;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TraceBack</span><span class="params">(<span class="built_in">string</span> s1,<span class="built_in">string</span> temp,<span class="keyword">int</span>** b,<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(i&gt;<span class="number">0</span> &amp;&amp; j&gt;<span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(b[i][j] == <span class="number">1</span>) &#123;</div><div class="line">            temp = s1[i] + temp;</div><div class="line">            i--;</div><div class="line">            j--;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(b[i][j] == <span class="number">2</span>) &#123;</div><div class="line">            i--;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(b[i][j] == <span class="number">3</span>) &#123;</div><div class="line">            j--;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="comment">// 递归回溯</span></div><div class="line">            TraceBack(s1,temp,b,i<span class="number">-1</span>,j);</div><div class="line">            TraceBack(s1,temp,b,i,j<span class="number">-1</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    num ++;</div><div class="line">  <span class="comment">// 打印一次遍历得到的字符串，可能是重复的</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"###"</span>&lt;&lt;temp&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">  <span class="comment">// 交给 set 来移除重复字符串</span></div><div class="line">    setOfLCS.insert(temp);</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>输入</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">badcdcba</div><div class="line">abcdcdab</div></pre></td></tr></table></figure><blockquote><p>得到的结果为：LCS长度=5，总路径数=18，除去重复的子串后，所有LCS个数为8</p><p>可以发现：回溯过程中不同路径出现大量交叉，由于总路径数是二叉树的叶子结点数，最坏情况下，二叉树高度为max(m,n)，即两串长度最大值，叶子结点个数为2<sup>max(m,n)</sup>，这些情况中还存在大量重复，筛选很麻烦，最后结果可能得到很少的几组数据而已。</p></blockquote><h2 id="优化：矩阵搜索求所有的最长公共子序列"><a href="#优化：矩阵搜索求所有的最长公共子序列" class="headerlink" title="优化：矩阵搜索求所有的最长公共子序列"></a>优化：矩阵搜索求所有的最长公共子序列</h2><blockquote><p>鉴于上述方法的缺点，根据<em>《利用矩阵搜索求所有最长公共子序列的算法》，宫洁卿，安徽工程科技学院学报，vol23,No.4,Dec.,2008</em> 提出的思想，这里进行简要阐述：</p><p>将 b[i][j] = 1 的点称为<strong>跳跃点</strong>，<strong>跳跃点</strong>使LCS从n→n-1(n=1,2,…,LCS长度)，LCS是由一条路径上的跳跃点对应的字符组成。将n→n-1的每个跳跃点依次找到这个点的所有下一跳跃点，直到没有下一个跳跃点为止。</p></blockquote><h3 id="矩阵搜索算法的基本思路和步骤"><a href="#矩阵搜索算法的基本思路和步骤" class="headerlink" title="矩阵搜索算法的基本思路和步骤"></a>矩阵搜索算法的基本思路和步骤</h3><blockquote><ol><li>两个栈：第一个栈 store 用于存放所有搜索到的元素，当该栈为空时，运算结束；第二个栈 print 用于存放准备打印的元素。先计算出二维数组 C，每个节点都纪录本节点所在的坐标，LCS 长度和指向的方向。假设该 LCS 串最长为 n，那么虚拟一个( n + 1) →n的节点，该节点的坐标位于数组 C 最右下角的节点 C[ i , j ] 的右下方，为 C[ i + 1 , j + 1 ]。将该节点压入栈 store</li><li>检测栈 store 是否为空，如果为空，则本算法结束</li><li>从 store 栈顶取出一个节点压入 print 栈</li><li>如果当前的元素是边界元素1 →0 时，打印栈 print 里面除了栈底的所有元素(无须打印原本不存在的虚拟结点) 。查看 store 栈里最上面一个元素的 LCS 长度，弹出栈 print 里面所有LCS 长度比 store 栈最上面的 LCS 长度大或相等的元素，跳转到第 2 步</li><li>设该结点的 LCS 长度为 n +1，从该节点出发，查看该节点的方向箭头，按照斜方向路线、向上的路<br>线（如果是双向的路线则走向上的路线）、向左的路线为优先级找到一个 n → ( n - 1) 的节点，假设为<br>C[ X1 , Y1 ]</li><li>再次从该节点出发，查看该节点的方向箭头 ,按照斜方向路线、向左的路线（如果是双向的路线则<br>走向左的路线） 、向上的路线为优先级找到一个 n →( n - 1) 的节点 ,假设为 C[ X2 , Y2 ]</li><li>比较 C[ X1 , Y1 ] 和 C[ X2 , Y2 ] 这两个节点。如果这两个结点是同一个结点，则将该结点压入栈 store，跳转到第 2 步</li><li>从刚才得到的两个结点 C[ X1 , Y1 ] 和 C[ X2 , Y2 ]，在二维数组 C 中，以 ( X1 , Y1 ) ( X2 , Y1 ) ( X1 ,Y2 ) ( X2 , Y2 ) 这四个点为坐标所构成的矩阵，在该矩阵中搜索所有的元素，将所有满足 n →( n - 1) 的节点压入栈 store。跳转到第 2 步</li></ol></blockquote><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span>** <span class="title">getArr</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS</span><span class="params">(<span class="keyword">int</span>**,<span class="keyword">int</span>**,<span class="built_in">string</span>,<span class="built_in">string</span>,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TraceBack</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>**,<span class="keyword">int</span>**,<span class="built_in">string</span>)</span></span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    <span class="keyword">int</span> lcsLen;</div><div class="line">    node()&#123;&#125;</div><div class="line">    node(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> z):x(x),y(y),lcsLen(z)&#123;&#125;</div><div class="line">    node(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span>** c):x(x),y(y),lcsLen(c[x][y])&#123;&#125;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> ==(<span class="keyword">const</span> node &amp;n) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;x == n.x &amp;&amp; <span class="keyword">this</span>-&gt;y == n.y)</div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStack</span><span class="params">(<span class="built_in">stack</span>&lt;node&gt;,<span class="built_in">string</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">popPrint</span><span class="params">(<span class="built_in">stack</span>&lt;node&gt;&amp;,<span class="keyword">int</span>)</span></span>;</div><div class="line"><span class="function">node <span class="title">findJump</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>**,<span class="keyword">int</span>**,<span class="keyword">int</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">searchMatrix</span><span class="params">(node,node,<span class="keyword">int</span>**,<span class="keyword">int</span>**,<span class="built_in">stack</span>&lt;node&gt;&amp;)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">string</span> s1,s2;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Input the first Sequence:"</span>;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;s1;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Input the second Sequence:"</span>;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;s2;</div><div class="line">    <span class="keyword">int</span> len1 = s1.length()+<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> len2 = s2.length()+<span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span>** c = getArr(len1,len2);</div><div class="line">    <span class="keyword">int</span>** b = getArr(len1,len2);</div><div class="line">    s1 = <span class="string">" "</span> + s1;</div><div class="line">    s2 = <span class="string">" "</span> + s2;</div><div class="line">    LCS(c,b,s1,s2,len1,len2);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len1;i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len2;j++) &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;c[i][j]&lt;&lt;<span class="string">" "</span>;</div><div class="line">            <span class="keyword">if</span>(j == len2<span class="number">-1</span>)</div><div class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"===============================\n"</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len1;i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;len2;j++) &#123;</div><div class="line">            <span class="built_in">cout</span>&lt;&lt;b[i][j]&lt;&lt;<span class="string">" "</span>;</div><div class="line">            <span class="keyword">if</span>(j == len2<span class="number">-1</span>)</div><div class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(c[len1<span class="number">-1</span>][len2<span class="number">-1</span>] == <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"0 0"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    TraceBack(len1,len2,c,b,s1);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span>** <span class="title">getArr</span><span class="params">(<span class="keyword">int</span> M,<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>** arr = <span class="keyword">new</span> <span class="keyword">int</span>*[M];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;M;i++) &#123;</div><div class="line">        arr[i] = <span class="keyword">new</span> <span class="keyword">int</span>[N];</div><div class="line">        <span class="built_in">memset</span>(arr[i],<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*N);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> arr;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS</span><span class="params">(<span class="keyword">int</span>** c,<span class="keyword">int</span>** b,<span class="built_in">string</span> s1,<span class="built_in">string</span> s2,<span class="keyword">int</span> m,<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;m;i++) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;n;j++) &#123;</div><div class="line">            <span class="keyword">if</span>(s1[i] == s2[j]) &#123;</div><div class="line">                c[i][j] = c[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</div><div class="line">                b[i][j] = <span class="number">1</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j] &gt; c[i][j<span class="number">-1</span>]) &#123;</div><div class="line">                c[i][j] = c[i<span class="number">-1</span>][j];</div><div class="line">                b[i][j] = <span class="number">2</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j] &lt; c[i][j<span class="number">-1</span>]) &#123;</div><div class="line">                c[i][j] = c[i][j<span class="number">-1</span>];</div><div class="line">                b[i][j] = <span class="number">3</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                c[i][j] = c[i<span class="number">-1</span>][j];</div><div class="line">                b[i][j] = <span class="number">4</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TraceBack</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span> n,<span class="keyword">int</span>** c,<span class="keyword">int</span>** b,<span class="built_in">string</span> str)</span> </span>&#123;</div><div class="line">    <span class="built_in">stack</span>&lt;node&gt; store, print;</div><div class="line">    node virtualNode = node(m,n,c[m<span class="number">-1</span>][n<span class="number">-1</span>]+<span class="number">1</span>);<span class="comment">//由虚拟结点引发循环</span></div><div class="line">    store.push(virtualNode);</div><div class="line">    node storeTop;</div><div class="line">    <span class="keyword">int</span> topLen,number=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(!store.empty()) &#123;</div><div class="line">        storeTop = store.top();</div><div class="line">        store.pop();</div><div class="line">        print.push(storeTop);</div><div class="line">        <span class="comment">// 判断弹出的元素是否是边界元素</span></div><div class="line">        <span class="keyword">if</span>(storeTop.x == <span class="number">1</span> || storeTop.y == <span class="number">1</span> || print.size() == c[m<span class="number">-1</span>][n<span class="number">-1</span>]+<span class="number">1</span>) &#123;</div><div class="line">            number++;</div><div class="line">            printStack(print,str);<span class="comment">// 是边界将print栈除虚拟结点的所有点打印</span></div><div class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;<span class="comment">// 数量太多不要输出这两行了</span></div><div class="line">            <span class="keyword">if</span>(!store.empty()) &#123;</div><div class="line">                topLen = store.top().lcsLen;</div><div class="line">                popPrint(print,topLen);<span class="comment">// 弹出小于等于store栈顶长度的print栈中的点</span></div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="comment">//不是边界说明还有下一跳</span></div><div class="line">            <span class="keyword">int</span> x = storeTop.x;</div><div class="line">            <span class="keyword">int</span> y = storeTop.y;</div><div class="line">            node e1 = findJump(x<span class="number">-1</span>,y<span class="number">-1</span>,b,c,<span class="number">0</span>);</div><div class="line">            node e2 = findJump(x<span class="number">-1</span>,y<span class="number">-1</span>,b,c,<span class="number">1</span>);</div><div class="line">            <span class="keyword">if</span>(e1 == e2) &#123;</div><div class="line">                store.push(e1);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                searchMatrix(e1,e2,c,b,store);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;number&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 输出print栈中所有元素</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStack</span><span class="params">(<span class="built_in">stack</span>&lt;node&gt; s,<span class="built_in">string</span> str)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(!s.empty()) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;str[s.top().x];</div><div class="line">        s.pop();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 弹出print栈中长度小于等于n的元素，相当于回到前一跳的状态</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">popPrint</span><span class="params">(<span class="built_in">stack</span>&lt;node&gt; &amp;s,<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">  <span class="comment">// 由于进入print栈点的lcsLen值是单调减，直接出栈直到lcsLen大于n，最底下的虚拟结点不能出栈</span></div><div class="line">    <span class="keyword">while</span>(s.top().lcsLen &lt;= n &amp;&amp; s.size() != <span class="number">1</span>) &#123;</div><div class="line">        s.pop();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 寻找所有下一跳，type为真：遇到跳跃点向左走，type为假：遇到跳跃点向上走，直到找到第一个跳跃点</span></div><div class="line"><span class="function">node <span class="title">findJump</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span>** b,<span class="keyword">int</span>** c,<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(type) &#123;</div><div class="line">        <span class="keyword">while</span>(b[x][y] != <span class="number">1</span>)&#123;<span class="comment">// 这里一定有下一个跳跃点，不用担心会找不到而越界</span></div><div class="line">        <span class="keyword">if</span>(b[x][y] == <span class="number">2</span>)</div><div class="line">            x--;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            y--;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">while</span>(b[x][y] != <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(b[x][y] == <span class="number">3</span>)</div><div class="line">            y--;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            x--;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> node(x,y,c);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 如果findJump找到的两个下一跳跃点不是一个点，则以这两个点为矩形搜索里面的跳跃点，视为下一跳跃点加入store栈中</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">searchMatrix</span><span class="params">(node e1,node e2,<span class="keyword">int</span>** c,<span class="keyword">int</span>** b,<span class="built_in">stack</span>&lt;node&gt;&amp; store)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x1 = e1.x;</div><div class="line">    <span class="keyword">int</span> y1 = e1.y;</div><div class="line">    <span class="keyword">int</span> x2 = e2.x;</div><div class="line">    <span class="keyword">int</span> y2 = e2.y;</div><div class="line">    <span class="keyword">int</span> temp;</div><div class="line">    <span class="keyword">if</span>(x1 &gt; x2) &#123;</div><div class="line">        temp = x1;</div><div class="line">        x1 = x2;</div><div class="line">        x2 = temp;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(y1 &gt; y2) &#123;</div><div class="line">        temp = y1;</div><div class="line">        y1 = y2;</div><div class="line">        y2 = temp;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=x2;i&gt;=x1;i--) &#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=y2;j&gt;=y1;j--) &#123;</div><div class="line">            <span class="keyword">if</span>(b[i][j] == <span class="number">1</span>)</div><div class="line">                store.push(node(i,j,c));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>根据算法的思想实现了代码，经过以下数据对直接遍历和矩阵搜索进行对比：</p><ol><li>ABCDCDABCD<br>BADCDCBADC</li><li>ABCDCDABCDABCDCDABCD<br>BADCDCBADCBADCDCBADC</li><li>ABCDCDABCDABCDCDABCDABCDCDABCD<br>BADCDCBADCBADCDCBADCBADCDCBADC</li><li>ABCDCDABCDABCDCDABCDABCDCDABCDABCDCDABCD<br>BADCDCBADCBADCDCBADCBADCDCBADCBADCDCBADC</li></ol></blockquote><div class="table-container"><table><thead><tr><th style="text-align:left">测试用例编号</th><th>LCS长度</th><th>所有LCS个数</th><th>直接遍历循环次数</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td>6</td><td>20</td><td>60</td></tr><tr><td style="text-align:left">2</td><td>12</td><td>700</td><td>7560</td></tr><tr><td style="text-align:left">3</td><td>18</td><td>25460</td><td>970200</td></tr><tr><td style="text-align:left">4</td><td>24</td><td>936540</td><td>没测出来</td></tr></tbody></table></div><blockquote><p>当字符串长度40时，简单的遍历所有路径就无法短时间显示结果了</p></blockquote>]]></content>
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Prim-Kruscal</title>
      <link href="/2017/08/13/Prim-Kruscal/"/>
      <url>/2017/08/13/Prim-Kruscal/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="贪心算法——最小生成树"><a href="#贪心算法——最小生成树" class="headerlink" title="贪心算法——最小生成树"></a>贪心算法——最小生成树</h1><blockquote><ol><li><p>G=(V,E) 是连通带权图，E 中每条边 (v,w) 的权为 c[v][w]，G 的一个子图 G’ 是一颗包含 G 的所有顶点的树，则称 G’ 为 G 的生成树，所有生成树中权值和最小的称为 G 的最小生成树</p></li><li><p>MST 性质：设 G=(V,E) 是连通带权图，U 是 V 中的一个真子集，若存在顶点 u∈U 和顶点 v∈V-U 的边（u，v）是一条具有最小权值的边，则必存在 G 的一棵最小生成树包括这条边（u，v）</p></li><li><p>Prim 和 Kruscal 都应用最小生成树的 MST 性质进行贪心选择</p></li><li><p>实例中连通带权图为<img src="/images/prim_kruscal/tu.jpg" alt="tu"></p><p>图的表示：邻接矩阵——使用二维数组存放两点之间的信息</p></li></ol></blockquote><h2 id="Prim-算法"><a href="#Prim-算法" class="headerlink" title="Prim 算法"></a>Prim 算法</h2><blockquote><p>设 G=(V,E) 是连通带权图，V = {1,2,…,n}</p><p>构造 G 的最小生成树的 Prim算法的基本思想是：首先置 S={1}，然后只要 S 是 V 的真子集，就做如下贪心选择：选取满足条件 i∈S，j∈V-S，且 c[i][j] 最小的边，并将顶点 j 添加到 S 中，这个过程一直进行到 S=V为止。这个过程中选取的所有边构成 G 的一颗最小生成树</p><p><img src="/images/prim_kruscal/prim.jpg" alt="prim.jpg"> </p></blockquote><p><em>Question:</em> 如何有效地找出满足 i∈S, j∈V-S，且权 c[i][j] 最小的边 (i,j) ?</p><a id="more"></a><p><strong>代码说明：</strong></p><blockquote><p>对于每个 j∈V-S，closest[j] 是 j 在 S 中的临界顶点，它与 j 在 S 中的其他临接顶点 k 相比较有：</p><p>c[j][closest[j]]≤c[j][k]</p><p>lowest[j] 的值就是 c[j][closest[j]]</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN 100001</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Prim</span><span class="params">(<span class="keyword">int</span>[<span class="number">100</span>][<span class="number">100</span>],<span class="keyword">int</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">int</span> arr[<span class="number">100</span>][<span class="number">100</span>];<span class="comment">// 存放两点之间连线的权值</span></div><div class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;N)) &#123;</div><div class="line">        <span class="comment">// 输入</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;N;j++) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;arr[i][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Prim</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"最小生成树权值和：%d\n"</span>,Prim(arr,N));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// lowcost[i]:V-S中点i到S中的点连线最小权值</span></div><div class="line"><span class="comment">// closet[i]:V-S中点i到s中权值最小连线应该连的点坐标</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Prim</span><span class="params">(<span class="keyword">int</span> c[<span class="number">100</span>][<span class="number">100</span>],<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> lowcost[N],closest[N], res=<span class="number">0</span>;</div><div class="line">    <span class="keyword">bool</span> s[N];</div><div class="line">    <span class="comment">// S 集合最开始只有0号元素时，对lowcost, clostest初始化</span></div><div class="line">    s[<span class="number">0</span>] = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;N;i++) &#123;</div><div class="line">        lowcost[i] = c[i][<span class="number">0</span>];   <span class="comment">// 最开始 S 中只有 0</span></div><div class="line">        closest[i] = <span class="number">0</span>;</div><div class="line">        s[i] = <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 将 V-S 集合中的元素放到 S 中</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;N;i++) &#123;</div><div class="line">        <span class="keyword">int</span> k, imin = MIN;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;N;j++) &#123;</div><div class="line">            <span class="keyword">if</span>(!s[j] &amp;&amp; lowcost[j] &lt; imin) &#123;</div><div class="line">                imin = lowcost[j];</div><div class="line">                k = j;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        s[k] = <span class="literal">true</span>;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d--%d \n"</span>,k,closest[k]);</div><div class="line">        res += imin;</div><div class="line">        <span class="comment">// 由于 S 中有了一个新的元素，V-S 中各点 lowcost 值可能发生变化</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;N;j++) &#123;</div><div class="line">            <span class="keyword">if</span>(!s[j] &amp;&amp; lowcost[j] &gt; c[j][k]) &#123;</div><div class="line">                lowcost[j] = c[j][k];</div><div class="line">                closest[j] = k;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">Input:</span></div><div class="line"><span class="comment">4</span></div><div class="line"><span class="comment">0 4 9 21</span></div><div class="line"><span class="comment">4 0 8 17</span></div><div class="line"><span class="comment">9 8 0 16</span></div><div class="line"><span class="comment">21 17 16 0</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure><h2 id="Kruscal-算法"><a href="#Kruscal-算法" class="headerlink" title="Kruscal 算法"></a>Kruscal 算法</h2><blockquote><p>先构造一个只含 n 个顶点、而边集为空的子图，把子图中各个顶点看成各棵树上的根结点，之后，从网的边集 E 中选取一条权值最小的边，若该条边的两个顶点分属不同的树，则将其加入子图，即把两棵树合成一棵树，反之，若该条边的两个顶点已落在同一棵树上，则不可取，而应该取下一条权值最小的边再试之。依次类推，直到森林中只有一棵树，也即子图中含有 n-1 条边为止</p><p><strong>简单的说：</strong> Kruscal 算法先找权值最小的边，检查这条边两个端点是否在一个集合中，如果不在一个集合中，连接两点(合并点所在集合)后找下一条权值最小的边；如果在一个集合，不连接两点直接找下一条权值最小的边，直到连接的边数为n-1为止</p><p><img src="/images/prim_kruscal/kruscal.jpg" alt="kruscal"></p></blockquote><p><em>Question:</em> </p><ul><li>怎样按权递增的顺序查看各边？</li><li>怎样判断两点是否在一个集合中？</li></ul><h3 id="优先队列和并查集"><a href="#优先队列和并查集" class="headerlink" title="优先队列和并查集"></a>优先队列和并查集</h3><blockquote><p>优先队列请见 <a href="/2017/02/06/priority-queue/">priority-queue</a></p><p>并查集（Union-find Sets）主要用于处理一些<em>不相交集合</em> 的合并问题，使用树形结构表示一个集合，树的每个节点就表示集合中的一个元素，树根作为集合的代表。</p><p><img src="https://ss0.baidu.com/6LVYsjip0QIZ8Aqbn9fN2DC/timg?pa&amp;quality=100&amp;size=w4096&amp;sec=1502580452&amp;di=dfb6266065b0e2a1f63bccd1587f64a4&amp;ref=&amp;imgtype=3&amp;src=http://images.cnitblog.com/blog/358550/201309/12160744-00b6e27da65b4b48b903e768a97bf888.png" alt=""></p><p>并查集的基本操作有三个：</p><ol><li><p>makeSet(s)：建立一个新的并查集，其中包含 s 个单元素集合。</p><p><img src="https://ss0.baidu.com/6LVYsjip0QIZ8Aqbn9fN2DC/timg?pa&amp;quality=100&amp;size=w4096&amp;sec=1502580452&amp;di=2b83a531e086dc93da48d329819fc113&amp;ref=&amp;imgtype=3&amp;src=http://images.cnitblog.com/blog/358550/201309/12160852-98560aa5c6764feeab476938d1bcfe24.png" alt="构造并查集初始化"></p></li><li><p>unionSet(x, y)：把元素 x 和元素 y 所在的集合合并，要求 x 和 y 所在的集合不相交，如果相交则不合并。</p></li><li><p>find(x)：找到元素 x 所在的集合的代表，该操作也可以用于判断两个元素是否位于同一个集合，只要将它们各自的代表比较一下就可以了。在find方法中，如果每次都沿着父节点向上查找，当树很高时，会降低查找效率（时间复杂度就是树的高度）有一种非常简单而有效的策略——路径压缩：</p></li><li><p>路径压缩，就是在每次查找时，令查找路径上的每个节点都直接指向根节点</p><p><img src="https://ss0.baidu.com/6LVYsjip0QIZ8Aqbn9fN2DC/timg?pa&amp;quality=100&amp;size=w4096&amp;sec=1502580452&amp;di=39cd479da65629e403608953a381ae81&amp;ref=&amp;imgtype=3&amp;src=http://images.cnitblog.com/blog/358550/201309/12160922-bc21dc9e11d645519c158e4f5153e20d.png" alt=""></p><p>这样查看每个元素所在树的根节点只需要一步</p></li><li><p>并查集的合并：将一个集合的树根指向另一个集合的树根</p><p><img src="https://ss0.baidu.com/6LVYsjip0QIZ8Aqbn9fN2DC/timg?pa&amp;quality=100&amp;size=w4096&amp;sec=1502580452&amp;di=f547dbac92c11e77a5fc3e32ff80658e&amp;ref=&amp;imgtype=3&amp;src=http://images.cnitblog.com/blog/358550/201309/12160946-86baa213cc204627af4ad9a4cef4a97a.png" alt=""></p><p>​合并策略——按秩合并：用秩表示树的高度，在合并时，总是将具有较小秩的树根指向具有较大秩的树根。简单的说，就是总是将比较矮的树作为子树，添加到较高的树中。代码中 urank[x] 表示 x 为根的树的高度</p></li></ol></blockquote><p><strong>使用优先队列将边升序排列（注意对自定义类型要重写 ‘&lt;’ 运算符）</strong></p><p><strong>使用并查集判断两点是否在一个集合上（根节点是否相等），合并两集合</strong> </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 100</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> arr[MAXSIZE][MAXSIZE];</div><div class="line"><span class="keyword">int</span> uset[MAXSIZE];  <span class="comment">// uset[i] :元素i所属集合的根节点</span></div><div class="line"><span class="keyword">int</span> urank[MAXSIZE]; <span class="comment">// urank[i] :元素i为根节点集合的高度</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Kruscal</span><span class="params">(<span class="keyword">int</span>)</span></span>;</div><div class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    <span class="keyword">int</span> weight;</div><div class="line">    Edge(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> weight) &#123;</div><div class="line">        <span class="keyword">this</span>-&gt;x = x;</div><div class="line">        <span class="keyword">this</span>-&gt;y = y;</div><div class="line">        <span class="keyword">this</span>-&gt;weight = weight;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (Edge edge1, Edge edge2) &#123;</div><div class="line">        <span class="keyword">return</span> edge1.weight &gt; edge2.weight;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">priority_queue&lt;Edge&gt; q;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> N;</div><div class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;N)) &#123;</div><div class="line">        res = <span class="number">0</span>;</div><div class="line">        <span class="comment">// 输入</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;N;j++) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;arr[i][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 将边放入优先队列中</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N<span class="number">-1</span>;i++) &#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;N;j++) &#123;</div><div class="line">                q.push(Edge(i,j,arr[i][j]));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        Kruscal(N);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">makeSet</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    <span class="comment">// 初始时每个元素独立成为一个集合，根节点是本身，集合（树）高度为0</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++) &#123;</div><div class="line">        uset[i] = i;</div><div class="line">        urank[i] = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">findRoot</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="comment">// 只有根节点的父节点是本身</span></div><div class="line">    <span class="keyword">if</span>(uset[x] == x) &#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 不是根节点递归寻找根节点，找到后赋值给uset[x]减少下次递归的次数，相当于压缩了到根节点的路径</span></div><div class="line">    <span class="keyword">return</span> uset[x] = findRoot(uset[x]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">unionSet</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">    <span class="comment">// 取 x,y 所在集合的根节点</span></div><div class="line">    x=findRoot(x);</div><div class="line">    y=findRoot(y);</div><div class="line">    <span class="comment">// x,y 属于一个集合，不可合并</span></div><div class="line">    <span class="keyword">if</span>(x == y) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// x,y 不在同一集合，将高度小的集合加到高度大的集合根节点</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(urank[x] &gt; urank[y]) &#123;</div><div class="line">        <span class="comment">// y 集合的根节点的父亲是 x 集合的根节点</span></div><div class="line">        uset[y] = x;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        uset[x] = y;</div><div class="line">        <span class="comment">// 高度相等，x所在集合根节点接到y集合根节点，y集合高度加一</span></div><div class="line">        <span class="keyword">if</span>(urank[x] == urank[y]) &#123;</div><div class="line">            urank[y]++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Kruscal</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</div><div class="line">    makeSet(N);</div><div class="line">    <span class="keyword">int</span> qsize = q.size();</div><div class="line">    <span class="keyword">int</span> lineNum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;qsize;i++) &#123;</div><div class="line">        <span class="comment">// e为当前最小权值边</span></div><div class="line">        Edge e = q.top();</div><div class="line">        <span class="comment">// 按权值降序处理每一条边，如果两点不在一个集合中，合并两点所在的集合返回true，说明生成了一条连线</span></div><div class="line">        <span class="keyword">if</span>(unionSet(e.x, e.y)) &#123;</div><div class="line">            lineNum ++;</div><div class="line">            res += arr[e.x][e.y];</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d--%d\n"</span>,e.x,e.y);</div><div class="line">            <span class="comment">// 连线数 = 点数 - 1 时为最小生成树，结束循环</span></div><div class="line">            <span class="keyword">if</span>(lineNum == N - <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        q.pop();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">Input:</span></div><div class="line"><span class="comment">4</span></div><div class="line"><span class="comment">0 4 9 21</span></div><div class="line"><span class="comment">4 0 8 17</span></div><div class="line"><span class="comment">9 8 0 16</span></div><div class="line"><span class="comment">21 17 16 0</span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> 算法 </category>
          
          <category> OJ 做题知识点积累 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springboot-mybatis小程序</title>
      <link href="/2017/04/09/springboot-mybatis/"/>
      <url>/2017/04/09/springboot-mybatis/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="IntelliJ开发SpringBoot-Mybatis应用程序"><a href="#IntelliJ开发SpringBoot-Mybatis应用程序" class="headerlink" title="IntelliJ开发SpringBoot-Mybatis应用程序"></a>IntelliJ开发SpringBoot-Mybatis应用程序</h1><h2 id="新建工程"><a href="#新建工程" class="headerlink" title="新建工程"></a>新建工程</h2><blockquote><p>new Project——Spring Initializr</p><p>填好工程Name，包路径Group,Package</p><p>Dependencies页面勾选Web，Mybatis，Mysql会自动帮你生产maven的pom文件，当然也可以自己后往里添加，maven会自动的帮你下载需要的依赖</p><p>Finish</p></blockquote><p><em>注：</em></p><p>maven默认中央仓库在国外可能使下载依赖很慢，可以修改maven的conf/settings.xml更换镜像地址：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </div><div class="line">   <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>          </div><div class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div></pre></td></tr></table></figure><h2 id="工程结构说明"><a href="#工程结构说明" class="headerlink" title="工程结构说明"></a>工程结构说明</h2><blockquote><p>main-java 目录下的 *Application 类是项目的启动类</p><p>main 下的 application.yml 是配置文件</p><p>test 是测试类的目录</p><p>pom.xml 是 maven 的依赖管理文件</p></blockquote><a id="more"></a><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p><em>配置文件有 .properties 和 .yml 两种，格式不同而已，下面的是 .yml</em></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">#server</div><div class="line">server:</div><div class="line">  port: 80</div><div class="line">#spring config</div><div class="line">spring:</div><div class="line">  aop:</div><div class="line">    auto: true</div><div class="line">  datasource:</div><div class="line">    name: *</div><div class="line">    url: jdbc:mysql://localhost:3306/*</div><div class="line">    driverClassName: com.mysql.jdbc.Driver</div><div class="line">    username: *</div><div class="line">    password: *</div><div class="line">    type: com.alibaba.druid.pool.DruidDataSource</div><div class="line">    maxActive: 1000</div><div class="line">    initialSize: 5</div><div class="line">    maxWait: 60000</div><div class="line">    minIdle: 1</div><div class="line">    timeBetweenEvictionRunsMillis: 60000</div><div class="line">    minEvictableIdleTimeMillis: 300000</div><div class="line">    testWhileIdle: true</div><div class="line">    testOnBorrow: false</div><div class="line">    testOnReturn: false</div><div class="line">    poolPreparedStatements: true</div><div class="line">    maxOpenPreparedStatements: 20</div><div class="line"></div><div class="line"># MyBatis</div><div class="line">mybatis:</div><div class="line">  type-aliases-package: com.zjm.model</div><div class="line">  mapper-locations: classpath:/mapper/*.xml</div><div class="line">  configuration:</div><div class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</div><div class="line"></div><div class="line">#PageHelper</div><div class="line">pagehelper:</div><div class="line">  offsetAsPageNum: true</div><div class="line">  rowBoundsWithCount: true</div><div class="line">  reasonable: true</div></pre></td></tr></table></figure><h2 id="编写Mybatis-小程序"><a href="#编写Mybatis-小程序" class="headerlink" title="编写Mybatis 小程序"></a>编写Mybatis 小程序</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><blockquote><ul><li>在上面的配置文件中 Mybatis 的配置项里</li></ul><p><em>type-aliases-package：是对象类的路径</em> (main.java.com.*.model下)</p><p><em>mapper-locations：是对象dao类对应的 .xml 的路径</em> (main.resource.mapper下)</p><p>建立以上路径及com.*.dao</p><ul><li>在pom.xml中加入依赖：(在<dependencies>标签中)</dependencies></li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure><blockquote><ul><li>在*Application.java文件的类上加入</li></ul><p>@MapperScan(basePackages = “com.zjm.dao”)</p><p>@SpringBootApplication</p><p>这两个注解</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.zjm.dao"</span>)</div><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IshopApplication</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">SpringApplication.run(IshopApplication.class, args);</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h4 id="User"><a href="#User" class="headerlink" title="User"></a>User</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm.model;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Integer id;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String nickname;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String password;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String phone;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Date regdate;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Integer sex;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String head;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> nickname;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickname</span><span class="params">(String nickname)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.nickname = nickname == <span class="keyword">null</span> ? <span class="keyword">null</span> : nickname.trim();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> password;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.password = password == <span class="keyword">null</span> ? <span class="keyword">null</span> : password.trim();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> phone;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(String phone)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.phone = phone == <span class="keyword">null</span> ? <span class="keyword">null</span> : phone.trim();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> email;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.email = email == <span class="keyword">null</span> ? <span class="keyword">null</span> : email.trim();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getRegdate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> regdate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRegdate</span><span class="params">(Date regdate)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.regdate = regdate;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getSex</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> sex;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(Integer sex)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.sex = sex;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHead</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> head;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHead</span><span class="params">(String head)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.head = head == <span class="keyword">null</span> ? <span class="keyword">null</span> : head.trim();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</div><div class="line">                <span class="string">"id="</span> + id +</div><div class="line">                <span class="string">", nickname='"</span> + nickname + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", password='"</span> + password + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", phone='"</span> + phone + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", email='"</span> + email + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", regdate="</span> + regdate +</div><div class="line">                <span class="string">", sex="</span> + sex +</div><div class="line">                <span class="string">", head='"</span> + head + <span class="string">'\''</span> +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="UserMapper"><a href="#UserMapper" class="headerlink" title="UserMapper"></a>UserMapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm.dao;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.zjm.model.User;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer id)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(User record)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(User record)</span></span>;</div><div class="line"></div><div class="line">    <span class="function">User <span class="title">selectByPrimaryKey</span><span class="params">(Integer id)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(User record)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(User record)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="UserMapper-xml"><a href="#UserMapper-xml" class="headerlink" title="UserMapper.xml"></a>UserMapper.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zjm.dao.UserMapper"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span> <span class="attr">type</span>=<span class="string">"com.zjm.model.User"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"Id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"nickName"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"nickname"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"password"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"phone"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"phone"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"email"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"regDate"</span> <span class="attr">jdbcType</span>=<span class="string">"DATE"</span> <span class="attr">property</span>=<span class="string">"regdate"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"sex"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"head"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"head"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"Base_Column_List"</span>&gt;</span></div><div class="line">    Id, nickName, password, phone, email, regDate, sex, head</div><div class="line">  <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByPrimaryKey"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Integer"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></div><div class="line">    select </div><div class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"Base_Column_List"</span> /&gt;</span></div><div class="line">    from user</div><div class="line">    where Id = #&#123;id,jdbcType=INTEGER&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUserByExample"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></div><div class="line">    SELECT</div><div class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"Base_Column_List"</span> /&gt;</span></div><div class="line">    FROM USER</div><div class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null"</span>&gt;</span></div><div class="line">        Id = #&#123;id&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname != null"</span>&gt;</span></div><div class="line">        nickName = #&#123;nickname&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></div><div class="line">        password = #&#123;password&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span></div><div class="line">        phone = #&#123;phone&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email != null"</span>&gt;</span></div><div class="line">        email = #&#123;email&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteByPrimaryKey"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></div><div class="line">    delete from user</div><div class="line">    where Id = #&#123;id,jdbcType=INTEGER&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"com.zjm.model.User"</span>&gt;</span></div><div class="line">    insert into user (Id, nickName, password, </div><div class="line">      phone, email, regDate, </div><div class="line">      sex, head)</div><div class="line">    values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;nickname,jdbcType=VARCHAR&#125;, #&#123;password,jdbcType=VARCHAR&#125;, </div><div class="line">      #&#123;phone,jdbcType=VARCHAR&#125;, #&#123;email,jdbcType=VARCHAR&#125;, #&#123;regdate,jdbcType=DATE&#125;, </div><div class="line">      #&#123;sex,jdbcType=INTEGER&#125;, #&#123;head,jdbcType=VARCHAR&#125;)</div><div class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertSelective"</span> <span class="attr">parameterType</span>=<span class="string">"com.zjm.model.User"</span>&gt;</span></div><div class="line">    insert into user</div><div class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null"</span>&gt;</span></div><div class="line">        Id,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname != null"</span>&gt;</span></div><div class="line">        nickName,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></div><div class="line">        password,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span></div><div class="line">        phone,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email != null"</span>&gt;</span></div><div class="line">        email,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"regdate != null"</span>&gt;</span></div><div class="line">        regDate,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null"</span>&gt;</span></div><div class="line">        sex,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"head != null"</span>&gt;</span></div><div class="line">        head,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"values ("</span> <span class="attr">suffix</span>=<span class="string">")"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id != null"</span>&gt;</span></div><div class="line">        #&#123;id,jdbcType=INTEGER&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname != null"</span>&gt;</span></div><div class="line">        #&#123;nickname,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></div><div class="line">        #&#123;password,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span></div><div class="line">        #&#123;phone,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email != null"</span>&gt;</span></div><div class="line">        #&#123;email,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"regdate != null"</span>&gt;</span></div><div class="line">        #&#123;regdate,jdbcType=DATE&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null"</span>&gt;</span></div><div class="line">        #&#123;sex,jdbcType=INTEGER&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"head != null"</span>&gt;</span></div><div class="line">        #&#123;head,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByPrimaryKeySelective"</span> <span class="attr">parameterType</span>=<span class="string">"com.zjm.model.User"</span>&gt;</span></div><div class="line">    update user</div><div class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nickname != null"</span>&gt;</span></div><div class="line">        nickName = #&#123;nickname,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span></div><div class="line">        password = #&#123;password,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span></div><div class="line">        phone = #&#123;phone,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email != null"</span>&gt;</span></div><div class="line">        email = #&#123;email,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"regdate != null"</span>&gt;</span></div><div class="line">        regDate = #&#123;regdate,jdbcType=DATE&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"sex != null"</span>&gt;</span></div><div class="line">        sex = #&#123;sex,jdbcType=INTEGER&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"head != null"</span>&gt;</span></div><div class="line">        head = #&#123;head,jdbcType=VARCHAR&#125;,</div><div class="line">      <span class="tag">&lt;/<span class="name">if</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    where Id = #&#123;id,jdbcType=INTEGER&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByPrimaryKey"</span> <span class="attr">parameterType</span>=<span class="string">"com.zjm.model.User"</span>&gt;</span></div><div class="line">    update user</div><div class="line">    set nickName = #&#123;nickname,jdbcType=VARCHAR&#125;,</div><div class="line">      password = #&#123;password,jdbcType=VARCHAR&#125;,</div><div class="line">      phone = #&#123;phone,jdbcType=VARCHAR&#125;,</div><div class="line">      email = #&#123;email,jdbcType=VARCHAR&#125;,</div><div class="line">      regDate = #&#123;regdate,jdbcType=DATE&#125;,</div><div class="line">      sex = #&#123;sex,jdbcType=INTEGER&#125;,</div><div class="line">      head = #&#123;head,jdbcType=VARCHAR&#125;</div><div class="line">    where Id = #&#123;id,jdbcType=INTEGER&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure><h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><p><em>进入UserMapper.java，右键——Go to—— Test——Create new test</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm.dao;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.zjm.model.User;</div><div class="line"><span class="keyword">import</span> com.zjm.util.MD5;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</div><div class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by ZJM on 2017/4/5.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@SpringBootTest</span></div><div class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> UserMapper userMapper;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByPrimaryKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        userMapper.deleteByPrimaryKey(<span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        User user = <span class="keyword">new</span> User();</div><div class="line">        user.setPhone(<span class="string">"13636662259"</span>);</div><div class="line">        user.setSex(<span class="number">0</span>);</div><div class="line">        user.setEmail(<span class="string">"7788521@qq.com"</span>);</div><div class="line">        user.setNickname(<span class="string">"zjm"</span>);</div><div class="line">        user.setPassword(<span class="string">"123456"</span>);</div><div class="line">        user.setRegdate(<span class="keyword">new</span> Date());</div><div class="line">        userMapper.insert(user);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertSelective</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectByPrimaryKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        User user = userMapper.selectByPrimaryKey(<span class="number">1</span>);</div><div class="line">        System.out.println(user);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        User user = <span class="keyword">new</span> User();</div><div class="line">        user.setId(<span class="number">1</span>);</div><div class="line">        user.setNickname(<span class="string">"shaunHaHaHa"</span>);</div><div class="line">        userMapper.updateByPrimaryKeySelective(user);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateByPrimaryKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">  </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectUserByExample</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        User user = <span class="keyword">new</span> User();</div><div class="line">        user.setPassword(<span class="string">"123456"</span>);</div><div class="line">        System.out.println(userMapper.selectUserByExample(user));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>点击方法旁边的绿色按钮运行就行了</p><h2 id="发请求测试"><a href="#发请求测试" class="headerlink" title="发请求测试"></a>发请求测试</h2><p><em>上面的是 JUnit 的单元测试，现在用发请求的方式从服务器获取响应</em></p><p><em>正常需要在controller和mapper中间建立service层，这里示例业务简单，简化省去了service层，正式的项目中再加上</em></p><h3 id="新建controller"><a href="#新建controller" class="headerlink" title="新建controller"></a>新建controller</h3><blockquote><p>在com.*.controller下新建UserMS.java</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zjm.controller;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.sun.javafx.collections.MappingChange;</div><div class="line"><span class="keyword">import</span> com.zjm.dao.UserMapper;</div><div class="line"><span class="keyword">import</span> com.zjm.model.User;</div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Created by ZJM on 2017/4/8.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMS</span> </span>&#123;</div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="keyword">private</span> UserMapper userMapper;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"add"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">add</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        userMapper.insert(user);</div><div class="line">        <span class="keyword">return</span> user;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"delete"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">delete</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;String,Object&gt;();</div><div class="line">        <span class="keyword">boolean</span> isOk = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            userMapper.deleteByPrimaryKey(id);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            isOk = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        map.put(<span class="string">"status"</span>,isOk);</div><div class="line">        <span class="keyword">return</span> map;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"update"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">update</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        userMapper.updateByPrimaryKeySelective(user);</div><div class="line">        <span class="keyword">return</span> user;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"findUserById"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> userMapper.selectByPrimaryKey(id);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"findUserByExample"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserByExample</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> userMapper.selectUserByExample(user);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p><em>*Application.java文件点击绿色三角，即可启动 IntelliJ 自带的 tomcat，按照配置的服务名及端口访问吧</em></p><h3 id="发请求"><a href="#发请求" class="headerlink" title="发请求"></a>发请求</h3><p><em>安装postman或者浏览器发送请求</em></p><p><strong>eg</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">http://localhost:8080/user/findUserById?id=1</div><div class="line">http://localhost:8080/user/findUserByExample?sex=1</div><div class="line">http://localhost:8080/user/delete?id=5</div><div class="line">http://localhost:8080/user/update?id=6&amp;nickname=小王</div></pre></td></tr></table></figure><p>要是用浏览器发post请求还得写表单，post请求就用 postman 发吧</p><p><strong>到此一个简单的例子就可以运行了 </strong></p>]]></content>
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> IntelliJ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos下安装jdk和Tomcat</title>
      <link href="/2017/03/05/install-jdk-tomcat/"/>
      <url>/2017/03/05/install-jdk-tomcat/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h3 id="用yum安装jdk"><a href="#用yum安装jdk" class="headerlink" title="用yum安装jdk"></a>用yum安装jdk</h3><h4 id="查看-yum-库中都有哪些-jdk-版本（暂时只发现了-openjdk）"><a href="#查看-yum-库中都有哪些-jdk-版本（暂时只发现了-openjdk）" class="headerlink" title="查看 yum 库中都有哪些 jdk 版本（暂时只发现了 openjdk）"></a>查看 yum 库中都有哪些 jdk 版本（暂时只发现了 openjdk）</h4><p><code>yum search java|grep jdk</code></p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><code>yum install java-1.7.0-openjdk</code></p><h4 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h4><p>在profile文件中添加如下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"><span class="built_in">set</span> java environment</span></div><div class="line">JAVA_HOME=/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.131</div><div class="line"><span class="meta">#</span><span class="bash">复制路径以防路径无法找到</span></div><div class="line">JRE_HOME=$JAVA_HOME/jre</div><div class="line">CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</div><div class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</div><div class="line">export JAVA_HOME JRE_HOME CLASS_PATH PATH</div></pre></td></tr></table></figure><p>让修改生效</p><p><code>source /etc/profile</code></p><a id="more"></a><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><p><code>java -version</code></p><h3 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h3><h4 id="使用wget命令："><a href="#使用wget命令：" class="headerlink" title="使用wget命令："></a>使用wget命令：</h4><p><code>wget -c http://apache.fayea.com/tomcat/tomcat-8/v8.5.11/bin/apache-tomcat-8.5.11.tar.gz</code></p><h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><p><code>tar -zxvf apache-tomcat-8.5.11.tar.gz</code></p><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><p>进入解压后的<code>apache-tomcat-8.5.11 -- bin</code>目录，执行命令：</p><p><code>./startup.sh</code></p><h4 id="检查能否访问"><a href="#检查能否访问" class="headerlink" title="检查能否访问"></a>检查能否访问</h4><p><em>如果不能访问，可能是防火墙问题：</em></p><ul><li><p>关闭防火墙： <code>service firewalld stop</code></p></li><li><p>在<code>iptables</code>里添加开放 8080 端口： <code>-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT</code></p><p>将iptables服务重启： <code>service iptables restart</code></p></li></ul>]]></content>
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos下安装mysql</title>
      <link href="/2017/03/05/install-mysql/"/>
      <url>/2017/03/05/install-mysql/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h2 id="yum-安装"><a href="#yum-安装" class="headerlink" title="yum 安装"></a>yum 安装</h2><p><code>yum install -y mysql-server mysql mysql-devel</code></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p><code>service mysqld start</code></p><h2 id="给root用户设置密码"><a href="#给root用户设置密码" class="headerlink" title="给root用户设置密码"></a>给root用户设置密码</h2><p><code>mysqladmin -u root password &#39;your password&#39;</code></p><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p><code>mysql -u root -p</code></p><h2 id="查看并更改字符集"><a href="#查看并更改字符集" class="headerlink" title="查看并更改字符集"></a>查看并更改字符集</h2><p><code>show variables like &#39;character%&#39;;</code></p><a id="more"></a><p>关闭mysql服务</p><p><code>service mysqld stop</code></p><p>修改my.cnf文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">default-character-set = utf8    #这个是我添加的</div><div class="line">character_set_server=utf8      #这个是我添加的</div><div class="line">init_connect='SET NAMES utf8'</div><div class="line">datadir=/var/lib/mysql</div><div class="line">socket=/var/lib/mysql/mysql.sock</div><div class="line">user=mysql</div><div class="line">symbolic-links=0</div><div class="line"> </div><div class="line">[mysqld_safe]</div><div class="line">default-character-set = utf8    #这个是我添加的</div><div class="line">log-error=/var/log/mysqld.log</div><div class="line">pid-file=/var/run/mysqld/mysqld.pid</div><div class="line"> </div><div class="line">[client]</div><div class="line">default-character-set = utf8      #这个是我添加的</div><div class="line"> </div><div class="line">[mysql.server]</div><div class="line">default-character-set = utf8      #这个是我添加的</div><div class="line"> </div><div class="line">[mysql]</div><div class="line">default-character-set = utf8      #这个是我添加的</div></pre></td></tr></table></figure><h2 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h2><p><code>service mysqld restart</code></p><h2 id="查看监听端口"><a href="#查看监听端口" class="headerlink" title="查看监听端口"></a>查看监听端口</h2><p><code>netstat -anp</code></p><p>mysql数据库绑定的默认端口号是 3306</p><h2 id="用本地可视化工具连接服务器数据库"><a href="#用本地可视化工具连接服务器数据库" class="headerlink" title="用本地可视化工具连接服务器数据库"></a>用本地可视化工具连接服务器数据库</h2><p>在服务器端进入mysql服务，执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;your password by root&apos;;</div><div class="line">flush privileges;</div></pre></td></tr></table></figure><p><em>在本地即可登录访问</em></p>]]></content>
      
      <categories>
          
          <category> 运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>priority_queue</title>
      <link href="/2017/02/06/priority-queue/"/>
      <url>/2017/02/06/priority-queue/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="STL-priority-queue-优先队列"><a href="#STL-priority-queue-优先队列" class="headerlink" title="STL priority_queue 优先队列"></a>STL priority_queue 优先队列</h1><p><strong>在优先队列中，优先级高的元素先出队列</strong></p><blockquote><p>class template</p><h1 id="std-priority-queue"><a href="#std-priority-queue" class="headerlink" title="std::priority_queue"></a>std::priority_queue</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, </span></div><div class="line"><span class="class">   <span class="title">class</span> <span class="title">Container</span> = <span class="title">vector</span>&lt;T&gt;,</span></div><div class="line"><span class="class">   <span class="title">class</span> <span class="title">Compare</span> = <span class="title">less</span>&lt;typename Container::value_type&gt; &gt; <span class="title">class</span>  </span></div><div class="line"><span class="class">   <span class="title">priority_queue</span>;</span></div></pre></td></tr></table></figure></blockquote><a id="more"></a><blockquote><h3 id="Priority-queue"><a href="#Priority-queue" class="headerlink" title="Priority queue"></a>Priority queue</h3><p>Priority queues are a type of container adaptors, specifically designed such that its first element is always the greatest of the elements it contains, according to some <em>strict weak ordering</em> criterion.<br>This context is similar to a <em>heap</em>, where elements can be inserted at any moment, and only the <em>max heap</em>element can be retrieved (the one at the top in the <em>priority queue</em>).<br>Priority queues are implemented as <em>container adaptors</em>, which are classes that use an encapsulated object of a specific container class as its <em>underlying container</em>, providing a specific set of member functions to access its elements. Elements are <em>popped</em> from the <em>“back”</em> of the specific container, which is known as the <em>top</em> of the priority queue.</p><p>The standard container classes <a href="http://www.cplusplus.com/vector" target="_blank" rel="external">vector</a> and <a href="http://www.cplusplus.com/deque" target="_blank" rel="external">deque</a> fulfill these requirements. By default, if no container class is specified for a particular <a href="http://www.cplusplus.com/priority_queue" target="_blank" rel="external">priority_queue</a> class instantiation, the standard container <a href="http://www.cplusplus.com/vector" target="_blank" rel="external">vector</a> is used.<br>Support of <em>random access iterators</em> is required to keep a heap structure internally at all times. This is done automatically by the container adaptor by automatically calling the algorithm functions <a href="http://www.cplusplus.com/make_heap" target="_blank" rel="external">make_heap</a>, <a href="http://www.cplusplus.com/push_heap" target="_blank" rel="external">push_heap</a> and <a href="http://www.cplusplus.com/pop_heap" target="_blank" rel="external">pop_heap</a> when needed.</p><h3 id="Template-parameters"><a href="#Template-parameters" class="headerlink" title="Template parameters"></a>Template parameters</h3><ul><li><p>T</p><p>Type of the elements.Aliased as member type priority_queue::value_type.</p></li><li><p>Container</p><p>Type of the internal <em>underlying container</em> object where the elements are stored.Its value_type shall be T.Aliased as member type priority_queue::container_type.</p></li><li><p>Compare</p><p>A binary predicate that takes two elements (of type T) as arguments and returns a <code>bool</code>.The expression <code>comp(a,b)</code>, where comp is an object of this type and a and b are elements in the container, shall return <code>true</code> if a is considered to go before b in the <em>strict weak ordering</em> the function defines.The priority_queue uses this function to maintain the elements sorted in a way that preserves <em>heap properties</em> (i.e., that the element popped is the last according to this <em>strict weak ordering</em>).This can be a function pointer or a function object, and defaults to <code>less</code>, which returns the same as applying the <em>less-than operator</em> (`a).</p></li></ul></blockquote><h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><blockquote><p>priority_queue 将其中的元素默认按照从大到小排列</p><p>默认声明：priority_queue&lt; T , vector , less &gt; q;</p><p>默认声明可省略为：priority_queue q;</p><p>声明为从小到大：priority_queue&lt; T , vector , greater &gt; q;</p><p>如果T是自定义类型，则必须重载operator&lt;</p></blockquote><h3 id="eg"><a href="#eg" class="headerlink" title="eg"></a>eg</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> &#123;</span></div><div class="line">    <span class="built_in">string</span> name;</div><div class="line"><span class="keyword">int</span> score;</div><div class="line">Student(<span class="built_in">string</span> name,<span class="keyword">int</span> score) &#123;</div><div class="line">        <span class="keyword">this</span>-&gt;name = name;</div><div class="line">        <span class="keyword">this</span>-&gt;score = score;</div><div class="line">&#125;</div><div class="line"><span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (Student stu1,Student stu2) &#123;</div><div class="line"><span class="keyword">return</span> stu1.score &lt; stu2.score;</div><div class="line">&#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    Student stu[<span class="number">3</span>] = &#123;</div><div class="line">        Student(<span class="string">"Tom"</span>,<span class="number">80</span>),</div><div class="line">        Student(<span class="string">"Jerry"</span>,<span class="number">100</span>),</div><div class="line">        Student(<span class="string">"Marry"</span>,<span class="number">90</span>)</div><div class="line">    &#125;;</div><div class="line">    priority_queue&lt;Student&gt; q;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) &#123;</div><div class="line">        q.push(stu[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;q.size()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) &#123;</div><div class="line">        Student s = q.top();</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;s.name&lt;&lt;<span class="string">", "</span>&lt;&lt;s.score&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        q.pop();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> OJ 做题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Share~</title>
      <link href="/2017/01/24/ky/"/>
      <url>/2017/01/24/ky/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="分享给朋友的"><a href="#分享给朋友的" class="headerlink" title="分享给朋友的"></a>分享给朋友的</h1><p><em>Dear Mao Shuo</em>:</p><blockquote><p>你看历年分数线先给自己各科定个小目标，100+100+50+50啊，关注几个老师的微博，微信公众号：蒋中挺，何凯文，张宇，刘一男……都会有免费的直播，何凯文还有每日一句，有时间就看，没时间就算了别当负担，我每日一句就跟了一阵。直播课感觉蒋中挺的挺好的，还有回放，英语数学我都没咋听，不过我还是推荐听。我学的时间里有效的部分太少了：早上九点开始，两个半小时去吃饭，中午ZZZ，下午两点开始，三个小时又吃饭，晚上六点开始，四个小时回寝，一天最多十个小时的学习时间，真正有收获的没多少。。。我九月份还报了文都的秋季班（补暑假课程的班），因为我暑假有实训。文都的课好也不好，为了赶进度，有时一天看十个多小时的视频。往往一天下来很累了，回来就没有把一天的课进行总结整理笔记。我有一次整理了一次，花了很多时间，因为课上的内容太多，老师说的很快，好多听不懂的需要课后自己整理复习，如果没有总结复习，那课久了回看笔记就看不懂了，还会越堆越多。所以，不及时总结复习，课就等于白上，还浪费大量的时间和精力。</p></blockquote><a id="more"></a><blockquote><p>其实还是自己总结最重要了，看视频，做题，再多，自己不理解归纳总结知识点，意义都不大。做题我有一招特别好使，如果你知道这道题考的考点是什么，你一定能做对。所以，数学背笔记时一定要背考点，12345…</p><p>复习计划早制定，专业课早开始，政治选择早开始，真的不是很难，别害怕，就是路漫漫修远，坚持下来不容易。</p><p>如果我调剂不到好的学校，就做研友；复试通过，就给你书…</p></blockquote><p><em>Good luck</em></p><p><em>Shaun</em></p>]]></content>
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>排序算法小结</title>
      <link href="/2017/01/23/sort/"/>
      <url>/2017/01/23/sort/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="数据结构排序算法时空稳"><a href="#数据结构排序算法时空稳" class="headerlink" title="数据结构排序算法时空稳"></a>数据结构排序算法时空稳</h1><div class="table-container"><table><thead><tr><th>分类</th><th>排序方法</th><th>平均情况(时)</th><th>最坏(时)</th><th>最好(时)</th><th>空间复杂度</th><th>稳定性</th></tr></thead><tbody><tr><td>插入</td><td>直接插入</td><td>O(n*n)</td><td>O(n*n)</td><td>O(n)</td><td>O(1)</td><td>稳</td></tr><tr><td></td><td>折半插入</td><td>O(n*n)</td><td></td><td></td><td>O(1)</td><td>稳</td></tr><tr><td></td><td>希尔</td><td>O(nlogn)</td><td>O(nlogn)</td><td></td><td>O(1)</td><td>不稳</td></tr><tr><td>交换</td><td>冒泡</td><td>O(n*n)</td><td>O(n*n)</td><td>O(n)</td><td>O(1)</td><td>稳</td></tr><tr><td></td><td>快速</td><td>O(nlogn)</td><td>O(n*n)</td><td>O(nlogn)</td><td>O(logn)</td><td>不稳</td></tr><tr><td>选择</td><td>简单选择</td><td>O(n*n)</td><td>O(n*n)</td><td>O(n*n)</td><td>O(1)</td><td>不稳</td></tr><tr><td></td><td>堆排</td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(1)</td><td>不稳</td></tr><tr><td>其他</td><td>归并</td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(nlogn)</td><td>O(n)</td><td>稳</td></tr><tr><td></td><td>基数</td><td>O(d(n+r))</td><td>O(d(n+r))</td><td>O(d(n+r))</td><td>O(r)</td><td>稳</td></tr></tbody></table></div><a id="more"></a><h1 id="常见排序java实现"><a href="#常见排序java实现" class="headerlink" title="常见排序java实现"></a>常见排序java实现</h1><h2 id="直接插入"><a href="#直接插入" class="headerlink" title="直接插入"></a>直接插入</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">isort</span><span class="params">(<span class="keyword">int</span>[] data)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;data.length; i++) &#123;</div><div class="line"><span class="keyword">int</span> temp = data[i];</div><div class="line"><span class="keyword">int</span> j = i-<span class="number">1</span>;</div><div class="line"><span class="keyword">while</span> (j &gt;=<span class="number">0</span> &amp;&amp; temp &lt; data[j]) &#123;</div><div class="line">data[j+<span class="number">1</span>] = data[j--];</div><div class="line">&#125;</div><div class="line">data[j+<span class="number">1</span>] = temp;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectSort</span> </span>&#123;</div><div class="line"><span class="comment">// 找到待排序中最小或者最大</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">s_sort</span><span class="params">(<span class="keyword">int</span>[] data)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;data.length-<span class="number">1</span>; i++) &#123;</div><div class="line"><span class="keyword">int</span> k = i;<span class="comment">// 记录待排序中最小下标</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>; j&lt;data.length; j++) &#123;</div><div class="line"><span class="keyword">if</span> (data[j] &lt; data[k]) &#123;</div><div class="line">k = j;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 将最小放到最前面</span></div><div class="line"><span class="keyword">if</span> (k != i) &#123;</div><div class="line"><span class="keyword">int</span> temp = data[k];</div><div class="line">data[k] = data[i];</div><div class="line">data[i] = temp;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="快排"><a href="#快排" class="headerlink" title="快排"></a>快排</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] arr;</div><div class="line"></div><div class="line"><span class="comment">// 讲一个数字放到正确的位置，左边都比它小，右边都比它大</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span> low, <span class="keyword">int</span> high)</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> label = arr[low];</div><div class="line"><span class="keyword">while</span> (low &lt; high) &#123;</div><div class="line"><span class="keyword">while</span> (low &lt; high &amp;&amp; arr[high] &gt;= label)</div><div class="line">high --;</div><div class="line">arr[low] = arr[high];</div><div class="line"><span class="keyword">while</span> (low &lt; high &amp;&amp; arr[low] &lt;= label)</div><div class="line">low ++;</div><div class="line">arr[high] = arr[low];</div><div class="line">&#125;</div><div class="line">arr[low] = label;</div><div class="line"><span class="keyword">return</span> low;</div><div class="line">&#125;</div><div class="line">    </div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] qsort(<span class="keyword">int</span> low, <span class="keyword">int</span> high) &#123;</div><div class="line"><span class="keyword">if</span> (low &lt; high) &#123;</div><div class="line"><span class="keyword">int</span> mid = partition(low, high);</div><div class="line">qsort(low, mid-<span class="number">1</span>);</div><div class="line">qsort(mid+<span class="number">1</span>, high);</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> arr;</div><div class="line">&#125;</div><div class="line">    </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] qsort(<span class="keyword">int</span>[] data) &#123;</div><div class="line">arr = data;</div><div class="line">qsort(<span class="number">0</span>, arr.length-<span class="number">1</span>);</div><div class="line"><span class="keyword">return</span> arr;</div><div class="line">&#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bsort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;arr.length-<span class="number">1</span>; i++) &#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j=arr.length-<span class="number">1</span>; j&gt;i; j--) &#123;</div><div class="line"><span class="comment">// 将小的前移</span></div><div class="line"><span class="keyword">if</span> (arr[j] &lt; arr[j-<span class="number">1</span>]) &#123;</div><div class="line">temp = arr[j];</div><div class="line">arr[j] = arr[j-<span class="number">1</span>];</div><div class="line">arr[j-<span class="number">1</span>] = temp;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="堆排"><a href="#堆排" class="headerlink" title="堆排"></a>堆排</h2><h2 id="归并"><a href="#归并" class="headerlink" title="归并"></a>归并</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] data;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</div><div class="line">data = arr;</div><div class="line">mergeSort(<span class="number">1</span>, data.length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</div><div class="line"><span class="keyword">if</span> (end &gt; start) &#123;</div><div class="line"><span class="keyword">int</span> mid = (start + end) / <span class="number">2</span>;</div><div class="line">mergeSort(start, mid);</div><div class="line">mergeSort(mid+<span class="number">1</span>, end);</div><div class="line">merge(start, mid, end);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> mid, <span class="keyword">int</span> end)</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> len1 = mid - start + <span class="number">1</span>;</div><div class="line"><span class="keyword">int</span> len2 = end - mid;</div><div class="line"><span class="keyword">int</span>[] arr1 = <span class="keyword">new</span> <span class="keyword">int</span>[len1 + <span class="number">1</span>];</div><div class="line"><span class="keyword">int</span>[] arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[len2 + <span class="number">1</span>];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len1; i++) &#123;</div><div class="line">arr1[i] = data[start+i-<span class="number">1</span>];</div><div class="line">&#125;</div><div class="line">arr1[len1] = Integer.MAX_VALUE;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;len2; i++) &#123;</div><div class="line">arr2[i] = data[i+mid];</div><div class="line">&#125;</div><div class="line">arr2[len2] = Integer.MAX_VALUE;</div><div class="line"><span class="keyword">int</span> m = <span class="number">0</span>, n = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=start-<span class="number">1</span>; i&lt;end; i++) &#123;</div><div class="line"><span class="keyword">if</span> (arr1[m] &gt; arr2[n]) &#123;</div><div class="line">data[i] = arr2[n++];</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">data[i] = arr1[m++];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="希尔"><a href="#希尔" class="headerlink" title="希尔"></a>希尔</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellSort</span> </span>&#123;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> gap=arr.length/<span class="number">2</span>; gap&gt;<span class="number">0</span>; gap/=<span class="number">2</span>) &#123;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=gap; i&lt;arr.length; i++) &#123;</div><div class="line"><span class="keyword">int</span> j = i;</div><div class="line"><span class="keyword">int</span> temp = arr[j];</div><div class="line"><span class="keyword">if</span> (arr[j] &lt; arr[j-gap]) &#123;</div><div class="line"><span class="keyword">while</span> (j-gap&gt;=<span class="number">0</span> &amp;&amp; temp &lt; arr[j-gap]) &#123;</div><div class="line">arr[j] = arr[j-gap];</div><div class="line">j-=gap;</div><div class="line">&#125;</div><div class="line">arr[j] = temp;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><h2 id="桶排"><a href="#桶排" class="headerlink" title="桶排"></a>桶排</h2><h2 id="基数"><a href="#基数" class="headerlink" title="基数"></a>基数</h2><h1 id="小口诀"><a href="#小口诀" class="headerlink" title="小口诀"></a>小口诀</h1><blockquote><p>冒泡选择插入堆，快速希尔计基堆<br>归并O(n)快logn，其他空间都是1<br>快堆归并nlogn，插折冒选慢n方（平均时间）<br>希尔特殊1.3，基数d把两数加（平均时间）<br>希尔快选堆不稳，其他排序稳稳哒</p></blockquote><p><strong>注：</strong></p><ol><li><p><em>log 的 g 不发音</em></p></li><li><p><em>第二句空间复杂度，三四句时间</em>  </p></li></ol>]]></content>
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 排序 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Git基本操作</title>
      <link href="/2017/01/15/Git/"/>
      <url>/2017/01/15/Git/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><p><strong>Git 是目前最流行的版本管理系统</strong></p><h2 id="Windows系统安装和使用"><a href="#Windows系统安装和使用" class="headerlink" title="Windows系统安装和使用"></a>Windows系统安装和使用</h2><p>安装后会出现三个工具-Bash,-CMD,-GUI，只用-Bash就行</p><p>在你想作为本地仓库的文件夹上（或进入文件夹空白处）鼠标右键，选择Git Bash here</p><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h3><p>​    从远程主机复制文件到本地文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git clone &lt;链接&gt; &lt;本地路径&gt;</div></pre></td></tr></table></figure><p>​    &lt;本地路径&gt;省略即-Bash当前路径</p><a id="more"></a><h3 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h3><ol><li><p>管理远程主机名：Git要求每个远程主机都必须指定一个主机名</p><p>添加远程主机+命名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git remote add &lt;主机名&gt; &lt;网址&gt;</div></pre></td></tr></table></figure></li><li><p>列出所有远程主机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git remote</div><div class="line">origin</div></pre></td></tr></table></figure></li><li><p>查看远程主机名对应的网址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git remote -v</div><div class="line">origin  https://... (fetch)</div><div class="line">origin  https://...(push)</div></pre></td></tr></table></figure></li><li><p>删除主机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git remote rm &lt;主机名&gt;</div></pre></td></tr></table></figure></li><li><p>改主机名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git remote rename &lt;原主机名&gt; &lt;新主机名&gt;</div></pre></td></tr></table></figure></li></ol><h3 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h3><ol><li><p>远程主机有更新（commit），将更新的取回本地。默认情况下git fetch 取回所有分支（branch）的更新。如果只想取回特定分支的更新，可以指定分支名。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git fetch &lt;远程主机名&gt; &lt;分支名&gt;</div></pre></td></tr></table></figure><p><strong>eg</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git fetch origin master</div></pre></td></tr></table></figure></li><li><p>查看远程分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git branch -r</div><div class="line">origin/master    #查看远程分支</div><div class="line"></div><div class="line"><span class="meta">$</span> git branch -a  #查看所有分支（包括本地）</div><div class="line">* master</div><div class="line">  remotes/origin/master</div></pre></td></tr></table></figure></li><li><p>在本地分支上合并远程分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git merge origin/master</div></pre></td></tr></table></figure></li></ol><h3 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h3><ol><li><p>取回远程主机某分支的更新，并与本地的制定分支合并</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git pull &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</div></pre></td></tr></table></figure><p>与当前分支合并冒号后可省略</p><p><strong>eg</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git pull origin master</div></pre></td></tr></table></figure><p>相当于</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git fetch origin</div><div class="line"><span class="meta">$</span> git merge origin/master</div></pre></td></tr></table></figure></li></ol><h3 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h3><ol><li><p>将本地分支的更新，推送到远程主机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git push &lt;远程主机名&gt; &lt;本地分支名&gt;:&lt;远程分支名&gt;</div></pre></td></tr></table></figure><p><strong>eg</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git push origin master:master</div><div class="line"><span class="meta">#</span>等同于</div><div class="line"><span class="meta">$</span> git push origin master</div></pre></td></tr></table></figure><p>如果省略远程分支名，则表示将本地分支推送与之存在”追踪关系”的远程分支（通常两者同名），如果该远程分支不存在，则会被新建。</p><p>上面命令表示，将本地的master分支推送到origin主机的master分支。</p></li><li><p>省略本地分支名，则表示删除指定的远程分支，因为这等同于推送一个空的本地分支到远程分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span> git push origin :master</div><div class="line"><span class="meta">#</span> 等同于</div><div class="line"><span class="meta">$</span> git push origin --delete master</div></pre></td></tr></table></figure><p>上面命令表示删除origin主机的master分支</p><p>更详细资料请参照：<a href="https://www.git-scm.com/book/en/v2" target="_blank" rel="external">https://www.git-scm.com/book/en/v2</a></p></li></ol>]]></content>
      
      <categories>
          
          <category> 版本控制 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>开篇</title>
      <link href="/2017/01/13/Begin/"/>
      <url>/2017/01/13/Begin/</url>
      <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><h1 id="自序"><a href="#自序" class="headerlink" title="自序"></a>自序</h1><p>​    大家好，我是一个普通的大学生，2013年考入哈尔滨工程大学软件工程专业，2017年想写博客，已经24岁。人生正在紧要关口，大的决策呼之欲出。</p><p>​    现在的我，放假在家，感到有属于自己的时间无比宝贵，没有外事打扰，想干什么就干什么，以后怕是少有了，无比珍惜。每天能做自己喜欢做的事，玩也好，学也好，不必担心衣食住行，真是最后的天堂了。</p><p>​    想把自己的收获、乐趣、心得，想法通过网站向有缘来访的朋友分享，留住生命中的点滴。</p><p>​    这两天为了建一个博客站，忙来忙去找了很多资料，问了很多朋友。总算有了点成果，虽然就是读说明书，还是很费劲，遇到的问题层出不穷……我觉的程序员最宝贵的能力就是自学能力，敢于接触新鲜事物，读懂别人的文章，英文开发文档，自己把新技术掌握了，并有自己的理解。</p><p>​    现在的我还差很多，希望在朋友的帮助下，师长的指导下，一点一点的，不断进步。</p>]]></content>
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> life </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
